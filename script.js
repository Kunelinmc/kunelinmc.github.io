import{initializeApp as e}from"https://www.gstatic.com/firebasejs/9.0.2/firebase-app.js";import{getAuth as t,signInWithPopup as n,GoogleAuthProvider as r,onAuthStateChanged as a,signOut as i}from"https://www.gstatic.com/firebasejs/9.0.2/firebase-auth.js";import{getStorage as o,ref as s,uploadBytesResumable as c,getDownloadURL as l}from"https://www.gstatic.com/firebasejs/9.0.2/firebase-storage.js";import{getFirestore as u,collection as d,setDoc as p,doc as f,getDocs as h,startAfter as v,onSnapshot as m,query as g,orderBy as x,limit as y}from"https://www.gstatic.com/firebasejs/9.0.2/firebase-firestore.js";(()=>{function b(e){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function L(){"use strict";L=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(u){l=function(e,t,n){return e[t]=n}}function d(t,n,r,i){var o,s,c,l,u=Object.create((n&&n.prototype instanceof g?n:g).prototype);return a(u,"_invoke",{value:(o=t,s=r,c=new M(i||[]),l=f,function(t,n){if(l===h)throw Error("Generator is already running");if(l===v){if("throw"===t)throw n;return{value:e,done:!0}}for(c.method=t,c.arg=n;;){var r=c.delegate;if(r){var a=C(r,c);if(a){if(a===m)continue;return a}}if("next"===c.method)c.sent=c._sent=c.arg;else if("throw"===c.method){if(l===f)throw l=v,c.arg;c.dispatchException(c.arg)}else"return"===c.method&&c.abrupt("return",c.arg);l=h;var i=p(o,s,c);if("normal"===i.type){if(l=c.done?v:"suspendedYield",i.arg===m)continue;return{value:i.arg,done:c.done}}"throw"===i.type&&(l=v,c.method="throw",c.arg=i.arg)}})}),u}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(r){return{type:"throw",arg:r}}}t.wrap=d;var f="suspendedStart",h="executing",v="completed",m={};function g(){}function x(){}function y(){}var $={};l($,o,function(){return this});var w=Object.getPrototypeOf,_=w&&w(w(S([])));_&&_!==n&&r.call(_,o)&&($=_);var A=y.prototype=g.prototype=Object.create($);function E(e){["next","throw","return"].forEach(function(t){l(e,t,function(e){return this._invoke(t,e)})})}function T(e,t){var n;a(this,"_invoke",{value:function(a,i){function o(){return new t(function(n,o){!function n(a,i,o,s){var c=p(e[a],e,i);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==b(u)&&r.call(u,"__await")?t.resolve(u.__await).then(function(e){n("next",e,o,s)},function(e){n("throw",e,o,s)}):t.resolve(u).then(function(e){l.value=e,o(l)},function(e){return n("throw",e,o,s)})}s(c.arg)}(a,i,n,o)})}return n=n?n.then(o,o):o()}})}function C(t,n){var r=n.method,a=t.iterator[r];if(a===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,C(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=TypeError("The iterator does not provide a '"+r+"' method")),m;var i=p(a,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,m;var o=i.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):o:(n.method="throw",n.arg=TypeError("iterator result is not an object"),n.delegate=null,m)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function M(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function S(t){if(t||""===t){var n=t[o];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function n(){for(;++a<t.length;)if(r.call(t,a))return n.value=t[a],n.done=!1,n;return n.value=e,n.done=!0,n};return i.next=i}}throw TypeError(b(t)+" is not iterable")}return x.prototype=y,a(A,"constructor",{value:y,configurable:!0}),a(y,"constructor",{value:x,configurable:!0}),x.displayName=l(y,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===x||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,l(e,c,"GeneratorFunction")),e.prototype=Object.create(A),e},t.awrap=function(e){return{__await:e}},E(T.prototype),l(T.prototype,s,function(){return this}),t.AsyncIterator=T,t.async=function(e,n,r,a,i){void 0===i&&(i=Promise);var o=new T(d(e,n,r,a),i);return t.isGeneratorFunction(n)?o:o.next().then(function(e){return e.done?e.value:o.next()})},E(A),l(A,c,"Generator"),l(A,o,function(){return this}),l(A,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=S,M.prototype={constructor:M,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(k),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function a(r,a){return s.type="throw",s.arg=t,n.next=r,a&&(n.method="next",n.arg=e),!!a}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return a("end");if(o.tryLoc<=this.prev){var c=r.call(o,"catchLoc"),l=r.call(o,"finallyLoc");if(c&&l){if(this.prev<o.catchLoc)return a(o.catchLoc,!0);if(this.prev<o.finallyLoc)return a(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return a(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return a(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),k(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;k(n)}return a}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:S(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),m}},t}function $(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(l){return void n(l)}s.done?t(c):Promise.resolve(c).then(r,a)}function w(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var i=e.apply(t,n);function o(e){$(i,r,a,o,s,"next",e)}function s(e){$(i,r,a,o,s,"throw",e)}o(void 0)})}}var _,A,E,T=function(e){return document.querySelector(e)},C=/(Android|webOS|Windows Phone|iPhone|iPod|iPad)/i.test(window.navigator.platform)||window.innerWidth<550,I="",k=!1,M=0,S={activitybar:T(".activitybar"),sidebar:T(".sidebar"),main:T(".main"),messageInput:T(".xtsARDHTI"),searchInput:T(".xujXllYgW"),messageArea:T(".xikyLwDf4"),sendButton:T(".xuwRtDpu4"),fileInput:T(".xVEJA40Qh"),actionModalContent:T(".x54SkYRT0"),actionModal:T(".x54SkYRT0"),actionModalTitle:T(".x54SkYRT0 .xrYn5ZY3v"),actionModalSubtitle:T(".xWDUelLWA"),actionModalOverlay:T(".x54SkYRT0 .overlay"),actionModalIcon:T(".x3DtTJteF"),signInBtn1:T(".xYIKBnbHS#x7BYgkdiJ"),signInBtn2:T(".xYIKBnbHS#xBnuWNG6V"),signInBtn3:T(".xYIKBnbHS#xWmsCDNbu"),signInModal:T(".xUO0M1BpL"),signInModalContent:T(".xUO0M1BpL .content"),signInModalTitle:T(".xUO0M1BpL .xrYn5ZY3v"),signOutBtn:T(".xlifWPlRj#x8Kzd47QX"),openSettingsBtn:T(".xlifWPlRj#x93dGr74c")},D=["幹","操","草","白癡","智障","死","笨蛋","傻逼"],B=!1,H=!1;function K(){return j.apply(this,arguments)}function j(){return(j=w(L().mark(function e(){var t,n;return L().wrap(function(e){for(var r;;)switch(e.prev=e.next){case 0:if(t=U((r=S.messageInput.innerText.trim().replace(/&([^;]+)/g,"&amp;$1").replaceAll("<","&lt;").replaceAll(">","&gt;").replace(/(\r?\n){3,}/g,"\n\n")).replace(/https?:\/\/[^\s/$.?#].[^\s]*/g,function(e){return'<a class="x0ciSQShX" href="'.concat(e,'" target="_blank">').concat(decodeURIComponent(e),"</a>")}).replaceAll("\n","<br>"))){e.next=3;break}return e.abrupt("return");case 3:return S.messageInput.innerHTML="",n=f(d(z,"chats",I,"messages")),e.next=7,p(n,{senderUID:A,sender:E,content:t,timestamp:Date.now()});case 7:G(t,n.id);case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}function G(e,t){var n=document.createElement("div"),r=document.createElement("div"),a=document.createElement("div"),i=document.createElement("div"),o=document.createElement("div"),s=document.createElement("div");s.classList.add("xRHoYYwoZ"),r.classList.add("xMyW2iRSH"),n.classList.add("xVC8gtuyS"),n.classList.add("xiOw4dg0O"),a.classList.add("xKljxgVJA"),i.classList.add("xu4Celbbq"),o.classList.add("xc4iCj2Gy"),n.appendChild(a),a.appendChild(s),s.appendChild(i),i.appendChild(o),s.appendChild(r),o.innerHTML="我",r.innerHTML=e,S.messageArea.appendChild(n),S.messageArea.scrollTo({top:S.messageArea.scrollHeight,behavior:"smooth"});try{n.setAttribute("data-mid",t)}catch(c){console.log("無法設置該元素參數：",c)}}function Y(e,t,n,r){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=document.createElement("div"),o=document.createElement("div"),s=document.createElement("div"),c=document.createElement("div"),l=document.createElement("div"),u=document.createElement("div"),d=document.createElement("div"),p=document.createElement("div"),f=document.createElement("div");if(f.classList.add("xRHoYYwoZ"),o.classList.add("xMyW2iRSH"),i.classList.add("xVC8gtuyS"),s.classList.add("xSYcbYqTG"),c.classList.add("xKljxgVJA"),l.classList.add("xu4Celbbq"),u.classList.add("xc4iCj2Gy"),d.classList.add("xuvoVURIs"),p.classList.add("xt8fROB2L"),d.innerText=" • ",p.innerText=r,i.setAttribute("data-mid",t),i.appendChild(s),i.appendChild(c),c.appendChild(f),f.appendChild(l),l.appendChild(u),l.appendChild(d),l.appendChild(p),f.appendChild(o),u.innerText=n,o.innerHTML=e,a)S.messageArea.appendChild(i),S.messageArea.scrollTo({top:S.messageArea.scrollHeight,behavior:"smooth"});else{var h=S.messageArea.firstChild;S.messageArea.insertBefore(i,h)}}function O(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=document.createElement("div"),a=document.createElement("div"),i=document.createElement("div"),o=document.createElement("div"),s=document.createElement("div");if(s.classList.add("xRHoYYwoZ"),a.classList.add("xMyW2iRSH"),r.classList.add("xVC8gtuyS"),i.classList.add("xKljxgVJA"),o.classList.add("xu4Celbbq"),r.setAttribute("data-mid",t),r.appendChild(i),i.appendChild(s),s.appendChild(o),s.appendChild(a),a.innerHTML=e,r.classList.add("xiOw4dg0O"),o.innerHTML='<div class="xc4iCj2Gy">你</div>',n)S.messageArea.appendChild(r),S.messageArea.scrollTo({top:S.messageArea.scrollHeight,behavior:"smooth"});else{var c=S.messageArea.firstChild;S.messageArea.insertBefore(r,c)}}function R(e){return e.replace(/&([^;]+)/g,"&amp;$1").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll(" ","&nbsp;").replaceAll("\n","<br>")}document.addEventListener("visibilitychange",function(){"visible"===document.visibilityState&&(document.title="Structure",k&&navigator.clearAppBadge(),M=0)}),S.messageInput.addEventListener("input",function(e){""===e.target.innerText.trim()&&(e.target.innerHTML="")}),S.messageInput.addEventListener("keydown",function(e){switch(e.keyCode){case 13:C||e.shiftKey||(e.preventDefault(),K());break;case 85:case 66:e.ctrlKey&&e.preventDefault()}}),C&&document.body.classList.add("mobile"),("setAppBadge"in navigator||"clearAppBadge"in navigator)&&(k=!0),S.sendButton.onclick=K,S.messageInput.onpaste=function(e){e.preventDefault(),document.execCommand("insertHTML",!0,R((e.clipboardData||window.clipboardData).getData("text/plain")))},document.onkeydown=function(e){switch(e.keyCode){case 191:"true"===S.messageInput.getAttribute("contenteditable")&&document.activeElement!==S.messageInput&&document.activeElement!==S.searchInput&&(e.preventDefault(),T(".xtsARDHTI").focus());break;case 75:e.ctrlKey&&B&&(e.preventDefault(),S.searchInput.focus());break;case 123:e.preventDefault();break;case 67:e.ctrlKey&&e.shiftKey&&e.preventDefault();break;case 85:case 79:case 187:case 189:case 80:case 83:e.ctrlKey&&e.preventDefault();break;case 37:case 39:e.altKey&&e.preventDefault()}},document.querySelectorAll("body > div").forEach(function(e){e.onwheel=function(e){e.ctrlKey&&e.preventDefault()}}),document.oncontextmenu=function(e){e.preventDefault()},T(".xehdiGgBv .xMyenRl7K .x8JU9DbQZ").onclick=function(){I="",T(".main").classList.remove("x8VAGH6N2"),S.messageInput.innerHTML="",S.messageInput.setAttribute("contenteditable","false"),S.messageInput.setAttribute("tabindex","-1"),S.sendButton.setAttribute("tabindex","-1")},document.addEventListener("touchstart",function(e){e.touches&&e.touches.length>1&&e.preventDefault()},{passive:!1});var P=0;function U(e){var t=RegExp(D.map(function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}).join("|"),"gi");return e.replace(t,function(e){return"*".repeat(e.length)})}function V(e,t,n,r){var a,i,o=document.createElement("div"),s=document.createElement("div"),c=document.createElement("div"),l=document.createElement("div");o.setAttribute("tabindex","0"),o.classList.add("x2fP9fkxS"),m(d(z,"chats",a=t,"messages"),function(e){e.metadata.fromCache||e.docChanges().forEach(function(e){var t=e.doc.data();if("added"===e.type)"hidden"===document.visibilityState&&(M++,document.title="(".concat(M,") Structure"),k&&navigator.setAppBadge(M)),a===I&&t.senderUID!==A&&Y(t.content,e.doc.id,t.sender,"現在");else if("removed"===e.type&&I===a)try{var n=T('.xikyLwDf4 .xVC8gtuyS[data-mid="'.concat(e.doc.id,'"]'));n.classList.add("deleted"),n.innerHTML="這則訊息已被刪除"}catch(r){console.log("發生未知錯誤",r)}})},function(e){console.error("監聽錯誤:",e)});var u,p=(i=w(L().mark(function e(){return L().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:(I!==t||C)&&(_=void 0,X(I=t),S.messageArea.innerHTML="",S.sendButton.classList.remove("disabled"),S.fileInput.removeAttribute("disabled"),S.messageInput.setAttribute("contenteditable","true"),C||(T(".x2fP9fkxS.active")&&T(".x2fP9fkxS.active").classList.remove("active"),T(".x2fP9fkxS.interim:not(.active)")&&T(".x2fP9fkxS.interim:not(.active)").remove(),o.classList.add("active")),C&&T(".xehdiGgBv .xMyenRl7K .x8JU9DbQZ").setAttribute("tabindex","0"),T(".main").classList.add("x8VAGH6N2"),T(".xvwhg72ii").innerText=o.getAttribute("data-roomName"),S.messageInput.setAttribute("contenteditable","true"),S.messageInput.setAttribute("tabindex","0"),S.sendButton.setAttribute("tabindex","0"));case 1:case"end":return e.stop()}},e)})),function(){return i.apply(this,arguments)});o.onclick=function(){p()},o.onkeydown=function(e){13===e.keyCode&&(S.messageArea.innerHTML="",p())},o.setAttribute("data-roomid",t),o.setAttribute("data-roomname",e),o.appendChild(s),s.classList.add("xQ65c0Nkc"),c.classList.add("xybvM5cRF"),s.appendChild(c),c.innerText=e,l.classList.add("xT3Ta8vKw"),l.innerHTML='\n		<span class="x97KBA8qs"><span class="x0o9XxPwY">'.concat((u=n).toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),'</span> 則訊息</span><span class="xVSkoFFmK">•</span><span class="x6EjoHfJB">').concat(r,"</span>\n	"),s.appendChild(l),T(".xemr1y6ie").appendChild(o)}function N(e){var t=Math.floor((Date.now()-e)/1e3);return t<60?"".concat(t,"秒"):t<3600?"".concat(Math.floor(t/60),"分鐘"):t<86400?"".concat(Math.floor(t/3600),"小時"):t<2592e3?"".concat(Math.floor(t/86400),"天"):t<31536e3?"".concat(Math.floor(t/2592e3),"個月"):"".concat(Math.floor(t/31536e3),"年前")}function W(e){for(var t=["B","KB","MB","GB","TB"],n=e,r=0;n>=1024&&r<t.length-1;)n/=1024,r++;return"".concat(n.toFixed(2)," ").concat(t[r])}document.addEventListener("touchend",function(e){var t=(new Date).getTime();t-P<=300&&e.preventDefault(),P=t},!1),document.addEventListener("gesturestart",function(e){e.preventDefault()}),S.messageInput.addEventListener("drop",function(e){e.preventDefault();var t=e.dataTransfer.getData("text/plain");try{e.target.focus(),document.execCommand("insertHTML",!0,R(t))}catch(n){console.log(n)}}),S.searchInput.oninput=function(e){document.querySelectorAll(".x8FrVw7Ca .x2fP9fkxS").forEach(function(t){t.getAttribute("data-roomname").toLowerCase().includes(e.target.value.toLowerCase())?t.classList.remove("hide"):t.classList.add("hide")})},T(".x8u3Iqtu9").onclick=function(){S.searchInput.focus()},S.messageInput.oncopy=function(e){e.preventDefault();var t=window.getSelection().getRangeAt(0),n=document.createElement("div");n.appendChild(t.cloneContents());var r=n.textContent||n.innerText||"";e.clipboardData.setData("text/plain",r)},S.messageArea.addEventListener("scroll",function(){0===(S.messageArea.pageYOffset||S.messageArea.scrollTop)&&function(e){q.apply(this,arguments)}(I)});var F=e({apiKey:"AIzaSyAp73V5ZsBUtpy4kS3-QyGirGSpz71DPWo",authDomain:"smiling-theory-397204.firebaseapp.com",databaseURL:"https://smiling-theory-397204-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"smiling-theory-397204",storageBucket:"smiling-theory-397204.appspot.com",messagingSenderId:"360479398694",appId:"1:360479398694:web:05b7df5ce277f89ea8ffe7",measurementId:"G-6BKTT1K7D1"}),z=u(F),Z=o(F);function Q(e,t){return J.apply(this,arguments)}function J(){return(J=w(L().mark(function e(t,n){var r;return L().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h(d(z,"chats",n,"messages"));case 2:V(t,n,(r=e.sent).size,"現在");case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function q(){return(q=w(L().mark(function e(t){var n;return L().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,void 0===_){e.next=8;break}return e.next=4,h(g(d(z,"chats",t,"messages"),x("timestamp","desc"),v(_),y(10)));case 4:(n=e.sent).docs[9]&&(_=n.docs[9]),n.forEach(function(e){var t=e.data();t.senderUID===A?O(t.content,e.id,!1):Y(t.content,t.id,t.sender,N(t.timestamp),!1)}),null!=n.docs[9]&&null!=n.docs[9]||(_=void 0);case 8:e.next=12;break;case 10:e.prev=10,e.t0=e.catch(0);case 12:case"end":return e.stop()}},e,null,[[0,10]])}))).apply(this,arguments)}function X(e){return ee.apply(this,arguments)}function ee(){return(ee=w(L().mark(function e(t){var n,r;return L().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h(g(d(z,"chats",t,"messages"),x("timestamp","desc"),y(10)));case 2:(n=e.sent).docs[9]&&(_=n.docs[9]),r=[],n.forEach(function(e){r.push(e)}),r.reverse(),r.forEach(function(e){var t=e.data();t.senderUID===A?O(t.content,e.id):Y(t.content,e.id,t.sender,N(t.timestamp))});case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}window.onload=w(L().mark(function e(){var t;return L().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h(d(z,"chats"));case 2:t=e.sent,T(".xemr1y6ie .spinner").remove(),t.forEach(function(e){var t=e.data();-1!==t.members.indexOf(A)&&Q(t.name,e.id)});case 4:case"end":return e.stop()}},e)}));var et=new r,en=t();a(en,function(e){e?(A=e.uid,E=e.displayName,function(){if(!1===H){S.searchInput.removeAttribute("disabled"),S.searchInput.setAttribute("tabindex","0"),S.messageArea.classList.remove("xVjpzmyej"),T(".xnKzgeITl")&&T(".xnKzgeITl").remove();var e=(new Date).getHours();Y("{dl}好，歡迎回來，現在就開始對話吧！".replace("{dl}",e>=5&&e<11?"早上":e>=11&&e<14?"中午":e>=14&&e<18?"下午":"晚上"),"0","陌生人","現在"),H=!0,B=!0}}()):(S.signInModal.classList.add("show"),A="",console.log("User is signed out"))}),S.signOutBtn.onclick=function(){i(en).then(function(){console.log("User signed out")}).catch(function(e){console.error("Sign out error",e)})},S.signInBtn1.onclick=function(){n(en,et).then(function(e){r.credentialFromResult(e).accessToken;var t=e.user;A=t.uid,E=t.displayName,S.signInModalContent.innerHTML='<div class="xJ0pEZGEO">已成功登入Google帳號</div>\n					<div class="xDmLoXo3E">\n					<img class="xm7NzrczQ" draggable="false" src="'.concat(t.photoURL,'" alt="avatar"/>\n					<div class="xDLBHn55v"><div class="xQ6IT8O6S">').concat(t.displayName,'</div>\n					<div class="xPnpcvswL">').concat(t.email,"</div></div></div>"),S.signInModal.onclick=function(){S.signInModal.classList.remove("show"),setTimeout(function(){S.signInModal.remove()},500)}}).catch(function(e){r.credentialFromError(e),console.log(e.code,e.message)})},S.fileInput.onchange=function(e){var t=e.target.files[0];if(t.size/1024/1024>5)return S.actionModalContent.classList.add("show"),S.actionModalTitle.innerText="這個文件太大了",S.actionModalSubtitle.innerText="這個文件足足有 ".concat(W(t.size),"，我們無法負擔"),T(".xCECpHDwZ").classList.remove("show"),void(S.actionModalOverlay.onclick=function(){S.actionModal.classList.remove("show")});S.actionModalOverlay.onclick=function(){};var n=s(Z,"uploads/"+t.name);S.actionModalContent.classList.add("show"),S.actionModalTitle.innerText="正在努力上傳中",S.actionModalSubtitle.innerText="這可能需要一點時間，請耐心等待...",T(".xCECpHDwZ").classList.add("show"),T(".xTGGn7ABj").innerText=t.name,T(".xtyaQiCLO").innerText=W(t.size);var r=c(n,t);r.on("state_changed",function(e){var t=e.bytesTransferred/e.totalBytes*100;T(".xk0osKWCK").style.width="".concat(t,"%"),console.log("Upload is "+t+"% done")},function(e){console.error("上传失败:",e)},w(L().mark(function e(){var n,a,i;return L().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return S.actionModalOverlay.onclick=function(){S.actionModal.classList.remove("show")},S.actionModalTitle.innerText="完成上傳",S.actionModalSubtitle.innerText="這個文件已成功上傳，你的好友可以訪問了",T(".xCECpHDwZ").classList.remove("show"),e.next=6,l(r.snapshot.ref);case 6:return n=e.sent,a="我剛剛上傳了一個名為「".concat(t.name,'」的文件，<a href="').concat(n,'" class="x0ciSQShX" target="_blank">點擊下載</a>'),i=f(d(z,"chats",I,"messages")),e.next=11,p(i,{senderUID:A,sender:E,content:a,timestamp:Date.now()});case 11:G(a,i.id),S.fileInput.value="";case 13:case"end":return e.stop()}},e)})))}})();
