/**release 0.14*/
import{initializeApp as e}from"https://www.gstatic.com/firebasejs/9.0.2/firebase-app.js";import{getAuth as t,signInWithPopup as n,GoogleAuthProvider as r,onAuthStateChanged as a,signInWithEmailAndPassword as i,signOut as o}from"https://www.gstatic.com/firebasejs/9.0.2/firebase-auth.js";import{getStorage as s,ref as c,uploadBytesResumable as l,getDownloadURL as d}from"https://www.gstatic.com/firebasejs/9.0.2/firebase-storage.js";import{getFirestore as u,collection as h,setDoc as p,doc as f,getDoc as v,getDocs as m,startAfter as g,onSnapshot as $,query as x,orderBy as y,limit as w}from"https://www.gstatic.com/firebasejs/9.0.2/firebase-firestore.js";(()=>{function _(e){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(){"use strict";b=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(d){l=function(e,t,n){return e[t]=n}}function u(t,n,r,i){var o,s,c,l,d=Object.create((n&&n.prototype instanceof g?n:g).prototype);return a(d,"_invoke",{value:(o=t,s=r,c=new S(i||[]),l=p,function(t,n){if(l===f)throw Error("Generator is already running");if(l===v){if("throw"===t)throw n;return{value:e,done:!0}}for(c.method=t,c.arg=n;;){var r=c.delegate;if(r){var a=A(r,c);if(a){if(a===m)continue;return a}}if("next"===c.method)c.sent=c._sent=c.arg;else if("throw"===c.method){if(l===p)throw l=v,c.arg;c.dispatchException(c.arg)}else"return"===c.method&&c.abrupt("return",c.arg);l=f;var i=h(o,s,c);if("normal"===i.type){if(l=c.done?v:"suspendedYield",i.arg===m)continue;return{value:i.arg,done:c.done}}"throw"===i.type&&(l=v,c.method="throw",c.arg=i.arg)}})}),d}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(r){return{type:"throw",arg:r}}}t.wrap=u;var p="suspendedStart",f="executing",v="completed",m={};function g(){}function $(){}function x(){}var y={};l(y,o,function(){return this});var w=Object.getPrototypeOf,L=w&&w(w(H([])));L&&L!==n&&r.call(L,o)&&(y=L);var C=x.prototype=g.prototype=Object.create(y);function k(e){["next","throw","return"].forEach(function(t){l(e,t,function(e){return this._invoke(t,e)})})}function E(e,t){var n;a(this,"_invoke",{value:function(a,i){function o(){return new t(function(n,o){!function n(a,i,o,s){var c=h(e[a],e,i);if("throw"!==c.type){var l=c.arg,d=l.value;return d&&"object"==_(d)&&r.call(d,"__await")?t.resolve(d.__await).then(function(e){n("next",e,o,s)},function(e){n("throw",e,o,s)}):t.resolve(d).then(function(e){l.value=e,o(l)},function(e){return n("throw",e,o,s)})}s(c.arg)}(a,i,n,o)})}return n=n?n.then(o,o):o()}})}function A(t,n){var r=n.method,a=t.iterator[r];if(a===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,A(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=TypeError("The iterator does not provide a '"+r+"' method")),m;var i=h(a,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,m;var o=i.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):o:(n.method="throw",n.arg=TypeError("iterator result is not an object"),n.delegate=null,m)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function H(t){if(t||""===t){var n=t[o];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function n(){for(;++a<t.length;)if(r.call(t,a))return n.value=t[a],n.done=!1,n;return n.value=e,n.done=!0,n};return i.next=i}}throw TypeError(_(t)+" is not iterable")}return $.prototype=x,a(C,"constructor",{value:x,configurable:!0}),a(x,"constructor",{value:$,configurable:!0}),$.displayName=l(x,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===$||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,l(e,c,"GeneratorFunction")),e.prototype=Object.create(C),e},t.awrap=function(e){return{__await:e}},k(E.prototype),l(E.prototype,s,function(){return this}),t.AsyncIterator=E,t.async=function(e,n,r,a,i){void 0===i&&(i=Promise);var o=new E(u(e,n,r,a),i);return t.isGeneratorFunction(n)?o:o.next().then(function(e){return e.done?e.value:o.next()})},k(C),l(C,c,"Generator"),l(C,o,function(){return this}),l(C,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=H,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(I),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function a(r,a){return s.type="throw",s.arg=t,n.next=r,a&&(n.method="next",n.arg=e),!!a}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return a("end");if(o.tryLoc<=this.prev){var c=r.call(o,"catchLoc"),l=r.call(o,"finallyLoc");if(c&&l){if(this.prev<o.catchLoc)return a(o.catchLoc,!0);if(this.prev<o.finallyLoc)return a(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return a(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return a(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),I(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;I(n)}return a}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:H(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),m}},t}function L(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(l){return void n(l)}s.done?t(c):Promise.resolve(c).then(r,a)}function C(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var i=e.apply(t,n);function o(e){L(i,r,a,o,s,"next",e)}function s(e){L(i,r,a,o,s,"throw",e)}o(void 0)})}}function k(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,I(r.key),r)}}function A(e,t,n){return t&&E(e.prototype,t),n&&E(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function T(e,t,n){return(t=I(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function I(e){var t=function(e){if("object"!=_(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=_(n))return n;throw TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==_(t)?t:t+""}var S,H,M=A(function e(t){var n=this;k(this,e),T(this,"_handleKeyDown",function(e){27===e.keyCode&&(n.close(),n.trigger.focus())}),this.Root=document.createElement("div"),this.Overlay=document.createElement("div"),this.Content=document.createElement("div"),this.trigger=t;var r=this.trigger.getBoundingClientRect();this.Content.style.left=r.left+"px",this.Content.style.top=r.top+r.height+"px",this.Root.classList.add("xEHCrF5Oe"),this.Overlay.classList.add("overlay"),this.Content.classList.add("xC3Uih0ex"),this.Root.setAttribute("data-state","open"),this.Root.setAttribute("role","popover"),this.Root.setAttribute("aria-modal","true"),document.body.appendChild(this.Root),this.Root.appendChild(this.Overlay),this.Root.appendChild(this.Content),this.Root.onwheel=function(e){e.ctrlKey&&e.preventDefault()},this.hidden_elements=document.querySelectorAll("body > *:not(.xEHCrF5Oe, script, [hidden])"),this.hidden_elements.forEach(function(e){e.setAttribute("inert","true")}),this.Overlay.addEventListener("click",function(){return n.close()}),this.Overlay.addEventListener("contextmenu",function(){return n.close()}),document.addEventListener("keydown",this._handleKeyDown)},[{key:"_removeListeners",value:function(){document.removeEventListener("keydown",this._handleKeyDown)}},{key:"close",value:function(){var e=this;this._removeListeners(),this.hidden_elements.forEach(function(e){e.removeAttribute("inert")}),this.Root.setAttribute("data-state","closed"),setTimeout(function(){e.Root.remove()},100)}}]),O=A(function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.closeOnOverlayClick,a=n.closeOnEsc;k(this,e),T(this,"_handleOverlayClick",function(){t.close(),t._removeListeners()}),T(this,"_handleKeyDown",function(e){27===e.keyCode&&(t.close(),t._removeListeners())}),this.Root=document.createElement("div"),this.Overlay=document.createElement("div"),this.Content=document.createElement("div"),this.Root.classList.add("x54SkYRT0"),this.Root.setAttribute("data-state","open"),this.Overlay.classList.add("overlay"),this.Content.classList.add("content"),this.Root.appendChild(this.Overlay),this.Root.appendChild(this.Content),this.Root.setAttribute("role","dialog"),this.Root.setAttribute("aria-modal","true"),this.Root.onwheel=function(e){e.ctrlKey&&e.preventDefault()},this.hidden_elements=document.querySelectorAll("body > *:not(.x54SkYRT0, script, style, [hidden])"),this.hidden_elements.forEach(function(e){e.setAttribute("inert","true")}),document.body.appendChild(this.Root),this.Root.classList.add("show"),void 0!==r&&r&&this.Overlay.addEventListener("click",this._handleOverlayClick),void 0!==a&&a&&document.addEventListener("keydown",this._handleKeyDown)},[{key:"_removeListeners",value:function(){this.Overlay.onclick=null,document.removeEventListener("keydown",this._handleKeyDown)}},{key:"close",value:function(){var e=this;this.hidden_elements.forEach(function(e){e.removeAttribute("inert")}),this.Root.setAttribute("data-state","closed"),setTimeout(function(){e.Root.remove()},100)}}]),D=function(e){var t=document.createElement("div");return t.classList.add(e),t},B=function(e){return document.querySelector(e)},R=/(Android|webOS|Windows Phone|iPhone|iPod|iPad)/i.test(window.navigator.platform)||window.innerWidth<500,j="",G=!1,K=0,P={activitybar:B(".activitybar"),sidebar:B(".sidebar"),main:B(".main"),messageInput:B(".xtsARDHTI"),searchInput:B(".xujXllYgW"),messageArea:B(".xikyLwDf4"),sendButton:B(".xuwRtDpu4"),fileInput:B(".xVEJA40Qh"),signOutBtn:B(".xlifWPlRj#x8Kzd47QX")},Y=["幹","操","草","白癡","智障","死","笨蛋","傻逼"],F=800,W=!1,z=!1;function N(){return V.apply(this,arguments)}function V(){return(V=C(b().mark(function e(){var t,n;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((t=P.messageInput.innerText.trim())&&!(t.length>F)&&j){e.next=3;break}return e.abrupt("return");case 3:var r,a;return t=function(e){var t=RegExp(Y.map(function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}).join("|"),"gi");return e.replace(t,function(e){return"*".repeat(e.length)})}((a=(r=t.replace(/&([^;]+)/g,"&amp;$1").replaceAll("<","&lt;").replaceAll(">","&gt;").replace(/(\r?\n){3,}/g,"\n\n")).replace(/https?:\/\/[^\s/$.?#].[^\s]*/g,function(e){return'<a class="x0ciSQShX" href="'.concat(e,'" target="_blank" rel="noreferrer noopener">').concat(decodeURIComponent(e),"</a>")})).replace(/^\s*[-]{10,}\s*\n?/gm,'<div class="x3nWNfdWy horizontal"></div>').replaceAll("\n","<br>")),P.messageInput.innerHTML="",n=f(h(ea,"chats",j,"messages")),e.next=8,p(n,{sender:H,content:t,timestamp:Date.now()});case 8:Z(t,n.id);case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Z(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=document.createElement("div"),a=document.createElement("div"),i=document.createElement("div"),o=document.createElement("div"),s=document.createElement("div"),c=document.createElement("div");if(r.setAttribute("data-message-id",t),c.classList.add("xRHoYYwoZ"),a.classList.add("xMyW2iRSH"),r.classList.add("xVC8gtuyS"),r.classList.add("xiOw4dg0O"),i.classList.add("xKljxgVJA"),o.classList.add("xu4Celbbq"),s.classList.add("xc4iCj2Gy"),r.appendChild(i),i.appendChild(c),c.appendChild(o),o.appendChild(s),c.appendChild(a),s.innerHTML="You",a.innerHTML=e,n)P.messageArea.appendChild(r),P.messageArea.scrollTo({top:P.messageArea.scrollHeight,behavior:"instant"});else{var l=P.messageArea.firstChild;P.messageArea.insertBefore(r,l)}}function Q(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],s=document.createElement("div"),c=document.createElement("div"),l=document.createElement("div"),d=document.createElement("div"),u=document.createElement("div"),h=document.createElement("div"),p=document.createElement("div"),f=document.createElement("div");f.classList.add("xRHoYYwoZ"),c.classList.add("xMyW2iRSH"),s.classList.add("xVC8gtuyS"),l.classList.add("xSYcbYqTG");var v=document.createElement("img");if(v.src=i||"/assets/avatar.png",l.appendChild(v),d.classList.add("xKljxgVJA"),u.classList.add("xu4Celbbq"),h.classList.add("xc4iCj2Gy"),p.classList.add("xt8fROB2L"),p.innerText=r,s.setAttribute("data-message-id",t),s.appendChild(l),s.appendChild(d),d.appendChild(f),f.appendChild(u),u.appendChild(h),console.log("Avatar: ".concat(i)),a){var m=D("xvaVnGX8Q");m.innerHTML='<span class="xMF0A6T9h" title="Verified"><svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"></path></svg></span>',u.appendChild(m)}if(u.appendChild(p),f.appendChild(c),l.classList.add("xWzeTGC6P"),h.innerText=n||"Unknown",c.innerHTML=e,o)P.messageArea.appendChild(s),P.messageArea.scrollTo({top:P.messageArea.scrollHeight,behavior:"instant"});else{var g=P.messageArea.firstChild;P.messageArea.insertBefore(s,g)}}function U(e){return e.replace(/&([^;]+)/g,"&amp;$1").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll(" ","&nbsp;").replaceAll("\n","<br>")}document.addEventListener("visibilitychange",function(){"visible"===document.visibilityState&&(document.title="Structure",G&&navigator.clearAppBadge(),K=0)}),P.messageInput.addEventListener("input",function(e){""===e.target.innerText.trim()&&(e.target.innerHTML="")}),P.messageInput.addEventListener("input",function(){window.getSelection().getRangeAt(0).startContainer.textContent.trim().startsWith("/")&&console.log("是一則命令")}),P.messageInput.addEventListener("keydown",function(e){switch(e.keyCode){case 13:R||e.shiftKey||(e.preventDefault(),N());break;case 85:case 66:e.ctrlKey&&e.preventDefault()}}),R&&document.body.classList.add("mobile"),"setAppBadge"in navigator&&"clearAppBadge"in navigator&&(G=!0),P.sendButton.onclick=N,P.sendButton.onkeydown=function(e){13===e.keyCode&&N()},P.messageInput.onpaste=function(e){e.preventDefault(),document.execCommand("insertHTML",!0,U((e.clipboardData||window.Clipboard).getData("text/plain")))},document.onkeydown=function(e){switch(e.keyCode){case 191:document.activeElement!=P.messageInput&&document.activeElement!==P.searchInput&&(e.preventDefault(),P.messageInput.focus());break;case 75:e.ctrlKey&&W&&(e.preventDefault(),P.searchInput.focus());break;case 123:e.preventDefault();break;case 67:e.ctrlKey&&e.shiftKey&&e.preventDefault();break;case 85:case 79:case 187:case 189:case 80:case 83:case 109:case 107:e.ctrlKey&&e.preventDefault();break;case 37:case 39:e.altKey&&e.preventDefault()}},document.querySelectorAll("body > div").forEach(function(e){e.onwheel=function(e){e.ctrlKey&&e.preventDefault()}}),document.oncontextmenu=function(e){e.preventDefault()},B(".xehdiGgBv .xMyenRl7K .x8JU9DbQZ").onclick=function(){j="",B(".main").classList.remove("x8VAGH6N2"),P.messageInput.innerHTML="",P.messageInput.setAttribute("contenteditable","false"),P.messageInput.setAttribute("tabindex","-1"),P.sendButton.setAttribute("tabindex","-1")},document.addEventListener("touchstart",function(e){e.touches&&e.touches.length>1&&e.preventDefault()},{passive:!1});var q=0;document.addEventListener("touchend",function(e){var t=(new Date).getTime();t-q<=300&&e.preventDefault(),q=t},!1),document.addEventListener("gesturestart",function(e){e.preventDefault()});var J=[];function X(e,t,n,r){var a,i,o=document.createElement("div"),s=document.createElement("div"),c=document.createElement("div"),l=document.createElement("div"),d=document.createElement("div"),u=document.createElement("div");o.setAttribute("tabindex","0"),o.classList.add("x2fP9fkxS"),d.classList.add("x6HyfOZS7"),u.classList.add("xQkxrD9ZA"),u.setAttribute("aria-label","Actions"),a=t,$(h(ea,"chats",a,"messages"),function(e){e.docChanges().forEach(function(e){if(j===a){var t,n=e.doc.data();switch(e.type){case"added":n.sender!==H&&("hidden"===document.visibilityState&&(K++,document.title="(".concat(K,") Structure"),G&&navigator.setAppBadge(K)),es(n.sender).then(function(t){Q(n.content,e.doc.id,t.name,"Now",t.verified,t.avatarUrl)}).catch(function(e){console.error("An error occurred while processing user data:",e)}));break;case"removed":try{(t=B('.xikyLwDf4 .xVC8gtuyS[data-message-id="'.concat(e.doc.id,'"]'))).classList.add("deleted"),t.innerHTML="This message has been deleted"}catch(r){console.log("發生未知錯誤",r)}break;case"modified":try{(t=B('.xikyLwDf4 .xVC8gtuyS[data-message-id="'.concat(e.doc.id,'"] .xMyW2iRSH'))).innerHTML=n.content}catch(i){console.log("發生未知錯誤",i)}}}})},function(e){console.error("監聽錯誤:",e)});var p=(i=C(b().mark(function e(){return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:(j!==t||R)&&(S=void 0,eh(j=t),P.messageArea.innerHTML="",P.sendButton.classList.remove("disabled"),P.fileInput.removeAttribute("disabled"),B(".xpbRox0hO").classList.remove("disabled"),B(".xpbRox0hO").tabIndex="0",P.messageInput.setAttribute("contenteditable","true"),R||(B(".x2fP9fkxS.active")&&B(".x2fP9fkxS.active").classList.remove("active"),B(".x2fP9fkxS.interim:not(.active)")&&B(".x2fP9fkxS.interim:not(.active)").remove(),o.classList.add("active")),R&&B(".xehdiGgBv .xMyenRl7K .x8JU9DbQZ").setAttribute("tabindex","0"),B(".main").classList.add("x8VAGH6N2"),B(".xvwhg72ii").innerText=o.getAttribute("data-room-name"),P.messageInput.setAttribute("contenteditable","true"),P.messageInput.setAttribute("tabindex","0"));case 1:case"end":return e.stop()}},e)})),function(){return i.apply(this,arguments)});o.onclick=function(){p()},o.onkeydown=function(e){13===e.keyCode&&p()},J.push({id:t,name:e,dom:o}),o.appendChild(s),o.appendChild(d),d.appendChild(u),u.tabIndex="0";var f,v,m=function(){var e=new M(u),n=D("xrQdSHI2A"),r=D("xrQdSHI2A"),a=D("xcoXgMpFW"),i=D("xrQdSHI2A");function o(){e.close(),function(){var e=new O({closeOnEsc:!0,closeOnOverlayClick:!0});e.Content.style.padding="0";var n=D("xrYn5ZY3v");n.classList.add("lf"),n.innerText="Invitation link";var r=D("xKfGtNfnX"),a=D("xMMSyk68x");a.innerText="Some people may not be able to join.";var i=D("xWDUelLWA"),o=document.createElement("div");o.classList.add("xIcrOS5lb");var s="".concat(window.location.origin,"/?join=").concat(t);o.innerText=s;var c=document.createElement("div");c.tabIndex="0",c.classList.add("xGugcvsJF");var l='\n		<svg aria-hidden="true" style="min-width: 20px" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n			<rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>';function d(){navigator.clipboard.writeText(s),c.innerHTML='<svg aria-hidden="true" style="min-width: 20px" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n			<path d="M20 6 9 17l-5-5"/>\n			</svg>',setTimeout(function(){c.innerHTML=l},1500)}c.innerHTML=l,c.onclick=function(){d()},c.onkeydown=function(e){13===e.keyCode&&d()},i.appendChild(r),i.appendChild(a),r.appendChild(o),r.appendChild(c),e.Content.appendChild(n),e.Content.appendChild(i)}()}function s(){var t;e.close(),(t=new O({closeOnEsc:!0,closeOnOverlayClick:!0})).Content.style.padding="0",t.Content.innerHTML='<div class="xrYn5ZY3v lf">Settings</div><div class="xWDUelLWA">Not yet completed construction</div>'}n.innerText="Invite People",n.style.color="rgb(112, 184, 255)",n.onclick=function(){o()},[n,r,i].forEach(function(e){e.tabIndex="0"}),n.onkeydown=function(e){13===e.keyCode&&o()},r.onkeydown=function(e){13===e.keyCode&&s()},e.Content.appendChild(n),r.innerText="Privacy Settings",r.onclick=function(){s()},e.Content.appendChild(r),e.Content.appendChild(a),i.innerText="Leave",i.style.color="rgb(239, 68, 68)",e.Content.appendChild(i)};u.onkeydown=function(e){e.stopPropagation(),13===e.keyCode&&m()},u.innerHTML='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n	<circle cx="12" cy="12" r="1" /><circle cx="12" cy="5" r="1" /><circle cx="12" cy="19" r="1" /></svg>',u.onclick=function(e){e.stopPropagation(),m()},s.classList.add("xQ65c0Nkc"),c.classList.add("xybvM5cRF"),s.appendChild(c),c.innerText=e,l.classList.add("xT3Ta8vKw"),f=n||(0===r?"No message":"".concat((v=r).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")," messages")),l.innerHTML='\n		<span class="x97KBA8qs">'.concat(f,"</span>\n	"),s.appendChild(l),B(".xemr1y6ie").appendChild(o)}function ee(e){var t=Math.floor((Date.now()-e)/1e3);return t<60?"".concat(t,"sec ago"):t<3600?"".concat(Math.floor(t/60)," min ago"):t<86400?"".concat(Math.floor(t/3600)," hour ago"):t<2592e3?"".concat(Math.floor(t/86400)," day ago"):t<31536e3?"".concat(Math.floor(t/2592e3)," month ago"):"".concat(Math.floor(t/31536e3)," year ago")}function et(e){for(var t=["B","KB","MB","GB","TB","PB"],n=e,r=0;n>=1024&&r<t.length-1;)n/=1024,r++;return"".concat(n.toFixed(2)," ").concat(t[r])}P.messageInput.addEventListener("drop",function(e){e.preventDefault();var t=e.dataTransfer.getData("text/plain");try{e.target.focus(),document.execCommand("insertHTML",!0,U(t))}catch(n){}}),P.searchInput.oninput=function(e){J.forEach(function(t){t.name.toLowerCase().includes(e.target.value.toLowerCase())?t.dom.classList.remove("hide"):t.dom.classList.add("hide")})},P.messageInput.oncopy=function(e){e.preventDefault();var t=window.getSelection().toString();e.clipboardData.setData("text/plain",t)},P.messageArea.addEventListener("scroll",function(){var e=P.messageArea.pageYOffset||P.messageArea.scrollTop;en=P.messageArea.scrollHeight,0===e&&function(e){eu.apply(this,arguments)}(j)});var en,er=e({apiKey:"AIzaSyAp73V5ZsBUtpy4kS3-QyGirGSpz71DPWo",authDomain:"smiling-theory-397204.firebaseapp.com",databaseURL:"https://smiling-theory-397204-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"smiling-theory-397204",storageBucket:"smiling-theory-397204.appspot.com",messagingSenderId:"360479398694",appId:"1:360479398694:web:05b7df5ce277f89ea8ffe7",measurementId:"G-6BKTT1K7D1"}),ea=u(er),ei=s(er),eo={};function es(e){return ec.apply(this,arguments)}function ec(){return(ec=C(b().mark(function e(t){var n,r,a,i,o;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!eo[t]){e.next=3;break}return console.log("Get data from memory cache"),e.abrupt("return",eo[t]);case 3:if(!(n=localStorage.getItem("userProfile_".concat(t)))){e.next=9;break}return console.log("Get data from localStorage"),r=JSON.parse(n),eo[t]=r,e.abrupt("return",r);case 9:return e.prev=9,a=f(ea,"users",t),e.next=13,v(a);case 13:if(!(i=e.sent).exists()){e.next=22;break}return o=i.data(),eo[t]=o,localStorage.setItem("userProfile_".concat(t),JSON.stringify(o)),console.log("從 Firestore 獲取數據"),e.abrupt("return",o);case 22:return console.log("沒有找到該用戶的資料"),e.abrupt("return",null);case 24:e.next=30;break;case 26:throw e.prev=26,e.t0=e.catch(9),console.error("獲取用戶數據時出錯: ",e.t0),e.t0;case 30:case"end":return e.stop()}},e,null,[[9,26]])}))).apply(this,arguments)}function el(e,t,n){return ed.apply(this,arguments)}function ed(){return(ed=C(b().mark(function e(t,n,r){var a;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m(h(ea,"chats",r,"messages"));case 2:X(t,r,n,(a=e.sent).size);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function eu(){return(eu=C(b().mark(function e(t){var n,r;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,void 0===S){e.next=9;break}return e.next=4,m(x(h(ea,"chats",t,"messages"),y("timestamp","desc"),g(S),w(10)));case 4:n=e.sent,console.log("There are ".concat(n.docs.length," documents on the next page")),S=10===n.docs.length?n.docs[9]:void 0,n.forEach(function(e){var t=e.data();t.sender===H?Z(t.content,e.id,!1):es(t.sender).then(function(n){Q(t.content,e.id,n.name,ee(t.timestamp),n.verified,n.avatarUrl,!1)}).catch(function(e){console.error("An error occurred while processing user data:",e)})}),0!==n.docs.length&&(r=P.messageArea.scrollHeight,P.messageArea.scrollTop=r-en);case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.error("Error fetching messages: ",e.t0);case 14:case"end":return e.stop()}},e,null,[[0,11]])}))).apply(this,arguments)}function eh(e){return ep.apply(this,arguments)}function ep(){return(ep=C(b().mark(function e(t){var n,r;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m(x(h(ea,"chats",t,"messages"),y("timestamp","desc"),w(10)));case 2:(n=e.sent).docs[9]&&(S=n.docs[9]),r=[],n.forEach(function(e){r.push(e)}),r.reverse(),r.forEach(function(e){var t=e.data();t.sender===H?Z(t.content,e.id):es(t.sender).then(function(n){Q(t.content,e.id,n.name,ee(t.timestamp),n.verified,n.avatarUrl)}).catch(function(e){console.error("An error occurred while processing user data:",e)})}),en=P.messageArea.scrollHeight;case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)}window.onload=C(b().mark(function e(){var t,n,r,a,i,o,s,c;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=new URLSearchParams(window.location.search).get("join"))){e.next=7;break}return n=f(ea,"chats",t),e.next=5,v(n);case 5:(r=e.sent).exists()?-1!==r.data().members.indexOf(H)?(console.log("你他媽已經加入了!"),(a=new URL(window.location)).search="",history.replaceState({},"",a)):(i=r.data(),o=new O({closeOnEsc:!0,closeOnOverlayClick:!0}),"public"===i.mode?o.Content.innerHTML="<h2>請求加入：".concat(i.name,"</h2><p>成員數：").concat(i.members.length,"</p>"):o.Content.innerHTML="<h2>無法直接加入</h2>"):console.log("無法加入");case 7:return e.next=9,m(h(ea,"chats"));case 9:s=e.sent,c=0,B(".xemr1y6ie .spinner").remove(),s.forEach(function(e){var t=e.data();-1!==t.members.indexOf(H)&&(c++,el(t.name,t.description,e.id))}),0===c&&(B(".xemr1y6ie").innerHTML='<div class="xZYFExNlg">There\'s nothing here yet</div>');case 14:case"end":return e.stop()}},e)}));var ef=new r,ev=t();function em(){var e=document.createElement("div");e.classList.add("xrYn5ZY3v"),e.innerText="Account Login";var t=document.createElement("div");t.classList.add("xRRuA0Z3S");var a=document.createElement("div");a.id="x7BYgkdiJ",a.tabIndex="0",a.innerHTML='<svg class="xGBqJjpdr" viewBox="0 0 20 20"><path d="M19.6 10.23c0-.82-.1-1.42-.25-2.05H10v3.72h5.5c-.15.96-.74 2.31-2.04 3.22v2.45h3.16c1.89-1.73 2.98-4.3 2.98-7.34z" fill=#4285F4></path>\n	<path d="M13.46 15.13c-.83.59-1.96 1-3.46 1-2.64 0-4.88-1.74-5.68-4.15H1.07v2.52C2.72 17.75 6.09 20 10 20c2.7 0 4.96-.89 6.62-2.42l-3.16-2.45z" fill=#34A853></path>\n	<path d="M3.99 10c0-.69.12-1.35.32-1.97V5.51H1.07A9.973 9.973 0 000 10c0 1.61.39 3.14 1.07 4.49l3.24-2.52c-.2-.62-.32-1.28-.32-1.97z" fill=#FBBC05></path><path d="M10 3.88c1.88 0 3.13.81 3.85 1.48l2.84-2.76C14.96.99 12.7 0 10 0 6.09 0 2.72 2.25 1.07 5.51l3.24 2.52C5.12 5.62 7.36 3.88 10 3.88z" fill=#EA4335></path></svg><div>Sign in with Google</div>';var o=document.createElement("div");o.tabIndex="0",o.id="xBnuWNG6V",o.className="actionbtn xYIKBnbHS",a.className="actionbtn xYIKBnbHS",o.innerHTML='<svg aria-hidden="true" class="xGBqJjpdr" viewBox="0 0 20 20"><path d="M1 5.006A2 2 0 012.995 3h14.01A2 2 0 0119 5.006v9.988A2 2 0 0117.005 17H2.995A2 2 0 011 14.994V5.006zM3 5l7 4 7-4v2l-7 4-7-4V5z" fill-rule=evenodd fill=#788aa2></path></svg><div>Sign in with email</div>',t.appendChild(a),t.appendChild(o);var s=new O;s.Content.classList.add("bt"),s.Content.appendChild(e),s.Content.appendChild(t),a.onclick=function(){n(ev,ef).then(function(e){r.credentialFromResult(e).accessToken;var t=e.user;H=t.uid,s.Content.innerHTML='<div class="xJ0pEZGEO">Successfully logged in to Google account</div><div class="xDmLoXo3E"><img class="xm7NzrczQ" draggable="false" src="'.concat(t.photoURL,'" alt="avatar"/><div class="xDLBHn55v"><div class="xQ6IT8O6S">').concat(t.displayName,'</div><div class="xPnpcvswL">').concat(t.email,"</div></div></div>"),s.Overlay.onclick=function(){s.close()}}).catch(function(e){r.credentialFromError(e),console.log(e.code,e.message)})},o.onclick=function(){var e=new O({closeOnEsc:!0,closeOnOverlayClick:!0}),t=document.createElement("div");t.classList.add("xrYn5ZY3v"),t.innerText="Account Login",e.Content.appendChild(t);var n=document.createElement("div");n.classList.add("xZdL9CF5M"),e.Content.appendChild(n);var r=document.createElement("input");r.placeholder="Email",r.autocomplete="off",r.type="text",r.autocomplete="off",r.spellcheck="false",n.appendChild(r);var a=document.createElement("input");a.placeholder="Password",a.type="password",a.autocomplete="off",n.appendChild(a);var o=document.createElement("div");o.classList.add("xw0IanPrC"),n.appendChild(o);var c=document.createElement("div");c.innerText="Login",c.tabIndex="0",c.classList.add("x40AApYkW"),n.appendChild(c),r.focus();var l=!0,d=function(t){console.log(t),l&&(l=!1,o.classList.remove("show"),c.innerHTML='<svg aria-hidden="true" class="x3xXCjYFp" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>',r.disabled=!0,a.disabled=!0,c.classList.add("disabled"),c.tabIndex="-1",c.blur(),i(ev,r.value,a.value).then(function(t){try{s.close(),e.close()}catch(n){}var r=t.user;console.log("用户已登录:",r)}).catch(function(e){setTimeout(function(){var t=e.code;o.classList.add("show"),"auth/invalid-login-credentials"===t?o.innerText="Invalid Login Credentials":"auth/invalid-email"===t?o.innerText="Invalid Email":"auth/network-request-failed"===t&&(o.innerText="Network Request Failed"),c.innerHTML="Login",c.classList.remove("disabled"),c.tabIndex="0",r.disabled=!1,a.disabled=!1,l=!0},3e3)}))};c.onclick=function(){d()},r.onkeydown=function(){13===event.keyCode&&a.focus()},[c,a].forEach(function(e){e.onkeydown=function(e){13===e.keyCode&&d()}})}}window.auth=ev,a(ev,function(e){e?(H=e.uid,function(){if(!1===z){P.searchInput.removeAttribute("disabled"),P.searchInput.setAttribute("tabindex","0"),P.messageArea.classList.remove("xVjpzmyej"),B(".xnKzgeITl")&&B(".xnKzgeITl").remove();var e=(new Date).getHours();Q("Good {dl} and welcome back. Let's start the chatting now".replace("{dl}",e>=5&&e<11?"morning":e>=11&&e<14?"afternoon":e>=14&&e<18?"evening":"night"),"0","Stranger.",ee(17040384e5)),z=!0,W=!0}}()):(H="",em())}),P.signOutBtn.onclick=function(){o(ev).then(function(){console.log("User signed out")}).catch(function(e){console.error("Sign out error",e)})},P.fileInput.onchange=function(){var e=C(b().mark(function e(t){var n,r,a,i,o,s,u,v,m,g,$,x;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.target.files[0]){e.next=3;break}return e.abrupt("return");case 3:if((r=new O).Content.classList.add("bt"),(a=document.createElement("div")).classList.add("xrYn5ZY3v"),(i=document.createElement("div")).classList.add("xb1IsDa6e"),r.Content.appendChild(a),r.Content.appendChild(i),!(n.size/1024/1024>5)){e.next=16;break}return a.innerText="This file is too large",i.innerText="This file is ".concat(et(n.size),", we can't afford it."),r.Overlay.onclick=function(){r.close()},e.abrupt("return");case 16:o=c(ei,"uploads/"+n.name),a.innerText="Uploading",i.innerText="This may take a while, please be patient...",(s=document.createElement("div")).classList.add("xCECpHDwZ"),r.Content.appendChild(s),(u=document.createElement("div")).classList.add("xty9qDHrl"),s.appendChild(u),(v=document.createElement("div")).classList.add("xIEj1ZAnA"),v.innerHTML='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"></path><path d="M14 2v4a2 2 0 0 0 2 2h4"></path></svg>',u.appendChild(v),(m=document.createElement("div")).classList.add("xxs4n9nhX"),u.appendChild(m),m.innerHTML='<div class="xTGGn7ABj">'.concat(n.name,'</div><div class="xtyaQiCLO">').concat(et(n.size),"</div>"),u.appendChild(m),(g=document.createElement("div")).classList.add("xsoLox5sj"),u.appendChild(g),($=document.createElement("div")).classList.add("xk0osKWCK"),g.appendChild($),(x=l(o,n)).on("state_changed",function(e){var t=e.bytesTransferred/e.totalBytes*100;$.style.width="".concat(t,"%")},function(e){console.error(e)},C(b().mark(function e(){var t,o,c,l;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r.Overlay.onclick=function(){r.close()},s.remove(),a.innerText="Complete upload",i.innerText="This file has been uploaded successfully",e.next=6,d(x.snapshot.ref);case 6:return t=e.sent,o=(c=String(n.type)).startsWith("image/")?'<img tabindex="0" draggable="false" src="'.concat(t,'" title="').concat(n.name,'" class="xGsec9lFd">'):c.startsWith("video/")?'<video tabindex="0" src="'.concat(t,'" title="').concat(n.name,'" controlslist="nodownload" controls class="xGsec9lFd">'):c.startsWith("audio/")?'<audio tabindex="0" src="'.concat(t,'" title="').concat(n.name,'" controlslist="nodownload" controls class="xGsec9lFd">'):'I just uploaded a file "'.concat(n.name,'", <a href="').concat(t,'" class="x0ciSQShX" target="_blank">Download</a>'),l=f(h(ea,"chats",j,"messages")),e.next=12,p(l,{sender:H,content:o,timestamp:Date.now()});case 12:Z(o,l.id),P.fileInput.value="";case 14:case"end":return e.stop()}},e)})));case 42:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()})();
