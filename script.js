import{initializeApp as t}from"https://www.gstatic.com/firebasejs/9.0.2/firebase-app.js";import{getAuth as e,signInWithPopup as n,GoogleAuthProvider as a,onAuthStateChanged as r,signInWithEmailAndPassword as i,signOut as o}from"https://www.gstatic.com/firebasejs/9.0.2/firebase-auth.js";import{getStorage as s,ref as c,uploadBytesResumable as l,getDownloadURL as d}from"https://www.gstatic.com/firebasejs/9.0.2/firebase-storage.js";import{getFirestore as u,collection as p,setDoc as h,doc as f,getDoc as v,getDocs as m,startAfter as g,onSnapshot as $,query as y,orderBy as x,limit as b}from"https://www.gstatic.com/firebasejs/9.0.2/firebase-firestore.js";(()=>{function _(t){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function w(){"use strict";w=function(){return e};var t,e={},n=Object.prototype,a=n.hasOwnProperty,r=Object.defineProperty||function(t,e,n){t[e]=n.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function l(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(d){l=function(t,e,n){return t[e]=n}}function u(e,n,a,i){var o,s,c,l,d=Object.create((n&&n.prototype instanceof g?n:g).prototype);return r(d,"_invoke",{value:(o=e,s=a,c=new S(i||[]),l=h,function(e,n){if(l===f)throw Error("Generator is already running");if(l===v){if("throw"===e)throw n;return{value:t,done:!0}}for(c.method=e,c.arg=n;;){var a=c.delegate;if(a){var r=A(a,c);if(r){if(r===m)continue;return r}}if("next"===c.method)c.sent=c._sent=c.arg;else if("throw"===c.method){if(l===h)throw l=v,c.arg;c.dispatchException(c.arg)}else"return"===c.method&&c.abrupt("return",c.arg);l=f;var i=p(o,s,c);if("normal"===i.type){if(l=c.done?v:"suspendedYield",i.arg===m)continue;return{value:i.arg,done:c.done}}"throw"===i.type&&(l=v,c.method="throw",c.arg=i.arg)}})}),d}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(a){return{type:"throw",arg:a}}}e.wrap=u;var h="suspendedStart",f="executing",v="completed",m={};function g(){}function $(){}function y(){}var x={};l(x,o,function(){return this});var b=Object.getPrototypeOf,L=b&&b(b(D([])));L&&L!==n&&a.call(L,o)&&(x=L);var C=y.prototype=g.prototype=Object.create(x);function k(t){["next","throw","return"].forEach(function(e){l(t,e,function(t){return this._invoke(e,t)})})}function E(t,e){var n;r(this,"_invoke",{value:function(r,i){function o(){return new e(function(n,o){!function n(r,i,o,s){var c=p(t[r],t,i);if("throw"!==c.type){var l=c.arg,d=l.value;return d&&"object"==_(d)&&a.call(d,"__await")?e.resolve(d.__await).then(function(t){n("next",t,o,s)},function(t){n("throw",t,o,s)}):e.resolve(d).then(function(t){l.value=t,o(l)},function(t){return n("throw",t,o,s)})}s(c.arg)}(r,i,n,o)})}return n=n?n.then(o,o):o()}})}function A(e,n){var a=n.method,r=e.iterator[a];if(r===t)return n.delegate=null,"throw"===a&&e.iterator.return&&(n.method="return",n.arg=t,A(e,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=TypeError("The iterator does not provide a '"+a+"' method")),m;var i=p(r,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,m;var o=i.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,m):o:(n.method="throw",n.arg=TypeError("iterator result is not an object"),n.delegate=null,m)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function D(e){if(e||""===e){var n=e[o];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function n(){for(;++r<e.length;)if(a.call(e,r))return n.value=e[r],n.done=!1,n;return n.value=t,n.done=!0,n};return i.next=i}}throw TypeError(_(e)+" is not iterable")}return $.prototype=y,r(C,"constructor",{value:y,configurable:!0}),r(y,"constructor",{value:$,configurable:!0}),$.displayName=l(y,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===$||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,l(t,c,"GeneratorFunction")),t.prototype=Object.create(C),t},e.awrap=function(t){return{__await:t}},k(E.prototype),l(E.prototype,s,function(){return this}),e.AsyncIterator=E,e.async=function(t,n,a,r,i){void 0===i&&(i=Promise);var o=new E(u(t,n,a,r),i);return e.isGeneratorFunction(n)?o:o.next().then(function(t){return t.done?t.value:o.next()})},k(C),l(C,c,"Generator"),l(C,o,function(){return this}),l(C,"toString",function(){return"[object Generator]"}),e.keys=function(t){var e=Object(t),n=[];for(var a in e)n.push(a);return n.reverse(),function t(){for(;n.length;){var a=n.pop();if(a in e)return t.value=a,t.done=!1,t}return t.done=!0,t}},e.values=D,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var n in this)"t"===n.charAt(0)&&a.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(a,r){return s.type="throw",s.arg=e,n.next=a,r&&(n.method="next",n.arg=t),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var c=a.call(o,"catchLoc"),l=a.call(o,"finallyLoc");if(c&&l){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=e,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),I(n),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var a=n.completion;if("throw"===a.type){var r=a.arg;I(n)}return r}}throw Error("illegal catch attempt")},delegateYield:function(e,n,a){return this.delegate={iterator:D(e),resultName:n,nextLoc:a},"next"===this.method&&(this.arg=t),m}},e}function L(t,e,n,a,r,i,o){try{var s=t[i](o),c=s.value}catch(l){return void n(l)}s.done?e(c):Promise.resolve(c).then(a,r)}function C(t){return function(){var e=this,n=arguments;return new Promise(function(a,r){var i=t.apply(e,n);function o(t){L(i,a,r,o,s,"next",t)}function s(t){L(i,a,r,o,s,"throw",t)}o(void 0)})}}function k(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}function E(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,I(a.key),a)}}function A(t,e,n){return e&&E(t.prototype,e),n&&E(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function T(t,e,n){return(e=I(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function I(t){var e=function(t){if("object"!=_(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=_(n))return n;throw TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==_(e)?e:e+""}var S,D,H,R=A(function t(e){var n=this;k(this,t),T(this,"_handleKeyDown",function(t){27===t.keyCode&&(n.close(),n.trigger.focus())}),this.Root=document.createElement("div"),this.Overlay=document.createElement("div"),this.Content=document.createElement("div"),this.trigger=e;var a=this.trigger.getBoundingClientRect();this.Content.style.left=a.left+"px",this.Content.style.top=a.top+a.height+"px",this.Root.classList.add("xEHCrF5Oe"),this.Overlay.classList.add("overlay"),this.Content.classList.add("xC3Uih0ex"),this.Root.setAttribute("data-state","open"),this.Root.setAttribute("role","dialog"),this.Root.setAttribute("aria-modal","true"),document.body.appendChild(this.Root),this.Root.appendChild(this.Overlay),this.Root.appendChild(this.Content),this.hidden_elements=document.querySelectorAll("body > *:not(.xEHCrF5Oe, script, [hidden])"),this.hidden_elements.forEach(function(t){t.setAttribute("inert","true")}),this.Overlay.addEventListener("click",function(){return n.close()}),document.addEventListener("keydown",this._handleKeyDown)},[{key:"_removeListeners",value:function(){document.removeEventListener("keydown",this._handleKeyDown)}},{key:"close",value:function(){var t=this;this._removeListeners(),this.hidden_elements.forEach(function(t){t.removeAttribute("inert")}),this.Root.setAttribute("data-state","closed"),setTimeout(function(){t.Root.remove()},100)}}]),M=A(function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=n.closeOnOverlayClick,r=n.closeOnEsc;k(this,t),T(this,"_handleOverlayClick",function(){e.close(),e._removeListeners()}),T(this,"_handleKeyDown",function(t){27===t.keyCode&&(e.close(),e._removeListeners())}),this.Root=document.createElement("div"),this.Overlay=document.createElement("div"),this.Content=document.createElement("div"),this.Root.classList.add("x54SkYRT0"),this.Root.setAttribute("data-state","open"),this.Overlay.classList.add("overlay"),this.Content.classList.add("content"),this.Root.appendChild(this.Overlay),this.Root.appendChild(this.Content),this.Root.setAttribute("role","dialog"),this.Root.setAttribute("aria-modal","true"),this.Root.onwheel=function(t){t.ctrlKey&&t.preventDefault()},this.hidden_elements=document.querySelectorAll("body > *:not(.x54SkYRT0, script, style, [hidden])"),this.hidden_elements.forEach(function(t){t.setAttribute("inert","true")}),document.body.appendChild(this.Root),this.Root.classList.add("show"),void 0!==a&&a&&this.Overlay.addEventListener("click",this._handleOverlayClick),void 0!==r&&r&&document.addEventListener("keydown",this._handleKeyDown)},[{key:"_removeListeners",value:function(){this.Overlay.onclick=null,document.removeEventListener("keydown",this._handleKeyDown)}},{key:"close",value:function(){var t=this;this.hidden_elements.forEach(function(t){t.removeAttribute("inert")}),this.Root.setAttribute("data-state","closed"),setTimeout(function(){t.Root.remove()},100)}}]),O=function(t){return document.querySelector(t)},B=/(Android|webOS|Windows Phone|iPhone|iPod|iPad)/i.test(window.navigator.platform)||window.innerWidth<500,j="",Y=!1,K=0,P={activitybar:O(".activitybar"),sidebar:O(".sidebar"),main:O(".main"),messageInput:O(".xtsARDHTI"),searchInput:O(".xujXllYgW"),messageArea:O(".xikyLwDf4"),sendButton:O(".xuwRtDpu4"),fileInput:O(".xVEJA40Qh"),actionModalContent:O(".x54SkYRT0"),actionModal:O(".x54SkYRT0"),actionModalTitle:O(".x54SkYRT0 .xrYn5ZY3v"),actionModalSubtitle:O(".xWDUelLWA"),actionModalOverlay:O(".x54SkYRT0 .overlay"),actionModalIcon:O(".x3DtTJteF"),signOutBtn:O(".xlifWPlRj#x8Kzd47QX"),directionsBtn:O(".xlifWPlRj#x93dGr74c")},G=["幹","操","草","白癡","智障","死","笨蛋","傻逼"],z=800,W=!1,F=!1;function N(){return Z.apply(this,arguments)}function Z(){return(Z=C(w().mark(function t(){var e,n;return w().wrap(function(t){for(var a;;)switch(t.prev=t.next){case 0:if((e=P.messageInput.innerText.trim())&&!(e.length>z)&&j){t.next=3;break}return t.abrupt("return");case 3:return e=X(U((a=e.replace(/&([^;]+)/g,"&amp;$1").replaceAll("<","&lt;").replaceAll(">","&gt;").replace(/(\r?\n){3,}/g,"\n\n")).replace(/https?:\/\/[^\s/$.?#].[^\s]*/g,function(t){return'<a class="x0ciSQShX" href="'.concat(t,'" target="_blank" rel="noreferrer noopener">').concat(decodeURIComponent(t),"</a>")})).replaceAll("\n","<br>")),P.messageInput.innerHTML="",n=f(p(ti,"chats",j,"messages")),t.next=8,h(n,{senderUID:D,sender:H,content:e,timestamp:Date.now()});case 8:q(e,n.id);case 9:case"end":return t.stop()}},t)}))).apply(this,arguments)}function q(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=document.createElement("div"),r=document.createElement("div"),i=document.createElement("div"),o=document.createElement("div"),s=document.createElement("div"),c=document.createElement("div");if(a.setAttribute("data-mid",e),c.classList.add("xRHoYYwoZ"),r.classList.add("xMyW2iRSH"),a.classList.add("xVC8gtuyS"),a.classList.add("xiOw4dg0O"),i.classList.add("xKljxgVJA"),o.classList.add("xu4Celbbq"),s.classList.add("xc4iCj2Gy"),a.appendChild(i),i.appendChild(c),c.appendChild(o),o.appendChild(s),c.appendChild(r),s.innerHTML="You",r.innerHTML=t,n)P.messageArea.appendChild(a),P.messageArea.scrollTo({top:P.messageArea.scrollHeight,behavior:"smooth"});else{var l=P.messageArea.firstChild;P.messageArea.insertBefore(a,l)}}function V(t,e,n,a){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=document.createElement("div"),o=document.createElement("div"),s=document.createElement("div"),c=document.createElement("div"),l=document.createElement("div"),d=document.createElement("div"),u=document.createElement("div"),p=document.createElement("div");if(document.createElement("img"),p.classList.add("xRHoYYwoZ"),o.classList.add("xMyW2iRSH"),i.classList.add("xVC8gtuyS"),s.classList.add("xSYcbYqTG"),c.classList.add("xKljxgVJA"),l.classList.add("xu4Celbbq"),d.classList.add("xc4iCj2Gy"),u.classList.add("xt8fROB2L"),u.innerText=a,i.setAttribute("data-mid",e),i.appendChild(s),i.appendChild(c),c.appendChild(p),p.appendChild(l),l.appendChild(d),l.appendChild(u),p.appendChild(o),d.innerText=n||"未知",o.innerHTML=t,r)P.messageArea.appendChild(i),P.messageArea.scrollTo({top:P.messageArea.scrollHeight,behavior:"smooth"});else{var h=P.messageArea.firstChild;P.messageArea.insertBefore(i,h)}}function U(t){return t.replace(/^\s*[-]{10,}\s*\n?/gm,'<div class="x3nWNfdWy horizontal"></div>')}function Q(t){return t.replace(/&([^;]+)/g,"&amp;$1").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll(" ","&nbsp;").replaceAll("\n","<br>")}j=void 0,document.addEventListener("visibilitychange",function(){"visible"===document.visibilityState&&(document.title="Structure",Y&&navigator.clearAppBadge(),K=0)}),P.messageInput.addEventListener("input",function(t){""===t.target.innerText.trim()&&(t.target.innerHTML="")}),P.messageInput.addEventListener("keydown",function(t){switch(t.keyCode){case 13:B||t.shiftKey||(t.preventDefault(),N());break;case 85:case 66:t.ctrlKey&&t.preventDefault()}}),B&&document.body.classList.add("mobile"),"setAppBadge"in navigator&&"clearAppBadge"in navigator&&(Y=!0),P.sendButton.onclick=N,P.sendButton.onkeydown=function(t){13===t.keyCode&&N()},P.messageInput.onpaste=function(t){t.preventDefault(),document.execCommand("insertHTML",!0,Q((t.clipboardData||window.Clipboard).getData("text/plain")))},document.onkeydown=function(t){switch(t.keyCode){case 191:"true"===P.messageInput.getAttribute("contenteditable")&&document.activeElement!==P.messageInput&&document.activeElement!==P.searchInput&&(t.preventDefault(),P.messageInput.focus());break;case 75:t.ctrlKey&&W&&(t.preventDefault(),P.searchInput.focus());break;case 123:t.preventDefault();break;case 67:t.ctrlKey&&t.shiftKey&&t.preventDefault();break;case 85:case 79:case 187:case 189:case 80:case 83:case 109:case 107:t.ctrlKey&&t.preventDefault();break;case 37:case 39:t.altKey&&t.preventDefault()}},document.querySelectorAll("body > div").forEach(function(t){t.onwheel=function(t){t.ctrlKey&&t.preventDefault()}}),document.oncontextmenu=function(t){t.preventDefault()},O(".xehdiGgBv .xMyenRl7K .x8JU9DbQZ").onclick=function(){j="",O(".main").classList.remove("x8VAGH6N2"),P.messageInput.innerHTML="",P.messageInput.setAttribute("contenteditable","false"),P.messageInput.setAttribute("tabindex","-1"),P.sendButton.setAttribute("tabindex","-1")},document.addEventListener("touchstart",function(t){t.touches&&t.touches.length>1&&t.preventDefault()},{passive:!1});var J=0;function X(t){var e=RegExp(G.map(function(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}).join("|"),"gi");return t.replace(e,function(t){return"*".repeat(t.length)})}function tt(t,e,n,a){var r,i,o=document.createElement("div"),s=document.createElement("div"),c=document.createElement("div"),l=document.createElement("div"),d=document.createElement("div"),u=document.createElement("div");o.setAttribute("tabindex","0"),o.classList.add("x2fP9fkxS"),d.classList.add("x6HyfOZS7"),u.classList.add("xQkxrD9ZA"),$(p(ti,"chats",r=e,"messages"),function(t){t.docChanges().forEach(function(t){if(j===r){var e,n=t.doc.data();switch(t.type){case"added":n.senderUID!==D&&("hidden"===document.visibilityState&&(K++,document.title="(".concat(K,") Structure"),Y&&navigator.setAppBadge(K)),V(n.content,t.doc.id,n.sender,"Now"));break;case"removed":try{(e=O('.xikyLwDf4 .xVC8gtuyS[data-mid="'.concat(t.doc.id,'"]'))).classList.add("deleted"),e.innerHTML="This message has been deleted"}catch(a){console.log("發生未知錯誤",a)}break;case"modified":try{(e=O('.xikyLwDf4 .xVC8gtuyS[data-mid="'.concat(t.doc.id,'"] .xMyW2iRSH'))).innerHTML=n.content}catch(i){console.log("發生未知錯誤",i)}}}})},function(t){console.error("監聽錯誤:",t)});var h=(i=C(w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:(j!==e||B)&&(S=void 0,td(j=e),P.messageArea.innerHTML="",P.sendButton.classList.remove("disabled"),P.fileInput.removeAttribute("disabled"),O(".xpbRox0hO").classList.remove("disabled"),O(".xpbRox0hO").tabIndex="0",P.messageInput.setAttribute("contenteditable","true"),B||(O(".x2fP9fkxS.active")&&O(".x2fP9fkxS.active").classList.remove("active"),O(".x2fP9fkxS.interim:not(.active)")&&O(".x2fP9fkxS.interim:not(.active)").remove(),o.classList.add("active")),B&&O(".xehdiGgBv .xMyenRl7K .x8JU9DbQZ").setAttribute("tabindex","0"),O(".main").classList.add("x8VAGH6N2"),O(".xvwhg72ii").innerText=o.getAttribute("data-roomName"),P.messageInput.setAttribute("contenteditable","true"),P.messageInput.setAttribute("tabindex","0"),P.sendButton.setAttribute("tabindex","0"));case 1:case"end":return t.stop()}},t)})),function(){return i.apply(this,arguments)});o.onclick=function(){h()},o.onkeydown=function(t){13===t.keyCode&&h()},o.setAttribute("data-roomid",e),o.setAttribute("data-roomname",t),o.appendChild(s),o.appendChild(d),d.appendChild(u),u.tabIndex="0";var f,v,m=function(){new R(u).Content.innerHTML='\n		<div class="xrQdSHI2A" style="color: rgb(112, 184, 255);">Invite People</div>\n		<div class="xrQdSHI2A">Privacy Settings</div>\n		<div class="xcoXgMpFW"></div>\n		<div class="xrQdSHI2A" style="color: rgb(239, 68, 68);">Leave</div>\n		'};u.onkeydown=function(t){t.stopPropagation(),13===t.keyCode&&m()},u.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n	<circle cx="12" cy="12" r="1" /><circle cx="12" cy="5" r="1" /><circle cx="12" cy="19" r="1" /></svg>',u.onclick=function(t){t.stopPropagation(),m()},s.classList.add("xQ65c0Nkc"),c.classList.add("xybvM5cRF"),s.appendChild(c),c.innerText=t,l.classList.add("xT3Ta8vKw"),f=n||(0===a?"No message":"".concat((v=a).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")," messages")),l.innerHTML='\n		<span class="x97KBA8qs">'.concat(f,"</span>\n	"),s.appendChild(l),O(".xemr1y6ie").appendChild(o)}function te(t){var e=Math.floor((Date.now()-t)/1e3);return e<60?"".concat(e,"second ago"):e<3600?"".concat(Math.floor(e/60)," minute ago"):e<86400?"".concat(Math.floor(e/3600)," hour ago"):e<2592e3?"".concat(Math.floor(e/86400)," day ago"):e<31536e3?"".concat(Math.floor(e/2592e3)," month ago"):"".concat(Math.floor(e/31536e3)," year ago")}function tn(t){for(var e=["B","KB","MB","GB","TB","PB"],n=t,a=0;n>=1024&&a<e.length-1;)n/=1024,a++;return"".concat(n.toFixed(2)," ").concat(e[a])}document.addEventListener("touchend",function(t){var e=(new Date).getTime();e-J<=300&&t.preventDefault(),J=e},!1),document.addEventListener("gesturestart",function(t){t.preventDefault()}),P.messageInput.addEventListener("drop",function(t){t.preventDefault();var e=t.dataTransfer.getData("text/plain");try{t.target.focus(),document.execCommand("insertHTML",!0,Q(e))}catch(n){}}),P.searchInput.oninput=function(t){document.querySelectorAll(".x8FrVw7Ca .x2fP9fkxS").forEach(function(e){e.getAttribute("data-roomname").toLowerCase().includes(t.target.value.toLowerCase())?e.classList.remove("hide"):e.classList.add("hide")})},O(".x8u3Iqtu9").onclick=function(){P.searchInput.focus()},P.messageInput.oncopy=function(t){t.preventDefault();var e=window.getSelection().toString();t.clipboardData.setData("text/plain",e)},P.messageArea.addEventListener("scroll",function(){0===(P.messageArea.pageYOffset||P.messageArea.scrollTop)&&function(t){tl.apply(this,arguments)}(j)});var ta,tr=t({apiKey:"AIzaSyAp73V5ZsBUtpy4kS3-QyGirGSpz71DPWo",authDomain:"smiling-theory-397204.firebaseapp.com",databaseURL:"https://smiling-theory-397204-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"smiling-theory-397204",storageBucket:"smiling-theory-397204.appspot.com",messagingSenderId:"360479398694",appId:"1:360479398694:web:05b7df5ce277f89ea8ffe7",measurementId:"G-6BKTT1K7D1"}),ti=u(tr),to=s(tr);function ts(t,e,n){return tc.apply(this,arguments)}function tc(){return(tc=C(w().mark(function t(e,n,a){var r;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,m(p(ti,"chats",a,"messages"));case 2:tt(e,a,n,(r=t.sent).size);case 4:case"end":return t.stop()}},t)}))).apply(this,arguments)}function tl(){return(tl=C(w().mark(function t(e){var n,a;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,void 0===S){t.next=10;break}return t.next=4,m(y(p(ti,"chats",e,"messages"),x("timestamp","desc"),g(S),b(10)));case 4:S=10===(n=t.sent).docs.length?n.docs[9]:void 0,n.forEach(function(t){var e=t.data();e.senderUID===D?q(e.content,t.id,!1):V(e.content,t.id,e.sender,te(e.timestamp),!1)}),a=P.messageArea.scrollHeight,P.messageArea.scrollTop=a-ta,ta=a;case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(0),console.error("Error fetching messages: ",t.t0);case 15:case"end":return t.stop()}},t,null,[[0,12]])}))).apply(this,arguments)}function td(t){return tu.apply(this,arguments)}function tu(){return(tu=C(w().mark(function t(e){var n,a;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,m(y(p(ti,"chats",e,"messages"),x("timestamp","desc"),b(10)));case 2:(n=t.sent).docs[9]&&(S=n.docs[9]),a=[],n.forEach(function(t){a.push(t)}),a.reverse(),a.forEach(function(t){var e=t.data();e.senderUID===D?q(e.content,t.id):V(e.content,t.id,e.sender,te(e.timestamp))}),ta=P.messageArea.scrollHeight;case 7:case"end":return t.stop()}},t)}))).apply(this,arguments)}window.onload=C(w().mark(function t(){var e,n,a,r,i,o,s;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e=new URLSearchParams(window.location.search).get("join"))){t.next=7;break}return n=f(ti,"chats",e),t.next=5,v(n);case 5:(a=t.sent).exists()?-1!==a.data().members.indexOf(D)?console.log("你他媽已經加入了!"):(r=a.data(),i=new M({closeOnEsc:!0,closeOnOverlayClick:!0}),"public"===r.mode?i.Content.innerHTML="<h2>請求加入：".concat(r.name,"</h2><p>成員數：").concat(r.members.length,"</p>"):i.Content.innerHTML="<h2>無法直接加入</h2>"):console.log("無法加入");case 7:return t.next=9,m(p(ti,"chats"));case 9:o=t.sent,s=0,O(".xemr1y6ie .spinner").remove(),o.forEach(function(t){var e=t.data();-1!==e.members.indexOf(D)&&(s++,ts(e.name,e.description,t.id))}),0===s&&(O(".xemr1y6ie").innerHTML='<div class="xZYFExNlg">There\'s nothing here yet</div>');case 14:case"end":return t.stop()}},t)}));var tp=new a,th=e();function tf(){var t=document.createElement("div");t.classList.add("xrYn5ZY3v"),t.innerText="Account Login";var e=document.createElement("div");e.classList.add("xRRuA0Z3S");var r=document.createElement("div");r.id="x7BYgkdiJ",r.tabIndex="0",r.innerHTML='<svg class="xGBqJjpdr" viewBox="0 0 20 20">\n	<path d="M19.6 10.23c0-.82-.1-1.42-.25-2.05H10v3.72h5.5c-.15.96-.74 2.31-2.04 3.22v2.45h3.16c1.89-1.73 2.98-4.3 2.98-7.34z" fill=#4285F4></path>\n	<path d="M13.46 15.13c-.83.59-1.96 1-3.46 1-2.64 0-4.88-1.74-5.68-4.15H1.07v2.52C2.72 17.75 6.09 20 10 20c2.7 0 4.96-.89 6.62-2.42l-3.16-2.45z" fill=#34A853></path>\n	<path d="M3.99 10c0-.69.12-1.35.32-1.97V5.51H1.07A9.973 9.973 0 000 10c0 1.61.39 3.14 1.07 4.49l3.24-2.52c-.2-.62-.32-1.28-.32-1.97z" fill=#FBBC05></path>\n	<path d="M10 3.88c1.88 0 3.13.81 3.85 1.48l2.84-2.76C14.96.99 12.7 0 10 0 6.09 0 2.72 2.25 1.07 5.51l3.24 2.52C5.12 5.62 7.36 3.88 10 3.88z" fill=#EA4335></path></svg>\n	<div>Sign in with Google</div>';var o=document.createElement("div");o.tabIndex="0",o.id="xBnuWNG6V",o.className="actionbtn xYIKBnbHS",r.className="actionbtn xYIKBnbHS",o.innerHTML='<svg class=xGBqJjpdr viewBox="0 0 20 20">\n	<path d="M1 5.006A2 2 0 012.995 3h14.01A2 2 0 0119 5.006v9.988A2 2 0 0117.005 17H2.995A2 2 0 011 14.994V5.006zM3 5l7 4 7-4v2l-7 4-7-4V5z" fill-rule=evenodd fill=#788aa2></path>\n	</svg>\n	<div>Sign in with email</div>',e.appendChild(r),e.appendChild(o);var s=new M;s.Content.classList.add("bt"),s.Content.appendChild(t),s.Content.appendChild(e),r.onclick=function(){n(th,tp).then(function(t){a.credentialFromResult(t).accessToken;var e=t.user;D=e.uid,H=e.displayName,s.Content.innerHTML='<div class="xJ0pEZGEO">Successfully logged in to Google account</div>\n						<div class="xDmLoXo3E">\n						<img class="xm7NzrczQ" draggable="false" src="'.concat(e.photoURL,'" alt="avatar"/>\n						<div class="xDLBHn55v"><div class="xQ6IT8O6S">').concat(e.displayName,'</div>\n						<div class="xPnpcvswL">').concat(e.email,"</div></div></div>"),s.Overlay.onclick=function(){s.close()}}).catch(function(t){a.credentialFromError(t),console.log(t.code,t.message)})},o.onclick=function(){var t=new M({closeOnEsc:!0,closeOnOverlayClick:!0}),e=document.createElement("div");e.classList.add("xrYn5ZY3v"),e.innerText="Account Login",t.Content.appendChild(e);var n=document.createElement("div");n.classList.add("xZdL9CF5M"),t.Content.appendChild(n);var a=document.createElement("input");a.placeholder="Email",a.autocomplete="off",a.type="text",a.autocomplete="off",a.spellcheck="false",n.appendChild(a);var r=document.createElement("input");r.placeholder="Password",r.type="password",r.autocomplete="off",n.appendChild(r);var o=document.createElement("div");o.classList.add("xw0IanPrC"),n.appendChild(o);var c=document.createElement("div");c.innerText="Login",c.tabIndex="0",c.classList.add("x40AApYkW"),n.appendChild(c),a.focus();var l=!0,d=function(e){console.log(e),l&&(l=!1,o.classList.remove("show"),c.innerHTML='\n			<svg class="x3xXCjYFp" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n			<path d="M21 12a9 9 0 1 1-6.219-8.56"/>\n			</svg>',a.disabled=!0,r.disabled=!0,c.classList.add("disabled"),c.tabIndex="-1",c.blur(),i(th,a.value,r.value).then(function(e){try{s.close(),t.close()}catch(n){}var a=e.user;console.log("用户已登录:",a)}).catch(function(t){setTimeout(function(){var e=t.code;o.classList.add("show"),"auth/invalid-login-credentials"===e?o.innerText="Invalid Login Credentials":"auth/invalid-email"===e?o.innerText="Invalid Email":"auth/network-request-failed"===e&&(o.innerText="Network Request Failed"),c.innerHTML="Login",c.classList.remove("disabled"),c.tabIndex="0",a.disabled=!1,r.disabled=!1,l=!0},3e3)}))};c.onclick=function(){d()},a.onkeydown=function(){13===event.keyCode&&r.focus()},[c,r].forEach(function(t){t.onkeydown=function(t){13===t.keyCode&&d()}})}}window.auth=th,r(th,function(t){t?(D=t.uid,H=t.displayName,function(){if(!1===F){P.searchInput.removeAttribute("disabled"),P.searchInput.setAttribute("tabindex","0"),P.messageArea.classList.remove("xVjpzmyej"),O(".xnKzgeITl")&&O(".xnKzgeITl").remove();var t=(new Date).getHours();V("Good {dl} and welcome back. Let's start the chatting now".replace("{dl}",t>=5&&t<11?"morning":t>=11&&t<14?"afternoon":t>=14&&t<18?"evening":"night"),"0","Stranger.",te(17040384e5)),F=!0,W=!0}}()):(D="",tf())}),P.signOutBtn.onclick=function(){o(th).then(function(){console.log("User signed out")}).catch(function(t){console.error("Sign out error",t)})},P.directionsBtn.onclick=function(){var t=new M({closeOnEsc:!0,closeOnOverlayClick:!0});t.Content.classList.add("lg");var e=document.createElement("div"),n=document.createElement("div");e.classList.add("xrYn5ZY3v"),n.classList.add("xWDUelLWA"),e.innerText="Settings",e.classList.add("lf"),n.innerHTML='\n	<div class="xtTvvWnjq">\n		<span class="xIzeE22ru">Allow notifications</span>\n		<input type="checkbox" class="cls-switch">\n	</div>\n	<div class="xtTvvWnjq">\n		<span class="xIzeE22ru">Theme</span>\n		<select class="cls-select">\n			<option>Dark</option>\n			<option>Light</option>\n			<option selected>System</option>\n		</select>\n	</div>\n	<div class="xtTvvWnjq">\n		<span class="xIzeE22ru">Language</span>\n		<select class="cls-select">\n			<option>English</option>\n			<option>简体中文</option>\n			<option>繁體中文</option>\n			<option>日本語</option>\n			<option>한국어</option>\n			<option>Deutsch</option>\n			<option>Espa\xf1ol</option>\n			<option>العربية</option>\n		</select>\n	</div>\n	',t.Content.appendChild(e),t.Content.appendChild(n)},P.fileInput.onchange=function(t){var e=t.target.files[0],n=new M;n.Content.classList.add("bt");var a=document.createElement("div");a.classList.add("xrYn5ZY3v");var r=document.createElement("div");if(r.classList.add("xb1IsDa6e"),n.Content.appendChild(a),n.Content.appendChild(r),e){if(e.size/1024/1024>5)return a.innerText="This file is too large",r.innerText="This file is ".concat(tn(e.size),", we can't afford it."),void(n.Overlay.onclick=function(){n.close()});var i=c(to,"uploads/"+e.name);a.innerText="Uploading",r.innerText="This may take a while, please be patient...";var o=document.createElement("div");o.classList.add("xCECpHDwZ"),n.Content.appendChild(o);var s=document.createElement("div");s.classList.add("xty9qDHrl"),o.appendChild(s);var u=document.createElement("div");u.classList.add("xIEj1ZAnA"),u.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n								<path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"></path>\n								<path d="M14 2v4a2 2 0 0 0 2 2h4"></path>\n							</svg>',s.appendChild(u);var v=document.createElement("div");v.classList.add("xxs4n9nhX"),s.appendChild(v),v.innerHTML='<div class="xTGGn7ABj">'.concat(e.name,'</div><div class="xtyaQiCLO">').concat(tn(e.size),"</div>"),s.appendChild(v);var m=document.createElement("div");m.classList.add("xsoLox5sj"),s.appendChild(m);var g=document.createElement("div");g.classList.add("xk0osKWCK"),m.appendChild(g);var $=l(i,e);$.on("state_changed",function(t){var e=t.bytesTransferred/t.totalBytes*100;g.style.width="".concat(e,"%"),console.log("Upload is "+e+"% done")},function(t){console.error(t)},C(w().mark(function t(){var i,s,c;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n.Overlay.onclick=function(){n.close()},o.remove(),a.innerText="Complete upload",r.innerText="This file has been uploaded successfully",t.next=6,d($.snapshot.ref);case 6:return i=t.sent,s='I just uploaded a file "'.concat(e.name,'", <a href="').concat(i,'" class="x0ciSQShX" target="_blank">Download</a>'),c=f(p(ti,"chats",j,"messages")),t.next=11,h(c,{senderUID:D,sender:H,content:s,timestamp:Date.now()});case 11:q(s,c.id),P.fileInput.value="";case 13:case"end":return t.stop()}},t)})))}}})();
