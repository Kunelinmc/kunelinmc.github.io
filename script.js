/**release 2.11.4 (update)*/
import{initializeApp as e}from"https://www.gstatic.com/firebasejs/9.0.2/firebase-app.js";import{getAuth as t,signInWithPopup as n,GoogleAuthProvider as a,onAuthStateChanged as i,signInWithEmailAndPassword as s,signOut as r}from"https://www.gstatic.com/firebasejs/9.0.2/firebase-auth.js";import{getStorage as c,ref as o,uploadBytesResumable as l,getDownloadURL as d}from"https://www.gstatic.com/firebasejs/9.0.2/firebase-storage.js";import{getFirestore as u,collection as p,setDoc as v,doc as h,getDocs as f,startAfter as $,onSnapshot as m,query as g,orderBy as x,limit as _}from"https://www.gstatic.com/firebasejs/9.0.2/firebase-firestore.js";({987:function(){var b,y,L,C=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(i,s){function r(e){try{o(a.next(e))}catch(t){s(t)}}function c(e){try{o(a.throw(e))}catch(t){s(t)}}function o(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(r,c)}o((a=a.apply(e,t||[])).next())})},w=this&&this.__generator||function(e,t){var n,a,i,s,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function c(c){return function(o){return function(c){if(n)throw TypeError("Generator is already executing.");for(;s&&(s=0,c[0]&&(r=0)),r;)try{if(n=1,a&&(i=2&c[0]?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,a=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(!((i=(i=r.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){r=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){r.label=c[1];break}if(6===c[0]&&r.label<i[1]){r.label=i[1],i=c;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(c);break}i[2]&&r.ops.pop(),r.trys.pop();continue}c=t.call(e,r)}catch(o){c=[6,o],a=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,o])}}},k=function(){function e(e){var t=void 0===e?{}:e,n=t.closeOnOverlayClick,a=t.closeOnEsc,i=this;this._handleOverlayClick=function(){i.close(),i._removeListeners()},this._handleKeyDown=function(e){27===e.keyCode&&(i.close(),i._removeListeners())},this.dialogRoot=document.createElement("div"),this.dialogOverlay=document.createElement("div"),this.dialogContent=document.createElement("div"),this.dialogRoot.classList.add("x54SkYRT0"),this.dialogRoot.setAttribute("data-state","open"),this.dialogOverlay.classList.add("overlay"),this.dialogContent.classList.add("content"),this.dialogRoot.appendChild(this.dialogOverlay),this.dialogRoot.appendChild(this.dialogContent),document.body.appendChild(this.dialogRoot),this.dialogRoot.classList.add("show"),void 0!==n&&n&&this.dialogOverlay.addEventListener("click",this._handleOverlayClick),void 0!==a&&a&&document.addEventListener("keydown",this._handleKeyDown)}return e.prototype._removeListeners=function(){this.dialogOverlay.onclick=null,document.removeEventListener("keydown",this._handleKeyDown)},e.prototype.close=function(){var e=this;this.dialogRoot.setAttribute("data-state","closed"),setTimeout(function(){e.dialogRoot.remove()},100)},e}(),A=function(e){return document.querySelector(e)},E=/(Android|webOS|Windows Phone|iPhone|iPod|iPad)/i.test(window.navigator.platform)||window.innerWidth<550,T="",I=!1,D=0,M={activitybar:A(".activitybar"),sidebar:A(".sidebar"),main:A(".main"),messageInput:A(".xtsARDHTI"),searchInput:A(".xujXllYgW"),messageArea:A(".xikyLwDf4"),sendButton:A(".xuwRtDpu4"),fileInput:A(".xVEJA40Qh"),actionModalContent:A(".x54SkYRT0"),actionModal:A(".x54SkYRT0"),actionModalTitle:A(".x54SkYRT0 .xrYn5ZY3v"),actionModalSubtitle:A(".xWDUelLWA"),actionModalOverlay:A(".x54SkYRT0 .overlay"),actionModalIcon:A(".x3DtTJteF"),signOutBtn:A(".xlifWPlRj#x8Kzd47QX"),directionsBtn:A(".xlifWPlRj#x93dGr74c")},B=["幹","操","草","白癡","智障","死","笨蛋","傻逼"],H=!1,S=!1;function R(){return C(this,void 0,void 0,function(){var e,t;return w(this,function(n){var a,i,s,r;switch(n.label){case 0:return(e=M.messageInput.innerText.trim())&&!(e.length>800)?(e=(s=(i=(a=e.replace(/&([^;]+)/g,"&amp;$1").replaceAll("<","&lt;").replaceAll(">","&gt;").replace(/(\r?\n){3,}/g,"\n\n")).replace(/https?:\/\/[^\s/$.?#].[^\s]*/g,function(e){return'<a class="x0ciSQShX" href="'.concat(e,'" target="_blank" rel="noreferrer noopener">').concat(decodeURIComponent(e),"</a>")})).replace(/^\s*[-]{10,}\s*\n?/gm,'<div class="x3nWNfdWy horizontal"></div>').replaceAll("\n","<br>"),r=RegExp(B.map(function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}).join("|"),"gi"),s.replace(r,function(e){return"*".repeat(e.length)})),M.messageInput.innerHTML="",t=h(p(Z,"chats",T,"messages")),[4,v(t,{senderUID:y,sender:L,content:e,timestamp:Date.now()})]):[2];case 1:return n.sent(),j(e,t.id),[2]}})})}function j(e,t,n){void 0===n&&(n=!0);var a=document.createElement("div"),i=document.createElement("div"),s=document.createElement("div"),r=document.createElement("div"),c=document.createElement("div"),o=document.createElement("div");if(a.setAttribute("data-mid",t),o.classList.add("xRHoYYwoZ"),i.classList.add("xMyW2iRSH"),a.classList.add("xVC8gtuyS"),a.classList.add("xiOw4dg0O"),s.classList.add("xKljxgVJA"),r.classList.add("xu4Celbbq"),c.classList.add("xc4iCj2Gy"),a.appendChild(s),s.appendChild(o),o.appendChild(r),r.appendChild(c),o.appendChild(i),c.innerHTML="你",i.innerHTML=e,n)M.messageArea.appendChild(a),M.messageArea.scrollTo({top:M.messageArea.scrollHeight,behavior:"smooth"});else{var l=M.messageArea.firstChild;M.messageArea.insertBefore(a,l)}}function O(e,t,n,a,i){void 0===i&&(i=!0);var s=document.createElement("div"),r=document.createElement("div"),c=document.createElement("div"),o=document.createElement("div"),l=document.createElement("div"),d=document.createElement("div"),u=document.createElement("div"),p=document.createElement("div"),v=document.createElement("img");if(p.classList.add("xRHoYYwoZ"),r.classList.add("xMyW2iRSH"),s.classList.add("xVC8gtuyS"),c.classList.add("xSYcbYqTG"),o.classList.add("xKljxgVJA"),l.classList.add("xu4Celbbq"),d.classList.add("xc4iCj2Gy"),u.classList.add("xt8fROB2L"),u.innerText=a,s.setAttribute("data-mid",t),s.appendChild(c),s.appendChild(o),o.appendChild(p),p.appendChild(l),l.appendChild(d),l.appendChild(u),p.appendChild(r),c.appendChild(v),v.src="assets/avatar.png",d.innerText=n,r.innerHTML=e,i)M.messageArea.appendChild(s),M.messageArea.scrollTo({top:M.messageArea.scrollHeight,behavior:"smooth"});else{var h=M.messageArea.firstChild;M.messageArea.insertBefore(s,h)}}function Y(e){return e.replace(/&([^;]+)/g,"&amp;$1").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll(" ","&nbsp;").replaceAll("\n","<br>")}document.addEventListener("visibilitychange",function(){"visible"===document.visibilityState&&(document.title="Structure",I&&navigator.clearAppBadge(),D=0)}),M.messageInput.addEventListener("input",function(e){""===e.target.innerText.trim()&&(e.target.innerHTML="")}),M.messageInput.addEventListener("keydown",function(e){switch(e.keyCode){case 13:E||e.shiftKey||(e.preventDefault(),R());break;case 85:case 66:e.ctrlKey&&e.preventDefault()}}),E&&document.body.classList.add("mobile"),("setAppBadge"in navigator||"clearAppBadge"in navigator)&&(I=!0),M.sendButton.onclick=R,M.messageInput.onpaste=function(e){e.preventDefault(),document.execCommand("insertHTML",!0,Y((e.clipboardData||window.Clipboard).getData("text/plain")))},document.onkeydown=function(e){switch(e.keyCode){case 191:"true"===M.messageInput.getAttribute("contenteditable")&&document.activeElement!==M.messageInput&&document.activeElement!==M.searchInput&&(e.preventDefault(),M.messageInput.focus());break;case 75:e.ctrlKey&&H&&(e.preventDefault(),M.searchInput.focus());break;case 123:e.preventDefault();break;case 67:e.ctrlKey&&e.shiftKey&&e.preventDefault();break;case 85:case 79:case 187:case 189:case 80:case 83:case 109:case 107:e.ctrlKey&&e.preventDefault();break;case 37:case 39:e.altKey&&e.preventDefault()}},document.querySelectorAll("body > div").forEach(function(e){e.onwheel=function(e){e.ctrlKey&&e.preventDefault()}}),document.oncontextmenu=function(e){e.preventDefault()},A(".xehdiGgBv .xMyenRl7K .x8JU9DbQZ").onclick=function(){T="",A(".main").classList.remove("x8VAGH6N2"),M.messageInput.innerHTML="",M.messageInput.setAttribute("contenteditable","false"),M.messageInput.setAttribute("tabindex","-1"),M.sendButton.setAttribute("tabindex","-1")},document.addEventListener("touchstart",function(e){e.touches&&e.touches.length>1&&e.preventDefault()},{passive:!1});var K=0;function W(e){var t=Math.floor((Date.now()-e)/1e3);return t<60?"".concat(t,"秒"):t<3600?"".concat(Math.floor(t/60),"分鐘"):t<86400?"".concat(Math.floor(t/3600),"小時"):t<2592e3?"".concat(Math.floor(t/86400),"天"):t<31536e3?"".concat(Math.floor(t/2592e3),"個月"):"".concat(Math.floor(t/31536e3),"年前")}function z(e){for(var t=["B","KB","MB","GB","TB","PB"],n=e,a=0;n>=1024&&a<t.length-1;)n/=1024,a++;return"".concat(n.toFixed(2)," ").concat(t[a])}document.addEventListener("touchend",function(e){var t=(new Date).getTime();t-K<=300&&e.preventDefault(),K=t},!1),document.addEventListener("gesturestart",function(e){e.preventDefault()}),M.messageInput.addEventListener("drop",function(e){e.preventDefault();var t=e.dataTransfer.getData("text/plain");try{e.target.focus(),document.execCommand("insertHTML",!0,Y(t))}catch(n){console.log(n)}}),M.searchInput.oninput=function(e){document.querySelectorAll(".x8FrVw7Ca .x2fP9fkxS").forEach(function(t){t.getAttribute("data-roomname").toLowerCase().includes(e.target.value.toLowerCase())?t.classList.remove("hide"):t.classList.add("hide")})},A(".x8u3Iqtu9").onclick=function(){M.searchInput.focus()},M.messageInput.oncopy=function(e){e.preventDefault();var t=window.getSelection().toString();e.clipboardData.setData("text/plain",t)},M.messageArea.addEventListener("scroll",function(){0===(M.messageArea.pageYOffset||M.messageArea.scrollTop)&&function(e){C(this,void 0,void 0,function(){var t,n,a;return w(this,function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),void 0===b?[3,2]:[4,f(g(p(Z,"chats",e,"messages"),x("timestamp","desc"),$(b),_(10)))];case 1:b=10===(t=i.sent()).docs.length?t.docs[9]:void 0,t.forEach(function(e){var t=e.data();t.senderUID===y?j(t.content,e.id,!1):O(t.content,e.id,t.sender,W(t.timestamp),!1)}),n=M.messageArea.scrollHeight,M.messageArea.scrollTop=n-G,G=n,i.label=2;case 2:return[3,4];case 3:return a=i.sent(),console.error("Error fetching messages: ",a),[3,4];case 4:return[2]}})})}(T)});var G,V=e({apiKey:"AIzaSyAp73V5ZsBUtpy4kS3-QyGirGSpz71DPWo",authDomain:"smiling-theory-397204.firebaseapp.com",databaseURL:"https://smiling-theory-397204-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"smiling-theory-397204",storageBucket:"smiling-theory-397204.appspot.com",messagingSenderId:"360479398694",appId:"1:360479398694:web:05b7df5ce277f89ea8ffe7",measurementId:"G-6BKTT1K7D1"}),Z=u(V),q=c(V);window.onload=function(){return C(this,void 0,void 0,function(){var e,t;return w(this,function(n){switch(n.label){case 0:return[4,f(p(Z,"chats"))];case 1:return e=n.sent(),t=0,A(".xemr1y6ie .spinner").remove(),e.forEach(function(e){var n=e.data();-1!==n.members.indexOf(y)&&(t++,function(e,t,n){C(this,void 0,void 0,function(){var a;return w(this,function(i){switch(i.label){case 0:return[4,f(p(Z,"chats",n,"messages"))];case 1:return function(e,t,n,a){var i,s=this,r=document.createElement("div"),c=document.createElement("div"),o=document.createElement("div"),l=document.createElement("div");r.setAttribute("tabindex","0"),r.classList.add("x2fP9fkxS"),i=t,m(p(Z,"chats",i,"messages"),function(e){e.metadata.fromCache||e.docChanges().forEach(function(e){if(T===i){var t,n=e.doc.data();switch(e.type){case"added":n.senderUID!==y&&("hidden"===document.visibilityState&&(D++,document.title="(".concat(D,") Structure"),I&&navigator.setAppBadge(D)),O(n.content,e.doc.id,n.sender,"現在"));break;case"removed":try{(t=A('.xikyLwDf4 .xVC8gtuyS[data-mid="'.concat(e.doc.id,'"]'))).classList.add("deleted"),t.innerHTML="這則訊息已被刪除"}catch(a){console.log("發生未知錯誤",a)}break;case"modified":try{(t=A('.xikyLwDf4 .xVC8gtuyS[data-mid="'.concat(e.doc.id,'"] .xMyW2iRSH'))).innerHTML=n.content}catch(s){console.log("發生未知錯誤",s)}}}})},function(e){console.error("監聽錯誤:",e)});var d,u,v=function(){return C(s,void 0,void 0,function(){return w(this,function(e){return(T!==t||E)&&(b=void 0,function(e){C(this,void 0,void 0,function(){var t,n;return w(this,function(a){switch(a.label){case 0:return[4,f(g(p(Z,"chats",e,"messages"),x("timestamp","desc"),_(10)))];case 1:return(t=a.sent()).docs[9]&&(b=t.docs[9]),n=[],t.forEach(function(e){n.push(e)}),n.reverse(),n.forEach(function(e){var t=e.data();t.senderUID===y?j(t.content,e.id):O(t.content,e.id,t.sender,W(t.timestamp))}),G=M.messageArea.scrollHeight,[2]}})})}(T=t),M.messageArea.innerHTML="",M.sendButton.classList.remove("disabled"),M.fileInput.removeAttribute("disabled"),M.messageInput.setAttribute("contenteditable","true"),E||(A(".x2fP9fkxS.active")&&A(".x2fP9fkxS.active").classList.remove("active"),A(".x2fP9fkxS.interim:not(.active)")&&A(".x2fP9fkxS.interim:not(.active)").remove(),r.classList.add("active")),E&&A(".xehdiGgBv .xMyenRl7K .x8JU9DbQZ").setAttribute("tabindex","0"),A(".main").classList.add("x8VAGH6N2"),A(".xvwhg72ii").innerText=r.getAttribute("data-roomName"),M.messageInput.setAttribute("contenteditable","true"),M.messageInput.setAttribute("tabindex","0"),M.sendButton.setAttribute("tabindex","0")),[2]})})};r.onclick=function(){v()},r.onkeydown=function(e){13===e.keyCode&&v()},r.setAttribute("data-roomid",t),r.setAttribute("data-roomname",e),r.appendChild(c),c.classList.add("xQ65c0Nkc"),o.classList.add("xybvM5cRF"),c.appendChild(o),o.innerText=e,l.classList.add("xT3Ta8vKw"),d=n||(0===a?"暫無訊息":"".concat((u=a).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")," 則訊息")),l.innerHTML='\n		<span class="x97KBA8qs">'.concat(d,"</span>\n	"),c.appendChild(l),A(".xemr1y6ie").appendChild(r)}(e,n,t,(a=i.sent()).size),[2]}})})}(n.name,n.description,e.id))}),0===t&&(A(".xemr1y6ie").innerHTML='<div class="xZYFExNlg">尚未加入任何聊天室</div>'),[2]}})})};var P=new a,U=t();window.auth=U,i(U,function(e){var t,i,r,c,o;e?(y=e.uid,L=e.displayName,function(){if(!1===S){M.searchInput.removeAttribute("disabled"),M.searchInput.setAttribute("tabindex","0"),M.messageArea.classList.remove("xVjpzmyej"),A(".xnKzgeITl")&&A(".xnKzgeITl").remove();var e=(new Date).getHours();O("{dl}好，歡迎回來，現在就開始對話吧！".replace("{dl}",e>=5&&e<11?"早上":e>=11&&e<14?"中午":e>=14&&e<18?"下午":"晚安"),"0","陌生人","現在"),S=!0,H=!0}}()):(y="",(t=document.createElement("div")).classList.add("xrYn5ZY3v"),t.innerText="帳號登入",(i=document.createElement("div")).classList.add("xRRuA0Z3S"),(r=document.createElement("div")).id="x7BYgkdiJ",r.innerHTML='<svg class="xGBqJjpdr" viewBox="0 0 20 20">\n	<path d="M19.6 10.23c0-.82-.1-1.42-.25-2.05H10v3.72h5.5c-.15.96-.74 2.31-2.04 3.22v2.45h3.16c1.89-1.73 2.98-4.3 2.98-7.34z" fill=#4285F4></path>\n	<path d="M13.46 15.13c-.83.59-1.96 1-3.46 1-2.64 0-4.88-1.74-5.68-4.15H1.07v2.52C2.72 17.75 6.09 20 10 20c2.7 0 4.96-.89 6.62-2.42l-3.16-2.45z" fill=#34A853></path>\n	<path d="M3.99 10c0-.69.12-1.35.32-1.97V5.51H1.07A9.973 9.973 0 000 10c0 1.61.39 3.14 1.07 4.49l3.24-2.52c-.2-.62-.32-1.28-.32-1.97z" fill=#FBBC05></path>\n	<path d="M10 3.88c1.88 0 3.13.81 3.85 1.48l2.84-2.76C14.96.99 12.7 0 10 0 6.09 0 2.72 2.25 1.07 5.51l3.24 2.52C5.12 5.62 7.36 3.88 10 3.88z" fill=#EA4335></path></svg>\n	<div>使用 Google 登入</div>',(c=document.createElement("div")).id="xBnuWNG6V",c.className="actionbtn xYIKBnbHS",r.className="actionbtn xYIKBnbHS",c.innerHTML='<svg class=xGBqJjpdr viewBox="0 0 20 20">\n	<path d="M1 5.006A2 2 0 012.995 3h14.01A2 2 0 0119 5.006v9.988A2 2 0 0117.005 17H2.995A2 2 0 011 14.994V5.006zM3 5l7 4 7-4v2l-7 4-7-4V5z" fill-rule=evenodd fill=#788aa2></path>\n	</svg>\n	<div>使用 電子郵件 登入</div>',i.appendChild(r),i.appendChild(c),(o=new k).dialogContent.classList.add("bt"),o.dialogContent.appendChild(t),o.dialogContent.appendChild(i),r.onclick=function(){n(U,P).then(function(e){a.credentialFromResult(e).accessToken;var t=e.user;y=t.uid,L=t.displayName,o.dialogContent.innerHTML='<div class="xJ0pEZGEO">已成功登入Google帳號</div>\n						<div class="xDmLoXo3E">\n						<img class="xm7NzrczQ" draggable="false" src="'.concat(t.photoURL,'" alt="avatar"/>\n						<div class="xDLBHn55v"><div class="xQ6IT8O6S">').concat(t.displayName,'</div>\n						<div class="xPnpcvswL">').concat(t.email,"</div></div></div>"),o.dialogOverlay.onclick=function(){o.close()}}).catch(function(e){a.credentialFromError(e),console.log(e.code,e.message)})},c.onclick=function(){var e=new k({closeOnEsc:!0,closeOnOverlayClick:!0}),t=document.createElement("div");t.classList.add("xrYn5ZY3v"),t.innerText="帳號登入",e.dialogContent.appendChild(t);var n=document.createElement("div");n.classList.add("xZdL9CF5M"),e.dialogContent.appendChild(n);var a=document.createElement("input");a.placeholder="電子郵件",a.autocomplete="off",a.type="text",a.autocomplete="off",a.spellcheck="false",n.appendChild(a);var i=document.createElement("input");i.placeholder="密碼",i.type="password",i.autocomplete="off",n.appendChild(i);var r=document.createElement("div");r.classList.add("xw0IanPrC"),n.appendChild(r);var c=document.createElement("div");c.innerText="登入",c.tabIndex="0",c.classList.add("x40AApYkW"),n.appendChild(c),a.focus();var l=!0,d=function(t,n){l&&(l=!1,r.classList.remove("show"),c.innerHTML='\n			<svg class="x3xXCjYFp" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n			<path d="M21 12a9 9 0 1 1-6.219-8.56"/>\n			</svg>',c.classList.add("disabled"),s(U,t,n).then(function(t){try{o.close(),e.close()}catch(n){}var a=t.user;console.log("用户已登录:",a)}).catch(function(e){setTimeout(function(){var t=e.code;r.classList.add("show"),"auth/invalid-login-credentials"===t?r.innerText="帳號或密碼錯誤":"auth/invalid-email"===t?r.innerText="電子郵件格式錯誤":"auth/network-request-failed"===t&&(r.innerText="發送請求失敗"),c.innerHTML="登入",c.classList.remove("disabled"),l=!0},3e3)}))};c.onclick=function(){d(a.value,i.value)},i.onkeydown=function(e){13===e.keyCode&&d(a.value,i.value)}})}),M.signOutBtn.onclick=function(){r(U).then(function(){console.log("User signed out")}).catch(function(e){console.error("Sign out error",e)})},M.directionsBtn,M.directionsBtn.onclick=function(){var e=new k({closeOnEsc:!0,closeOnOverlayClick:!0}),t=document.createElement("div"),n=document.createElement("div");t.classList.add("xrYn5ZY3v"),n.classList.add("xWDUelLWA"),t.innerText="設定",n.innerHTML='\n	<div class="xtTvvWnjq bt">\n	</div>\n	<div class="xtTvvWnjq">\n	<span class="xIzeE22ru">深色模式</span>\n	<input type="checkbox" class="cls-switch" '.concat(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"checked":"",'>\n	</div>\n	<div class="xtTvvWnjq">\n	<span class="xIzeE22ru">自動翻譯</span>\n	<input type="checkbox" class="cls-switch">\n	</div>\n	<div class="xtTvvWnjq">\n	<span class="xIzeE22ru">開啟通知</span>\n	<input type="checkbox" class="cls-switch">\n	</div>\n	'),e.dialogContent.appendChild(t),e.dialogContent.appendChild(n)},M.fileInput.onchange=function(e){var t=this,n=e.target.files[0],a=new k;a.dialogContent.classList.add("bt");var i=document.createElement("div");i.classList.add("xrYn5ZY3v");var s=document.createElement("div");if(s.classList.add("xWDUelLWA"),a.dialogContent.appendChild(i),a.dialogContent.appendChild(s),n.size/1024/1024>5)return i.innerText="這個文件太大了",s.innerText="這個文件足足有 ".concat(z(n.size),"，我們無法負擔"),void(a.dialogOverlay.onclick=function(){a.close()});var r=o(q,"uploads/"+n.name);i.innerText="正在努力上傳中",s.innerText="這可能需要一點時間，請耐心等待...";var c=document.createElement("div");c.classList.add("xCECpHDwZ"),a.dialogContent.appendChild(c);var u=document.createElement("div");u.classList.add("xty9qDHrl"),c.appendChild(u);var f=document.createElement("div");f.classList.add("xIEj1ZAnA"),f.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n								<path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"></path>\n								<path d="M14 2v4a2 2 0 0 0 2 2h4"></path>\n							</svg>',u.appendChild(f);var $=document.createElement("div");$.classList.add("xxs4n9nhX"),u.appendChild($),$.innerHTML='<div class="xTGGn7ABj">'.concat(n.name,'</div><div class="xtyaQiCLO">').concat(z(n.size),"</div>"),u.appendChild($);var m=document.createElement("div");m.classList.add("xsoLox5sj"),u.appendChild(m);var g=document.createElement("div");g.classList.add("xk0osKWCK"),m.appendChild(g);var x=l(r,n);x.on("state_changed",function(e){var t=e.bytesTransferred/e.totalBytes*100;g.style.width="".concat(t,"%"),console.log("Upload is "+t+"% done")},function(e){console.error(e)},function(){return C(t,void 0,void 0,function(){var e,t,r;return w(this,function(o){switch(o.label){case 0:return a.dialogOverlay.onclick=function(){a.close()},c.remove(),i.innerText="完成上傳",s.innerText="這個文件已成功上傳，你的好友可以訪問了",[4,d(x.snapshot.ref)];case 1:return e=o.sent(),t="我剛剛上傳了一個名為「".concat(n.name,'」的文件，<a href="').concat(e,'" class="x0ciSQShX" target="_blank">點擊下載</a>'),r=h(p(Z,"chats",T,"messages")),[4,v(r,{senderUID:y,sender:L,content:t,timestamp:Date.now()})];case 2:return o.sent(),j(t,r.id),M.fileInput.value="",[2]}})})})}}})[987]();
