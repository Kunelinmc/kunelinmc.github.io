/**release 1.6*/
import{initializeApp as e}from"https://www.gstatic.com/firebasejs/9.0.2/firebase-app.js";import{getAuth as s,signInWithPopup as i,GoogleAuthProvider as a,onAuthStateChanged as n,signInWithEmailAndPassword as l,signOut as o}from"https://www.gstatic.com/firebasejs/9.0.2/firebase-auth.js";import{getStorage as r,ref as d,uploadBytesResumable as c,getDownloadURL as h}from"https://www.gstatic.com/firebasejs/9.0.2/firebase-storage.js";import{getFirestore as p,enableIndexedDbPersistence as u,collection as g,setDoc as m,doc as v,getDoc as x,where as $,getDocs as f,startAfter as C,onSnapshot as b,query as _,orderBy as L,arrayRemove as w,updateDoc as y,limit as k}from"https://www.gstatic.com/firebasejs/9.0.2/firebase-firestore.js";(()=>{class ${constructor(e,s={}){this.canvas=e,this.ctx=this.canvas.getContext("2d"),this.updateCanvasSize(),this.options={minScale:.1,maxScale:5,onClickOutside:null,...s},this.lastTapTime=0,this.tapTimeout=null,this.scale=1,this.posX=0,this.posY=0,this.isDragging=!1,this.lastX=0,this.lastY=0,this.img=null,this.needsRedraw=!1,this.animationFrameId=null,this.isTouching=!1,this.initialDistance=0,this.initialScale=1,this.touchStartPosX=0,this.touchStartPosY=0,this.touchStartScale=1,this.initialCenterX=0,this.initialCenterY=0,this.initialDistance=0,this.handleCanvasClick=this.handleCanvasClick.bind(this),this.handleCanvasTouchEnd=this.handleCanvasTouchEnd.bind(this),this.canvas.addEventListener("click",this.handleCanvasClick),this.canvas.addEventListener("touchend",this.handleCanvasTouchEnd),this.handleResize=this.handleResize.bind(this),this.handleMouseDown=this.handleMouseDown.bind(this),this.handleMouseMove=this.handleMouseMove.bind(this),this.handleMouseUp=this.handleMouseUp.bind(this),this.handleWheel=this.handleWheel.bind(this),this.handleTouchStart=this.handleTouchStart.bind(this),this.handleTouchMove=this.handleTouchMove.bind(this),this.handleTouchEnd=this.handleTouchEnd.bind(this),this.draw=this.draw.bind(this),this.handleMouseLeave=this.handleMouseLeave.bind(this),window.addEventListener("resize",this.handleResize),this.canvas.addEventListener("mousedown",this.handleMouseDown),document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp),this.canvas.addEventListener("wheel",this.handleWheel),this.canvas.addEventListener("mouseleave",this.handleMouseLeave),this.canvas.addEventListener("touchstart",this.handleTouchStart),this.canvas.addEventListener("touchmove",this.handleTouchMove),this.canvas.addEventListener("touchend",this.handleTouchEnd),this.requestRedraw()}getTouchCenter(e){let s=0,i=0,a=this.canvas.getBoundingClientRect();for(let n of e)s+=n.clientX-a.left,i+=n.clientY-a.top;return{x:s/e.length,y:i/e.length}}updateCanvasSize(){let e=this.canvas.parentElement;this.canvas.width=e.clientWidth,this.canvas.height=e.clientHeight}handleResize(){this.updateCanvasSize(),this.img&&(this.calculateInitialScale(),this.centerImage(),this.canvas.dispatchEvent(new MouseEvent("mousemove")),this.requestRedraw())}loadImage(e){this.img=new Image,this.img.onload=()=>{this.calculateInitialScale(),this.centerImage(),this.canvas.dispatchEvent(new MouseEvent("mousemove")),this.requestRedraw()},this.img.src=e}calculateInitialScale(){let e=this.canvas.width/this.img.width,s=this.canvas.height/this.img.height;this.options.minScale=Math.min(e,s,1),this.scale=this.options.minScale}centerImage(){this.posX=(this.canvas.width-this.img.width*this.scale)/2,this.posY=(this.canvas.height-this.img.height*this.scale)/2,this.enforceBounds()}draw(){this.needsRedraw&&(this.needsRedraw=!1,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.save(),this.ctx.translate(this.posX,this.posY),this.ctx.scale(this.scale,this.scale),this.ctx.drawImage(this.img,0,0),this.ctx.restore())}requestRedraw(){this.needsRedraw||(this.needsRedraw=!0,this.canvas.dispatchEvent(new MouseEvent("mousemove")),this.animationFrameId=requestAnimationFrame(this.draw))}enforceBounds(){let e=this.img.width*this.scale,s=this.img.height*this.scale;e>this.canvas.width?this.posX=Math.min(Math.max(this.posX,this.canvas.width-e),0):this.posX=(this.canvas.width-e)/2,s>this.canvas.height?this.posY=Math.min(Math.max(this.posY,this.canvas.height-s),0):this.posY=(this.canvas.height-s)/2}isInImageArea(e,s){if(!this.img)return!1;let i=this.posX,a=this.posX+this.img.width*this.scale,n=this.posY,l=this.posY+this.img.height*this.scale,o=Math.min(a,this.canvas.width),r=Math.min(l,this.canvas.height);return e>=Math.max(i,0)&&e<=o&&s>=Math.max(n,0)&&s<=r}handleMouseDown(e){let s=this.canvas.getBoundingClientRect(),i=e.clientX-s.left,a=e.clientY-s.top;this.isDraggable()&&this.isInImageArea(i,a)&&(this.isDragging=!0,this.lastX=e.clientX,this.lastY=e.clientY,this.canvas.style.cursor="grabbing")}handleMouseLeave(){this.canvas.style.cursor="default"}handleMouseMove(e){let s=this.canvas.getBoundingClientRect(),i=e.clientX-s.left,a=e.clientY-s.top;this.isInImageArea(i,a)?this.canvas.style.cursor=this.isDragging?"grabbing":"grab":this.canvas.style.cursor="default",this.isDragging&&(this.posX+=e.clientX-this.lastX,this.posY+=e.clientY-this.lastY,this.lastX=e.clientX,this.lastY=e.clientY,this.enforceBounds(),this.requestRedraw())}handleMouseUp(e){this.isDragging=!1;let s=this.canvas.getBoundingClientRect(),i=e.clientX-s.left,a=e.clientY-s.top;this.isInImageArea(i,a)?this.canvas.style.cursor="grab":this.canvas.style.cursor="default"}handleWheel(e){e.preventDefault();let s=this.canvas.getBoundingClientRect(),i=e.clientX-s.left,a=e.clientY-s.top,n=e.deltaY>0?.9:1.1,l=(i-this.posX)/this.scale,o=(a-this.posY)/this.scale,r=Math.min(Math.max(this.scale*n,this.options.minScale),this.options.maxScale);this.posX=i-l*r,this.posY=a-o*r,this.scale=r,this.enforceBounds(),this.requestRedraw()}handleTouchStart(e){if(0===e.touches.length)return;let s=Array.from(e.touches),i=this.getTouchCenter(s);this.initialCenterX=i.x,this.initialCenterY=i.y,this.touchStartPosX=this.posX,this.touchStartPosY=this.posY,this.touchStartScale=this.scale,e.touches.length>=2&&(this.initialDistance=this.getTouchDistance(e.touches[0],e.touches[1])),this.isTouching=!0}handleTouchMove(e){if(!this.isTouching)return;e.preventDefault();let s=Array.from(e.touches);if(0===s.length)return;let i=this.getTouchCenter(s),a=1;if(s.length>=2){let n=this.getTouchDistance(s[0],s[1]);this.initialDistance>0&&(a=n/this.initialDistance)}let l=Math.min(Math.max(this.touchStartScale*a,this.options.minScale),this.options.maxScale),o=(this.initialCenterX-this.touchStartPosX)/this.touchStartScale,r=(this.initialCenterY-this.touchStartPosY)/this.touchStartScale;this.posX=i.x-o*l,this.posY=i.y-r*l,this.scale=l,this.enforceBounds(),this.requestRedraw()}handleTouchEnd(e){this.isTouching=!1,this.initialDistance=0}getTouchDistance(e,s){let i=e.clientX-s.clientX,a=e.clientY-s.clientY;return Math.sqrt(i*i+a*a)}isDraggable(){return this.img&&(this.img.width*this.scale>this.canvas.width||this.img.height*this.scale>this.canvas.height)}handleCanvasClick(e){if(!this.img)return;let s=this.canvas.getBoundingClientRect(),i=e.clientX-s.left,a=e.clientY-s.top;this.isInImageArea(i,a)||this.triggerClickOutside(e)}handleCanvasTouchEnd(e){if(!this.img||e.touches.length>0)return;let s=this.canvas.getBoundingClientRect(),i=e.changedTouches[0],a=i.clientX-s.left,n=i.clientY-s.top,l=(new Date).getTime();l-this.lastTapTime<360?clearTimeout(this.tapTimeout):this.tapTimeout=setTimeout(()=>{this.isInImageArea(a,n)||this.triggerClickOutside(e),this.lastTapTime=l},200)}triggerClickOutside(e){if("function"==typeof this.options.onClickOutside){let s=this.canvas.getBoundingClientRect(),i={x:e.clientX-s.left,y:e.clientY-s.top,canvasX:e.clientX-s.left,canvasY:e.clientY-s.top,imageX:-1,imageY:-1};this.img&&(i.imageX=(i.canvasX-this.posX)/this.scale,i.imageY=(i.canvasY-this.posY)/this.scale),this.options.onClickOutside(i,e)}}destroy(){window.removeEventListener("resize",this.handleResize),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),this.canvas.removeEventListener("mouseleave",this.handleMouseLeave),this.canvas.removeEventListener("mousedown",this.handleMouseDown),this.canvas.removeEventListener("wheel",this.handleWheel),this.canvas.removeEventListener("touchstart",this.handleTouchStart),this.canvas.removeEventListener("touchmove",this.handleTouchMove),this.canvas.removeEventListener("touchend",this.handleTouchEnd),this.canvas.removeEventListener("click",this.handleCanvasClick),this.canvas.removeEventListener("touchend",this.handleCanvasTouchEnd),cancelAnimationFrame(this.animationFrameId)}}function T(e){e.forEach((s,i)=>{s.addEventListener("keydown",s=>{let a=i;if("ArrowDown"===s.key)a=(i+1)%e.length;else{if("ArrowUp"!==s.key)return;a=(i-1+e.length)%e.length}e[a].focus()})})}HTMLElement.prototype.clear=function(){this.innerHTML=""},HTMLElement.prototype.focusable=function(e){this.tabIndex=e?"0":"-1",this.blur()},HTMLElement.prototype.trigger=function(e){let s=s=>{this.classList.contains("disabled")||this.hasAttribute("disabled")||"click"!==s.type&&32!==s.keyCode&&13!==s.keyCode||e(s)};this.addEventListener("click",s),this.addEventListener("keydown",s)};class E{constructor({parent:e,text:s,placement:i="top",interactive:a=!0}){this.t=e,this.i=s,this.o=i,this.h=null,this.h=S("xuocLuDI6"),this.h.setAttribute("placement",this.o),this.h.innerText=this.i;let n=`tooltip-${Math.random().toString(36).substr(2,9)}`;this.h.id=n,this.t.setAttribute("aria-describedby",n),this.hideTooltip(),document.body.appendChild(this.h),a&&(this.showTooltip=this.showTooltip.bind(this),this.hideTooltip=this.hideTooltip.bind(this),this.t.addEventListener("mouseenter",e=>{this.t.disabled||this.t.classList.contains("disabled")||this.showTooltip(e)}),this.t.addEventListener("focus",e=>{this.t.disabled||this.t.classList.contains("disabled")||this.showTooltip(e)}),this.t.addEventListener("blur",this.hideTooltip),this.t.addEventListener("mouseleave",this.hideTooltip))}updatePosition(){let e=this.t.getBoundingClientRect(),s=this.h.getBoundingClientRect(),i,a;switch(this.o){case"top":i=window.scrollY+e.top-s.height-8,a=window.scrollX+e.left+e.width/2-s.width/2;break;case"bottom":i=window.scrollY+e.bottom+8,a=window.scrollX+e.left+e.width/2-s.width/2;break;case"left":i=window.scrollY+e.top+e.height/2-s.height/2,a=window.scrollX+e.left-s.width-8;break;case"right":i=window.scrollY+e.top+e.height/2-s.height/2,a=window.scrollX+e.right+8;break;default:throw Error("Invalid placement value")}this.h.style.top=`${i}px`,this.h.style.left=`${a}px`}showTooltip(){return this.updatePosition(),this.h.setAttribute("data-state","delayed-open"),this.h.setAttribute("aria-expanded","true"),this}hideTooltip(){this.h.setAttribute("data-state","closed"),this.h.setAttribute("aria-expanded","false")}setText(e){this.i=e,this.h.innerText=e,this.updatePosition()}}class B{constructor({trigger:e,placement:s="bottom"}){this.trigger=e,this.placement=s,this.Root=S("xEHCrF5Oe"),this.Overlay=S("overlay"),this.Content=S("xC3Uih0ex"),this.Root.setAttribute("data-state","open"),this.Root.setAttribute("role","popover"),this.Root.setAttribute("aria-modal","true"),document.body.appendChild(this.Root),this.Root.appendChild(this.Overlay),this.Root.appendChild(this.Content),this.Root.onwheel=function(e){e.ctrlKey&&e.preventDefault()},this.l=document.querySelectorAll("body > *:not(.xEHCrF5Oe, script, [hidden])"),this.l.forEach(e=>{e.setAttribute("inert","true")}),this.Overlay.addEventListener("click",()=>this.close()),this.Overlay.addEventListener("contextmenu",()=>this.close()),document.addEventListener("keydown",this.u),this.p(),window.addEventListener("resize",this.m)}m=()=>{this.p()};p(){let e=this.trigger.getBoundingClientRect(),s=this.Content.getBoundingClientRect(),i;if(Array.isArray(this.placement)){for(let a of this.placement){let n=this.v(a,e,s);if(this.k(n,s)){i=a;break}}i||(i=this.placement[0])}else i=this.placement;let l=this.v(i,e,s);this.Content.style.position="absolute",this.Content.style.top=`${l.top}px`,this.Content.style.left=`${l.left}px`}v(e,s,i){let a=0,n=0,[l,o]=e.split("-");switch(l){case"top":a=s.top-i.height;break;case"bottom":a=s.bottom;break;case"left":n=s.left-i.width;break;case"right":n=s.right}switch(o){case"start":n=s.left;break;case"end":n=s.left+s.width-i.width;break;default:"top"===l||"bottom"===l?n=s.left+(s.width-i.width)/2:a=s.top+(s.height-i.height)/2}return{top:a,left:n}}k(e,s){let i=window.innerWidth,a=window.innerHeight,{top:n,left:l}=e;return n>=0&&l>=0&&n+s.height<=a&&l+s.width<=i}u=e=>{27===e.keyCode&&(this.close(),this.trigger.focus())};M(){document.removeEventListener("keydown",this.u),window.removeEventListener("resize",this.m)}onClose(e){this.onCloseCallback=e}close(){this.M(),this.l.forEach(e=>{e.removeAttribute("inert")}),this.Root.setAttribute("data-state","closed"),setTimeout(()=>{this.Root.remove(),this.onCloseCallback&&this.onCloseCallback()},100)}}class M{constructor({closeOnOverlayClick:e=!1,closeOnEsc:s=!1}={}){this.Root=S("x54SkYRT0"),this.Overlay=S("overlay"),this.Content=S("content"),this.Root.setAttribute("data-state","open"),this.Root.appendChild(this.Overlay),this.Root.appendChild(this.Content),this.Root.setAttribute("role","dialog"),this.Root.setAttribute("aria-modal","true"),this.Root.onwheel=function(e){e.ctrlKey&&e.preventDefault()},this.l=document.querySelectorAll("body > *:not(.x54SkYRT0, script, style, [hidden])"),this.l.forEach(e=>{e.setAttribute("inert","true")}),document.body.appendChild(this.Root),this.Root.classList.add("show"),M.stack.push(this),e&&this.Overlay.addEventListener("click",this.S),s&&document.addEventListener("keydown",this.u)}S=()=>{this.close()};u=e=>{27===e.keyCode&&M.stack[M.stack.length-1]===this&&this.close()};onClose(e){this.onCloseCallback=e}close(){let e=M.stack.indexOf(this);e>-1&&M.stack.splice(e,1),this.onCloseCallback&&this.onCloseCallback(),this.l.forEach(e=>{e.removeAttribute("inert")}),this.Root.setAttribute("data-state","closed"),setTimeout(()=>{this.Root.remove()},100),this.M()}M(){this.Overlay.onclick=null,document.removeEventListener("keydown",this.u)}}M.stack=[];class A extends M{constructor({title:e,message:s,buttons:i=[],closeOnOverlayClick:a=!1,closeOnEsc:n=!0,showCloseButton:l=!1}={}){super({closeOnOverlayClick:a,closeOnEsc:n});let o=this.C(e,l),r=this.A(s);if(this.Content.style.padding="0px",this.Content.classList.add("xv1VrMJb6"),this.Content.classList.add("xLDQZ1SSl"),this.Content.appendChild(o),this.Content.appendChild(r),i.length>0){let d=this.B(i);r.appendChild(d)}}C(e,s){let i=document.createElement("div");i.className="xrYn5ZY3v lf gn";let a=document.createElement("div");if(a.className="x6Y89FynP",a.textContent=e||"Alert",i.appendChild(a),s){let n=S("xvb5soWNa");n.focusable(!0),n.innerHTML='<svg aria-hidden="true" style="min-width: 24px" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>',n.trigger(()=>{this.close()}),i.appendChild(n)}return i}A(e){let s=document.createElement("div");s.className="xWDUelLWA";let i=document.createElement("div");return i.className="xujSSErs5",i.textContent=e||"Are you sure?",s.appendChild(i),s}B(e){let s=document.createElement("div");return s.className="xWh2LBcgj",e.forEach(({text:e,classList:i=[],onClick:a})=>{let n=document.createElement("div");n.className="xgw2tzk6r "+i.join(" "),n.setAttribute("tabindex","0"),n.textContent=e,n.trigger(()=>{a&&a(),this.close()}),s.appendChild(n)}),s}}let S=e=>{let s=document.createElement("div");return s.classList.add(e),s},I=e=>document.querySelector(e),R=e({apiKey:"AIzaSyAp73V5ZsBUtpy4kS3-QyGirGSpz71DPWo",authDomain:"smiling-theory-397204.firebaseapp.com",databaseURL:"https://smiling-theory-397204-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"smiling-theory-397204",storageBucket:"smiling-theory-397204.appspot.com",messagingSenderId:"360479398694",appId:"1:360479398694:web:05b7df5ce277f89ea8ffe7",measurementId:"G-6BKTT1K7D1"}),Y=p(R),H=r(R),D=new a,O=s();u(Y).then(()=>{}).catch(e=>{"failed-precondition"===e.code||e.code});let X=/(Android|webOS|Windows Phone|iPhone|iPod|iPad)/i.test(window.navigator.platform)||window.innerWidth<550,W=[],F={sidebar:I(".xFz8bwNFr"),main:I(".x8o58HttN"),messageInput:I(".xtsARDHTI"),searchInput:I(".xujXllYgW"),messageContainer:I(".xikyLwDf4"),sendButton:I(".xuwRtDpu4"),fileInput:I(".xVEJA40Qh"),attachButton:I(".xpbRox0hO#xJTcQcZ9E"),stickerButton:I(".xpbRox0hO#xbXZpIWEa"),markButton:I(".xpbRox0hO#xsVrze5YA"),brushButton:I(".xpbRox0hO#xrfvUzMAG"),backButton:I(".xehdiGgBv .xMyenRl7K .x8JU9DbQZ"),primaryArea:I(".xemr1y6ie"),spinnerContainer:I(".xemr1y6ie .spinner"),spinnerLabel:I(".xemr1y6ie .spinner .xkT2bkntT"),O:I(".xDADAUUv4"),signatureLabel:I(".xlKSJ67AP"),nameLabel:I(".xt4GQkVIo"),avatarLabel:I(".xbVHF6S6B"),avatarWrapper:I(".xaoteDJh4"),profileContainer:I(".xQ6gFUtqT")},j=[],z={},K={},V,Z,G,U=!1,P="",q=0,N=!1,Q=!1;if(X)document.body.classList.add("mobile"),F.O.trigger(function(){F.fileInput.click()});else{new E({parent:F.attachButton,text:"附加文件",placement:"top"}),F.attachButton.trigger(function(){F.fileInput.click()}),new E({parent:F.sendButton,text:"發送",placement:"top",interactive:!0}),new E({parent:F.stickerButton,text:"加入貼紙",placement:"top",interactive:!0});let J=new E({parent:F.markButton,text:"標記為重要",placement:"top",interactive:!0});new E({parent:F.brushButton,text:"潤色工具",placement:"top",interactive:!0}),F.brushButton.trigger(function(){let e=ee("插件庫",!0);e.content.classList.add("lg"),e.body.classList.add("xDLwiKdTE"),e.body.innerHTML='<div class="xmBX2cWRZ">你還未安裝任何插件</div>'}),F.markButton.trigger(function(){Q?(Q=!1,F.markButton.classList.remove("x3zdxRXQ6"),J.setText("標記為重要")):(Q=!0,F.markButton.classList.add("x3zdxRXQ6"),J.setText("取消標記"))}),F.stickerButton.trigger(function(){let e=ee("貼紙庫",!0);e.content.classList.add("lg"),e.body.classList.add("xDLwiKdTE"),e.body.innerHTML='<div class="xmBX2cWRZ">你還未擁有任何貼紙</div>'})}function ee(e,s=!1){let i=new M({closeOnEsc:!0,closeOnOverlayClick:!0}),a=S("xrYn5ZY3v");a.classList.add("lf"),i.Content.style.padding="0";let n=S("x6Y89FynP");a.appendChild(n),n.innerText=e,i.Content.appendChild(a);let l=S("xWDUelLWA");if(i.Content.appendChild(l),s){let o=S("xvb5soWNa");o.focusable(!0),o.innerHTML='<svg aria-hidden="true" style="min-width: 24px" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>',i.close=i.close.bind(i),o.trigger(i.close),a.appendChild(o)}let r=a.getBoundingClientRect();return a.style.height=r.height+"px",{root:i,body:l,content:i.Content}}function et(e,s){if(s.startsWith("<")){let i=s.match(/<\s*(\w+)\s+(\S+)/),a=i[1],n=i[2];if("image"===a){let l=document.createElement("img");l.focusable(!0),l.classList.add("xGsec9lFd"),l.classList.add("xUSR4cuWD"),l.setAttribute("data-state","loading"),l.onload=function(){l.setAttribute("data-state","loaded"),l.classList.remove("xUSR4cuWD"),e.classList.add("xFIqZCKV3"),l.trigger(function(){let e=new M({closeOnEsc:!0,closeOnOverlayClick:!0});e.Content.classList.add("xPSnkbRat");let s=document.createElement("canvas");s.classList.add("xWuhDLG1C"),e.Content.appendChild(s);let i=new $(s,{maxScale:2,onClickOutside(s,a){i.destroy(),e.close()}});i.loadImage(n)})},l.src=n,e.appendChild(l)}else if("video"===a){let o=document.createElement("video");o.focusable(!0),o.setAttribute("controls","true"),o.src=n,o.classList.add("xGsec9lFd"),e.appendChild(o)}else if("audio"===a){let r=document.createElement("audio");r.focusable(!0),r.setAttribute("controls","true"),r.src=n,r.classList.add("xGsec9lFd"),e.appendChild(r)}else e.innerHTML=`無法預覽這個文件 <a class="x0ciSQShX no-wrap" href="${n}" target="_blank" rel="noreferrer noopener">下載</a>`}else{let d=document.createElement("span"),c=S("xYj7x2KZ4");d.classList.add("xVlceg4Ab");let h=el(s).replaceAll("\n","<br>");if(d.innerHTML=h,e.appendChild(d),e.appendChild(c),d.getBoundingClientRect().height>75){e.classList.add("xDVzL7FIt");let p=S("x6EwJGLAa"),u={0:'<span class="xNM56JYdv">展開全部</span>',1:'<span class="xNM56JYdv">顯示較少</span>'};p.innerHTML=u[0],p.focusable(!0);let g=0;p.trigger(function(){0===g?(g=1,e.classList.add("x2y08yFOH"),p.innerHTML=u[1]):(g=0,e.classList.remove("x2y08yFOH"),p.innerHTML=u[0])}),c.appendChild(p)}}}async function es(){let e=F.messageInput.innerText.trim();if(!e||!P)return;e=e.trim().replace(/&([^;]+)/g,"&amp;$1").replaceAll("<","&lt;").replaceAll(">","&gt;").replace(/\.\.\./g,"…").replace(/(\r?\n){3,}/g,"\n\n"),F.messageInput.clear();let s=Q?"1":null;F.markButton.classList.remove("x3zdxRXQ6"),Q=!1;let i=v(g(Y,"chats",P,"messages"));await m(i,{sender:G,content:e,timestamp:Date.now(),tag:s}),ea({content:e,tag:s},i.id,"3")}let ei=0;function ea(e,s,i="1"){let a=S("xVC8gtuyS"),n=S("xMyW2iRSH"),l=S("xKljxgVJA"),o=S("xu4Celbbq"),r=S("xc4iCj2Gy"),d=S("xRHoYYwoZ");switch(a.setAttribute("data-visible","true"),a.setAttribute("data-message-id",s),a.classList.add("xiOw4dg0O"),a.appendChild(l),l.appendChild(d),d.appendChild(o),o.appendChild(r),d.appendChild(n),r.innerText="你","1"===e.tag&&n.classList.add("x4rKxFxLl"),V&&(V.remove(),V=null),i){case"1":F.messageContainer.appendChild(a);break;case"2":let c=F.messageContainer.firstChild;F.messageContainer.insertBefore(a,c),ei+=a.offsetHeight;break;case"3":F.messageContainer.appendChild(a),F.messageContainer.scrollTo({top:F.messageContainer.scrollHeight,behavior:"smooth"})}et(n,e.content)}function en(e,s,i="1"){let a=S("xVC8gtuyS"),n=S("xMyW2iRSH"),l=S("xSYcbYqTG"),o=S("xKljxgVJA"),r=S("xu4Celbbq"),d=S("xc4iCj2Gy"),c=S("xt8fROB2L"),h=S("xRHoYYwoZ"),p=document.createElement("img");switch(a.setAttribute("data-visible","true"),c.classList.add("xt8fROB2L"),p.loading="lazy",a.appendChild(l),a.appendChild(o),o.appendChild(h),h.appendChild(r),r.appendChild(d),h.appendChild(n),r.appendChild(c),l.appendChild(p),a.setAttribute("data-message-id",s),"1"===e.tag&&n.classList.add("x4rKxFxLl"),c.innerText="0s",d.innerText="未知",V&&(V.remove(),V=null),i){case"1":F.messageContainer.appendChild(a);break;case"2":let u=F.messageContainer.firstChild;F.messageContainer.insertBefore(a,u),ei+=a.offsetHeight;break;case"3":F.messageContainer.appendChild(a),F.messageContainer.scrollTo({top:F.messageContainer.scrollHeight,behavior:"smooth"})}et(n,e.content),eu(e.sender).then(s=>{var i;function a(){if(X)ef(F.main,s);else{let e=ee("詳情",!0);e.content.classList.add("xxF37V7xd0"),e.body.innerHTML=`
			<div class="xGGKUZ7B3">
				<div class="xF37V7xd0">名稱</div>
				<div class="xeUKJgV96">${s.name}</div>
			</div>
			<div class="xGGKUZ7B3">
				<div class="xF37V7xd0">描述</div>
				<div class="xeUKJgV96">${el(s.signature)||"暫無描述"}</div>
			</div>
			`}}let n;c.innerText=(i=e.timestamp,(n=Math.max(Math.floor((Date.now()-i)/1e3),0))<60?`${n} 秒前`:n<3600?`${Math.floor(n/60)} 分鐘前`:n<86400?`${Math.floor(n/3600)} 小時前`:n<2592e3?`${Math.floor(n/86400)} 天前`:n<31536e3?`${Math.floor(n/2592e3)} 個月前`:`${ed(Math.floor(n/31536e3))} 年前`),p.src=s.avatarUrl||"/assets/avatar.png",p.onload=function(){l.classList.add("xWzeTGC6P")},d.onclick=a,l.focusable(!0),l.trigger(a),d.innerText=s.name||"未知"})}function el(e){return e.replace(/https?:\/\/[^\s/$.?#].[^\s]*/g,function(e){let s=e.replace(/^https?:\/\//,"");return'<span class="xCe4Btdzm"><a class="x0ciSQShX" translate="no" href="'.concat(e,'" target="_blank" rel="noreferrer noopener">').concat(decodeURIComponent(s),"</a></span>")})}function eo(e,s,i){F.signatureLabel.innerHTML=i||"暫無簡介",F.avatarWrapper.classList.remove("xJd2GT7MI"),F.avatarLabel.src=e||"assets/avatar.png",F.nameLabel.textContent=s||"未知"}function er(e){return e.replace(/&([^;]+)/g,"&amp;$1").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll(" ","&nbsp;").replaceAll("\n","<br>")}function ed(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}let ec="";function eh(e){var s,i;let a=S("x2fP9fkxS"),n=S("xQ65c0Nkc"),l=S("xybvM5cRF"),o=S("xT3Ta8vKw"),r=S("x6HyfOZS7"),d=S("xQkxrD9ZA");async function c(){if(P!==e.id||X){F.messageInput.innerHTML="",P=e.id,ec=`${e.name} - Structure`,document.title=ec,j.length=0;let s=new URLSearchParams(window.location.search);s.set("r",e.id),window.history.replaceState({},"","?"+s.toString()),F.messageContainer.classList.remove("xVjpzmyej"),F.sendButton.classList.remove("disabled"),F.fileInput.removeAttribute("disabled"),F.attachButton.classList.remove("disabled"),F.attachButton.focusable(!0),F.stickerButton.classList.remove("disabled"),F.stickerButton.focusable(!0),F.markButton.classList.remove("disabled"),F.markButton.focusable(!0),F.markButton.classList.remove("x3zdxRXQ6"),Q=!1,F.brushButton.classList.remove("disabled"),F.brushButton.focusable(!0),F.sendButton.focusable(!0),F.messageInput.setAttribute("contenteditable","true"),X?(F.O.classList.remove("disabled"),F.O.focusable(!0),F.backButton.classList.remove("disabled"),I(".xehdiGgBv .xMyenRl7K .x8JU9DbQZ").focusable(!0),F.main.classList.add("x8VAGH6N2"),I(".xvwhg72ii").innerText=e.name):(I(".x2fP9fkxS.active")&&I(".x2fP9fkxS.active").classList.remove("active"),a.classList.add("active")),F.messageInput.setAttribute("contenteditable","true"),F.messageInput.focusable(!0),F.messageContainer.clear();let i=await f(_(g(Y,"chats",e.id,"messages"),L("timestamp","desc"),k(10)));Z=i.docs[9];let n=[];i.forEach(e=>{n.push(e)}),(V=S("xqBX9i6rZ")).classList.add("spinner"),F.messageContainer.appendChild(V),0===n.length?V.innerHTML="這裡還沒有訊息，現在就開始聊天吧！":V.innerHTML='<svg aria-hidden="true" class="xxA4Cqchz" style="min-width: 20px" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n							<path d="M12 3a9 9 0 1 0 9 9"></path>\n						</svg>載入中…',n.reverse(),n.map(e=>{var s=e.data();-1===j.indexOf(e.id)&&(s.sender===G?(j.push(e.id),ea(s,e.id,"1")):(j.push(e.id),en(s,e.id,"1")))}),N=!0,F.messageContainer.scrollTo({top:F.messageContainer.scrollHeight,behavior:"instant"}),N=!1}}a.focusable(!0),b(g(Y,"chats",s=e.id,"messages"),e=>{e.docChanges().forEach(e=>{if(P!==s)return;let i=e.doc.data();switch(e.type){case"added":i.sender===G||-1!==j.indexOf(e.doc.id)||e.doc.metadata.fromCache||("hidden"===document.visibilityState&&(q++,document.title=`(${q}) ${ec}`),j.push(e.doc.id),en(i,e.doc.id,"3"));break;case"removed":let a=I(eg.replace("{sid}",e.doc.id));try{a.classList.add("xl4gtQk5f"),setTimeout(function(){a.remove()},3e3)}catch(n){}break;case"modified":try{let l=I(eg.replace("{sid}",e.doc.id)).querySelector(".xMyW2iRSH");l&&(l.clear(),et(l,i.content))}catch(o){}}})},e=>{}),a.trigger(c),e.focus&&c(),W.push({id:e.id,name:e.name,dom:a}),a.appendChild(n),a.appendChild(r),r.appendChild(d),d.focusable(!0);let h=function(){let s=new B({trigger:d,placement:["bottom-start","top-start"]});s.Content.classList.add("xoV8hdbgt");let i=S("xrQdSHI2A"),n=S("xrQdSHI2A"),l=S("xcoXgMpFW"),o=S("xrQdSHI2A");i.innerText="編輯根目錄",i.trigger(function(){s.close(),e$(F.sidebar,`${e.name} 的目錄`)}),i.classList.add("xUdcoAHYM"),[i,n,o].forEach(e=>{e.focusable(!0)}),o.trigger(function(){s.close(),new A({closeOnEsc:!0,closeOnOverlayClick:!0,title:"退出",message:"確定要退出這個聊天室嗎，將無法再主動加入",buttons:[{text:"取消"},{text:"確定",classList:["xTJA9U7y9"],onClick:async function(){let s=W.findIndex(s=>s.id===e.id);if(-1!==s)try{await y(v(Y,"users",G),{joined:w(e.id)}),W.splice(s,1),a.remove(),P===t&&F.messageContainer.clear()}catch(i){}}}]})}),s.Content.appendChild(i),n.innerText="查看行程安排",n.trigger(function(){s.close();let e=e$(F.sidebar,"已排定的行程");e.content.classList.add("x6q2Zh2QF");let i=S("xtx2Cn8cK");e.content.appendChild(i),i.innerHTML='<div class="xmBX2cWRZ">暫無任何行程</div>'}),s.Content.appendChild(n),s.Content.appendChild(l),o.innerText="退出",o.classList.add("xGy5QqsmI"),s.Content.appendChild(o),T([i,n,o]),s.p()};d.onkeydown=e=>{e.stopPropagation(),13===e.keyCode&&h()},d.innerHTML='<svg aria-hidden="true" style="min-width: 20px;" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="1"/><circle cx="12" cy="5" r="1"/><circle cx="12" cy="19" r="1"/></svg>',d.onclick=e=>{e.stopPropagation(),h()},n.appendChild(l),l.innerText=e.name,i=e.description?e.description:0===e.size?"沒有訊息":`${ed(e.size)} 則訊息`,o.innerText=i,n.appendChild(o),F.primaryArea.appendChild(a)}function ep(e){let s=["B","KB","MB","GB","TB","PB"],i=e,a=0;for(;i>=1024&&a<s.length-1;)i/=1024,a++;return`${i.toFixed(2)} ${s[a]}`}async function eu(e){if(z[e])return z[e];let s=sessionStorage.getItem(`upf_${e}`);if(s){let i=JSON.parse(s);return z[e]=i,i}try{let a=await x(v(Y,"users",e));if(a.exists()){let n=a.data();return z[e]=n,sessionStorage.setItem(`upf_${e}`,JSON.stringify(n)),n}return null}catch(l){throw l}}let eg='.xikyLwDf4 .xVC8gtuyS[data-message-id="{sid}"]';function em(e="未命名",s="站無描述"){let i=new M({closeOnEsc:!0,closeOnOverlayClick:!0});i.Content.style.padding="0";let a=S("xrYn5ZY3v");a.classList.add("lf");let n=S("x6Y89FynP");n.innerText="編輯個人資料",a.appendChild(n);let l=S("xvb5soWNa");l.focusable(!0),l.innerHTML='<svg aria-hidden="true" style="min-width: 24px" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>',i.close=i.close.bind(i),l.trigger(i.close),a.appendChild(l),i.Content.appendChild(a);let o=S("xWDUelLWA");i.Content.appendChild(o);let r=document.createElement("input");r.setAttribute("hidden","true"),r.id="_Jy2eOVG7",r.type="file";let d=S("xGGKUZ7B3"),c=document.createElement("label");c.innerText="名稱",c.classList.add("xF37V7xd0"),c.htmlFor="_rJvAjH9O";let h=document.createElement("input");h.value=e,h.classList.add("xYvZ9WF6d"),h.id="_rJvAjH9O",h.type="text",h.maxLength="20",h.autocomplete="off",h.spellcheck="false",o.appendChild(d),d.appendChild(c),d.appendChild(h);let p=S("xGGKUZ7B3"),u=document.createElement("label");u.innerText="描述",u.classList.add("xF37V7xd0"),u.htmlFor="_fM6Qcf9q";let g=document.createElement("textarea");g.maxLength="80",g.value=s,g.classList.add("xGuwEx6qN"),g.id="_fM6Qcf9q",g.rows="3",g.maxLength="50",g.autocomplete="off",g.spellcheck="false",o.appendChild(p),p.appendChild(u),p.appendChild(g);let m=S("x40AApYkW");function x(){g.value!==s||h.value!==e?(m.classList.remove("disabled"),m.focusable(!0)):(m.classList.add("disabled"),m.focusable(!1))}m.innerText="完成",m.classList.add("disabled"),m.style.marginTop="0",o.appendChild(m),g.oninput=x,h.oninput=x,m.trigger(async function(){m.classList.add("disabled"),m.innerHTML='<svg aria-hidden="true" class="x3xXCjYFp" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 1 1-6.219-8.56"></path></svg>',m.focusable(!1),h.disabled=!0,g.disabled=!0,r.disabled=!0;let e=h.value,s=g.value.trim();await async function(e,s){try{await y(v(Y,"users",e),s),z[e]&&(z[e]={...z[e],...s});let i=sessionStorage.getItem(`upf_${e}`);if(i){let a={...JSON.parse(i),...s};sessionStorage.setItem(`upf_${e}`,JSON.stringify(a))}return!0}catch(n){return!1}}(G,{name:e,signature:s}),F.nameLabel.innerText=e,F.signatureLabel.innerHTML=er(s),i.close()})}async function ev(){F.primaryArea.classList.add("xuGldtFot");let e=(await x(v(Y,"users",G))).data(),s=new URLSearchParams(window.location.search).get("r");e.joined.map(async e=>{try{(async function(e){if(K[e])return K[e];let s=sessionStorage.getItem(`rpf_${e}`);if(s){let i=JSON.parse(s);return K[e]=i,i}try{let a=await x(v(Y,"chats",e));if(a.exists()){let n=a.data();return z[e]=n,sessionStorage.setItem(`rpf_${e}`,JSON.stringify(n)),n}return null}catch(l){throw l}})(e).then(async i=>{!async function(e,s){let i=await f(g(Y,"chats",e.id,"messages"));W.some(s=>s.id===e.id)||eh({name:e.name,id:e.id,type:e.type,description:e.description,size:i.size,focus:s,identity:e.identity})}({id:e,name:i.name,type:i.type,plugins:i.plugins,description:i.description,identity:i.identity},s===e)})}catch(i){}})}n(O,e=>{e?(eu(G=e.uid).then(e=>{eo(e.avatarUrl,e.name,e.signature)}).catch(e=>{eo()}),ev(),async function(){if(!U){try{let e=F.messageContainer.getBoundingClientRect();F.messageContainer.style.setProperty("--x9LFHiVqv",`${Number((.6*e.height-24).toFixed(2))}px`),F.messageContainer.style.setProperty("--xVizV2ybq",Number((.88*e.height).toFixed(2))-24+"px")}catch(s){}F.searchInput.removeAttribute("disabled"),F.searchInput.focusable(!0),F.profileContainer.classList.remove("disabled"),F.profileContainer.focusable(!0),"1.6"!==localStorage.getItem("cvs")&&(ee("更新了什麼",!0).body.innerHTML=`<div class="xeUKJgV96"><ul class="xxmjDL5xB">
	<li class="xcKqXW8uF">新增了全新的用戶頁…</li>
	<li class="xcKqXW8uF">修復了一些錯誤…</li>
	</ul></div>`,localStorage.setItem("cvs","1.6")),U=!0}}()):(G="",function(){let e=S("xrYn5ZY3v");e.innerText="帳號登入";let s=S("xRRuA0Z3S"),n=document.createElement("div");n.id="x7BYgkdiJ",n.focusable(!0),n.innerHTML='<svg aria-hidden="true" class="xGBqJjpdr" viewBox="0 0 20 20"><path d="M19.6 10.23c0-.82-.1-1.42-.25-2.05H10v3.72h5.5c-.15.96-.74 2.31-2.04 3.22v2.45h3.16c1.89-1.73 2.98-4.3 2.98-7.34z" fill=#4285F4></path><path d="M13.46 15.13c-.83.59-1.96 1-3.46 1-2.64 0-4.88-1.74-5.68-4.15H1.07v2.52C2.72 17.75 6.09 20 10 20c2.7 0 4.96-.89 6.62-2.42l-3.16-2.45z" fill=#34A853></path><path d="M3.99 10c0-.69.12-1.35.32-1.97V5.51H1.07A9.973 9.973 0 000 10c0 1.61.39 3.14 1.07 4.49l3.24-2.52c-.2-.62-.32-1.28-.32-1.97z" fill=#FBBC05></path><path d="M10 3.88c1.88 0 3.13.81 3.85 1.48l2.84-2.76C14.96.99 12.7 0 10 0 6.09 0 2.72 2.25 1.07 5.51l3.24 2.52C5.12 5.62 7.36 3.88 10 3.88z" fill=#EA4335></path></svg>使用 Google 登入';let o=document.createElement("div");o.focusable(!0),o.id="xBnuWNG6V",o.className="actionbtn xYIKBnbHS",n.className="actionbtn xYIKBnbHS",o.innerHTML='<svg aria-hidden="true" class="xGBqJjpdr" viewBox="0 0 20 20"><path d="M1 5.006A2 2 0 012.995 3h14.01A2 2 0 0119 5.006v9.988A2 2 0 0117.005 17H2.995A2 2 0 011 14.994V5.006zM3 5l7 4 7-4v2l-7 4-7-4V5z" fill-rule=evenodd fill=#788aa2></path></svg>使用 電子郵件 登入',s.appendChild(n),s.appendChild(o);let r=new M;r.Content.classList.add("bt"),r.Content.classList.add("xySmLVr4a"),r.Content.appendChild(e),r.Content.appendChild(s);let d=S("xrYn5ZY3v");d.classList.add("lf"),d.classList.add("gc");let c=S("xZyuwxZPZ");c.focusable(!0),c.innerHTML='<svg style="min-width: 24px" aria-hidden="true" class="xRmN7l0Zc" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 19-7-7 7-7"></path><path d="M19 12H5"></path></svg>',d.appendChild(c);let h=S("x6Y89FynP");h.innerText="電子郵件登入",d.appendChild(h);let p=S("xWDUelLWA");p.classList.add("xwxpzc3QF"),r.Content.appendChild(d),r.Content.appendChild(p);let u=document.createElement("div");p.appendChild(u),u.classList.add("xZdL9CF5M");let g=document.createElement("div");g.classList.add("xGGKUZ7B3"),u.appendChild(g);let m=document.createElement("label");m.classList.add("xF37V7xd0"),m.innerText="電子郵件地址",g.appendChild(m);let v=document.createElement("input");v.classList.add("xYvZ9WF6d"),v.autocomplete="off",v.type="text",v.disabled=!0,v.spellcheck="false",g.appendChild(v);let x=document.createElement("div");x.classList.add("xGGKUZ7B3"),x.style.marginTop="10px",x.style.marginBottom="5px",u.appendChild(x);let $=document.createElement("label");$.classList.add("xF37V7xd0"),$.innerText="密碼",x.appendChild($);let f=document.createElement("input");f.classList.add("xYvZ9WF6d"),f.type="password",f.disabled=!0,f.autocomplete="off",x.appendChild(f);let C=document.createElement("div");C.classList.add("xw0IanPrC"),u.appendChild(C);let b=document.createElement("div");b.innerText="送出",b.classList.add("disabled"),b.classList.add("x40AApYkW"),u.appendChild(b),c.trigger(function(){r.Content.classList.remove("xA7y7OLtP"),b.classList.add("disabled"),b.focusable(!1),v.disabled=!0,f.disabled=!0});let _=!0,L=function(){_&&(_=!1,c.classList.add("disabled"),c.focusable(!1),C.classList.remove("show"),b.innerHTML='<svg aria-hidden="true" class="x3xXCjYFp" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>',v.disabled=!0,f.disabled=!0,b.classList.add("disabled"),b.focusable(!1),b.blur(),l(O,v.value,f.value).then(e=>{try{r.close(),α.close()}catch(s){}eu(e.user.uid).then(e=>{e||em()}).catch(e=>{})}).catch(e=>{setTimeout(function(){let s=e.code;switch(C.classList.add("show"),s){case"auth/invalid-login-credentials":case"auth/invalid-email":C.innerText="帳號或密碼錯誤";break;case"auth/network-request-failed":C.innerText="網路請求錯誤";break;default:C.innerText="發生未知的錯誤"}b.innerHTML="送出",b.classList.remove("disabled"),b.focusable(!0),v.disabled=!1,f.disabled=!1,c.classList.remove("disabled"),c.focusable(!0),_=!0},3e3)}))};f.onkeydown=function(e){13===e.keyCode&&L()},b.trigger(L),n.trigger(function(){n.classList.add("disabled"),n.focusable(!1),i(O,D).then(e=>{a.credentialFromResult(e).accessToken;let s=e.user;eu(G=s.uid).then(e=>{eo(e.avatarUrl,e.name,e.signature),r.close(),e||em(s.displayName)}).catch(e=>{})}).catch(e=>{"auth/popup-closed-by-user"===e.code&&(n.classList.remove("disabled"),n.focusable(!0))})}),o.trigger(function(){r.Content.classList.add("xA7y7OLtP"),v.disabled=!1,f.disabled=!1,b.focusable(!0),b.classList.remove("disabled"),v.focus()})}())});let ex={audio:'<path d="M17.5 22h.5a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3" /><path d="M14 2v4a2 2 0 0 0 2 2h4" /><path d="M2 19a2 2 0 1 1 4 0v1a2 2 0 1 1-4 0v-4a6 6 0 0 1 12 0v4a2 2 0 1 1-4 0v-1a2 2 0 1 1 4 0" />',video:'<path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z" /><path d="M14 2v4a2 2 0 0 0 2 2h4" /><path d="m10 11 5 3-5 3v-6Z" />',image:'<path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z" /><path d="M14 2v4a2 2 0 0 0 2 2h4" /><circle cx="10" cy="12" r="2" /><path d="m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22" />',archive:'<path d="M10 12v-1" /><path d="M10 18v-2" /><path d="M10 7V6" /><path d="M14 2v4a2 2 0 0 0 2 2h4" /><path d="M15.5 22H18a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v16a2 2 0 0 0 .274 1.01" /><circle cx="10" cy="20" r="2" />',others:'<path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z" /><path d="M14 2v4a2 2 0 0 0 2 2h4" />'};function e$(e,s){let i=S("xB4hVI3El"),a=S("xopQXJrX5"),n=S("xMyenRl7K"),l=S("x8JU9DbQZ"),o=S("xvwhg72ii");a.appendChild(n),n.appendChild(l),n.appendChild(o),o.innerHTML=s,l.focusable(!0),l.innerHTML='<svg style="min-width: 24px" aria-hidden="true" class="xvx75W2b4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n							<path d="m12 19-7-7 7-7"></path>\n							<path d="M19 12H5"></path>\n						</svg>';let r=S("xZz4zYjIm");return i.appendChild(a),i.appendChild(r),document.body.appendChild(i),setTimeout(function(){e.classList.add("xCr0RyqCg"),i.classList.add("xa2pPtuLq")}),l.trigger(function(){i.classList.remove("xa2pPtuLq"),e.classList.remove("xCr0RyqCg"),e.classList.remove("xjv5U11Kz"),i.classList.remove("xjv5U11Kz"),setTimeout(function(){i.remove()},360)}),{root:i,content:r}}function ef(e,s){let i='<svg aria-hidden="true" style="min-width: 24px" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg>',a=e$(e,`${s.name}${s.verified?`<div class="xTKxbdpu3">${i}</div>`:""}`);a.root.classList.add("xwMgtrL2x"),a.root.onscroll=function(){a.root.scrollTop>60?a.root.classList.add("xORN7XV1j"):a.root.classList.remove("xORN7XV1j")};let n=S("xkyfCNAI0"),l=S("x0zSVRG3y"),o=document.createElement("img");o.classList.add("x96ofpjeu");let r=S("xkKF4v6d2"),d=S("xwvIJoAtO"),c=document.createElement("img");c.classList.add("xVwXc1fhM");let h=S("xqYV0G7JT"),p=S("xBjZoCxmV"),u=S("xl2FSOZLU"),g=S("xt0pX9m5p");n.appendChild(l),l.appendChild(o),o.draggable="false",o.src=s.bannerUrl||"assets/default-banner.png",o.loading="lazy",n.appendChild(r),r.appendChild(d),d.appendChild(c),c.draggable="false",c.src=s.avatarUrl||"assets/avatar.png",c.loading="lazy",r.appendChild(h),h.appendChild(p);let m=document.createTextNode(er(s.name));if(p.appendChild(m),s.verified){let v=S("xTKxbdpu3");v.innerHTML=i,p.appendChild(v)}h.appendChild(u),u.innerHTML=`${el(er(s.signature))||"暫無描述"}`,h.appendChild(g),g.innerHTML=`${s.resource||""}`,a.content.appendChild(n)}F.fileInput.onchange=async function(e){let s=e.target.files[0];if(!s)return;let i=new M({closeOnEsc:!1,closeOnOverlayClick:!1}),a=S("xrYn5ZY3v");a.classList.add("lf");let n=S("xWDUelLWA");n.classList.add("xIOucKmLX"),i.Content.appendChild(a),i.Content.appendChild(n),i.Content.classList.add("gt");let l=S("x6Y89FynP"),o=S("xujSSErs5");a.appendChild(l),n.appendChild(o);let r=S("xvb5soWNa");if(r.innerHTML='<svg aria-hidden="true" style="min-width: 24px" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>',r.focusable(!0),a.appendChild(r),s.size>52428800)return l.innerText="上傳失敗",o.innerText=`這個文件有 ${ep(s.size)}，我們無法負擔`,void(r.onclick=function(){F.fileInput.value="",i.close.bind(i)()});l.innerText="上傳中",o.innerText="正在上傳中，請耐心等待";let p=document.createElement("div");p.classList.add("xCECpHDwZ"),n.appendChild(p);let u=document.createElement("div");u.classList.add("xty9qDHrl"),p.appendChild(u);let x=document.createElement("div");x.classList.add("xIEj1ZAnA");let $=String(s.type),f="",C="";$.startsWith("image/")?(f=ex.image,C="< image {u}"):$.startsWith("video/")?(f=ex.video,C="< video {u}"):$.startsWith("audio/")?(f=ex.audio,C="< audio {u}"):["application/x-zip-compressed","application/zip","application/x-rar-compressed","application/vnd.rar","application/x-compressed"].includes($)?(f=ex.archive,C="< other {u}"):(f=ex.others,C="< other {u}"),x.innerHTML=`<svg aria-hidden="true" style="min-width: 28px" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">${f}</svg>`,u.appendChild(x);let b=document.createElement("div");b.classList.add("xxs4n9nhX"),u.appendChild(b),b.innerHTML='<div class="xTGGn7ABj">'.concat(s.name).concat(`</div><div class="xtyaQiCLO">${ep(s.size)}</div>`),u.appendChild(b);let _=document.createElement("div");_.classList.add("xsoLox5sj"),u.appendChild(_);let L=document.createElement("div");L.classList.add("xk0osKWCK"),_.appendChild(L);let w="";try{w=`${function(e){let s="";for(let i=0;i<12;i++)s+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return s}(12)}-${s.name}`}catch(y){}let k=d(H,`uploads/${w}`),T=c(k,s);r.onclick=function(){l.innerText="上傳遭中斷",o.innerText="已取消上傳",T.cancel(),F.fileInput.value="",i.close()},T.on("state_changed",e=>{let s=e.bytesTransferred/e.totalBytes*100;L.style.width=`${s}%`},e=>{},async()=>{p.remove(),l.innerText="上傳完成",o.innerText="這個文件已經成功上傳了";let e=await h(T.snapshot.ref),s="";s=C.replace("{u}",e);let i=v(g(Y,"chats",P,"messages"));await m(i,{sender:G,content:s,timestamp:Date.now()}),ea({content:s},i.id,"3"),F.fileInput.value=""})},document.addEventListener("visibilitychange",function(){"visible"===document.visibilityState&&(document.title=ec,q=0)}),F.searchInput.oninput=function(){let e=F.searchInput.value.toLowerCase().trim();""!==e?W.forEach(s=>{s.name.toLowerCase().includes(e)?s.dom.classList.remove("hide"):s.dom.classList.add("hide")}):W.forEach(e=>{e.dom.classList.remove("hide")})},F.messageContainer.addEventListener("scroll",function(){let e=F.messageContainer.scrollTop;F.messageContainer.style.setProperty("--xTji2bEtg",`${e.toFixed(2)}px`),""!==G&&""!==P&&e<160&&!N&&async function(e){if(void 0!==Z){N=!0;let s=await f(_(g(Y,"chats",e,"messages"),L("timestamp","desc"),C(Z),k(10)));Z=10===s.docs.length?s.docs[9]:void 0;let i=0,a=F.messageContainer.scrollHeight;s.forEach(e=>{i++;let s=e.data();-1===j.indexOf(e.id)&&(s.sender===G?(j.push(e.id),ea(s,e.id,"2")):(j.push(e.id),en(s,e.id,"2")))}),N=!0,ei=F.messageContainer.scrollHeight-a,F.messageContainer.scrollTo(0,ei),ei=0,setTimeout(function(){N=!1},220)}else N=!1}(P)}),F.messageInput.oninput=function(){let e=F.messageInput.childNodes;1==e.length&&"BR"===e[0].nodeName&&F.messageInput.clear()},F.messageInput.onpaste=function(e){e.preventDefault(),document.execCommand("insertHTML",!0,er((e.clipboardData||window.Clipboard).getData("text/plain")))},F.messageInput.addEventListener("drop",function(e){e.preventDefault();let s=e.dataTransfer.getData("text/plain");e.target.focus(),document.execCommand("insertHTML",!0,er(s))}),F.messageInput.oncopy=function(e){e.preventDefault();var s=window.getSelection().toString();e.clipboardData.setData("text/plain",s)},F.messageInput.addEventListener("keydown",function(e){switch(e.keyCode){case 13:X||e.shiftKey||(e.preventDefault(),es());break;case 85:case 66:case 73:e.ctrlKey&&e.preventDefault()}}),F.sendButton.trigger(es),document.onkeydown=function(e){switch(e.keyCode){case 191:let s=document.activeElement;s==F.messageInput||s==F.searchInput||"INPUT"==s.tagName.toUpperCase()||s.classList.contains("xGuwEx6qN")||s.classList.contains("xYvZ9WF6d")||(e.preventDefault(),F.messageInput.focus());break;case 75:e.ctrlKey&&U&&(e.preventDefault(),F.searchInput.focus());break;case 123:e.preventDefault();break;case 67:e.ctrlKey&&e.shiftKey&&e.preventDefault();break;case 85:case 187:case 189:case 80:case 83:case 79:case 109:case 107:e.ctrlKey&&e.preventDefault();break;case 37:case 39:e.altKey&&e.preventDefault()}},document.querySelectorAll("body > div").forEach(function(e){e.onwheel=function(e){e.ctrlKey&&e.preventDefault()}}),F.backButton.trigger(function(){F.backButton.classList.add("disabled"),F.O.classList.add("disabled");let e=window.location.href.replace(/\?.*$/,"");window.history.replaceState(null,"",e),F.main.classList.remove("x8VAGH6N2"),N=!0,F.messageContainer.clear(),N=!1,P="",ec="Structure",document.title=ec,F.messageInput.clear(),F.messageInput.setAttribute("contenteditable","true"),F.messageInput.focusable(!1),F.sendButton.focusable(!1)}),F.profileContainer.trigger(function(){let e=new B({trigger:F.profileContainer,placement:"top"});e.Content.classList.add("xLhiIL2Wm"),F.profileContainer.classList.add("x9EnCPd4S");let s=S("xrQdSHI2A");s.focusable(!0),s.innerText="個性設置",s.trigger(function(){e.close();let s=ee("個性設置",!0);s.content.classList.add("lg");let i=S("xI03Z090L");function a(e){let s=document.createElement("label");s.classList.add("xXU2nny8B");let a=document.createElement("input");a.classList.add("cls-switch"),a.id=e.id,a.type="checkbox",s.htmlFor=e.id,a.checked=e.value||!1;let n=document.createTextNode(e.text);s.appendChild(n),s.appendChild(a),i.appendChild(s)}s.body.appendChild(i),a({id:"xU0LgyTxO",text:"屏蔽垃圾訊息和廣告內容",value:!1}),a({id:"xK6BoiT7W",value:!0,text:"啟用圖片預覽功能"})});let i=S("xrQdSHI2A");i.focusable(!0),i.innerText=X?"查看個人資料":"編輯個人資料",i.trigger(function(){e.close(),eu(G).then(e=>{X?ef(F.sidebar,e):em(e.name,e.signature)})});let a=S("xcoXgMpFW"),n=S("xrQdSHI2A");n.focusable(!0),n.trigger(function(){e.close(),o(O).then(()=>{G="",W.length=0,j.length=0;let e=window.location.href.replace(/\?.*$/,"");window.history.replaceState(null,"",e),F.primaryArea.clear(),F.messageContainer.clear(),localStorage.setItem("cvs",""),V&&(V.remove(),V=null),F.profileContainer.classList.remove("disabled"),F.profileContainer.focusable(!0),F.markButton.classList.add("disabled"),F.brushButton.classList.add("disabled"),F.attachButton.classList.add("disabled"),F.stickerButton.classList.add("disabled"),Q=!1,F.avatarWrapper.classList.add("xJd2GT7MI"),F.avatarLabel.src="",F.nameLabel.innerText="",F.signatureLabel.innerText=""}).catch(e=>{})}),n.innerText="登出",T([s,i,n]),e.Content.appendChild(s),e.Content.appendChild(i),e.Content.appendChild(a),e.Content.appendChild(n),e.p(),e.onClose(()=>{F.profileContainer.classList.remove("x9EnCPd4S")})})})();
