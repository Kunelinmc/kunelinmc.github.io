/*! For license information please see LICENSE */
import{initializeApp as e}from"https://www.gstatic.com/firebasejs/9.0.2/firebase-app.js";import{getAuth as t,signInWithPopup as n,GoogleAuthProvider as a,onAuthStateChanged as r,signInWithEmailAndPassword as i,signOut as o}from"https://www.gstatic.com/firebasejs/9.0.2/firebase-auth.js";import{getStorage as s,ref as c,uploadBytesResumable as l,getDownloadURL as d}from"https://www.gstatic.com/firebasejs/9.0.2/firebase-storage.js";import{getFirestore as u,collection as p,setDoc as h,doc as f,getDocs as v,startAfter as m,onSnapshot as g,query as $,orderBy as x,limit as y}from"https://www.gstatic.com/firebasejs/9.0.2/firebase-firestore.js";(()=>{function _(e){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function L(){"use strict";L=function(){return t};var e,t={},n=Object.prototype,a=n.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(d){l=function(e,t,n){return e[t]=n}}function u(t,n,a,i){var o,s,c,l,d=Object.create((n&&n.prototype instanceof g?n:g).prototype);return r(d,"_invoke",{value:(o=t,s=a,c=new S(i||[]),l=h,function(t,n){if(l===f)throw Error("Generator is already running");if(l===v){if("throw"===t)throw n;return{value:e,done:!0}}for(c.method=t,c.arg=n;;){var a=c.delegate;if(a){var r=A(a,c);if(r){if(r===m)continue;return r}}if("next"===c.method)c.sent=c._sent=c.arg;else if("throw"===c.method){if(l===h)throw l=v,c.arg;c.dispatchException(c.arg)}else"return"===c.method&&c.abrupt("return",c.arg);l=f;var i=p(o,s,c);if("normal"===i.type){if(l=c.done?v:"suspendedYield",i.arg===m)continue;return{value:i.arg,done:c.done}}"throw"===i.type&&(l=v,c.method="throw",c.arg=i.arg)}})}),d}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(a){return{type:"throw",arg:a}}}t.wrap=u;var h="suspendedStart",f="executing",v="completed",m={};function g(){}function $(){}function x(){}var y={};l(y,o,function(){return this});var w=Object.getPrototypeOf,b=w&&w(w(H([])));b&&b!==n&&a.call(b,o)&&(y=b);var C=x.prototype=g.prototype=Object.create(y);function E(e){["next","throw","return"].forEach(function(t){l(e,t,function(e){return this._invoke(t,e)})})}function k(e,t){var n;r(this,"_invoke",{value:function(r,i){function o(){return new t(function(n,o){!function n(r,i,o,s){var c=p(e[r],e,i);if("throw"!==c.type){var l=c.arg,d=l.value;return d&&"object"==_(d)&&a.call(d,"__await")?t.resolve(d.__await).then(function(e){n("next",e,o,s)},function(e){n("throw",e,o,s)}):t.resolve(d).then(function(e){l.value=e,o(l)},function(e){return n("throw",e,o,s)})}s(c.arg)}(r,i,n,o)})}return n=n?n.then(o,o):o()}})}function A(t,n){var a=n.method,r=t.iterator[a];if(r===e)return n.delegate=null,"throw"===a&&t.iterator.return&&(n.method="return",n.arg=e,A(t,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=TypeError("The iterator does not provide a '"+a+"' method")),m;var i=p(r,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,m;var o=i.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):o:(n.method="throw",n.arg=TypeError("iterator result is not an object"),n.delegate=null,m)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function H(t){if(t||""===t){var n=t[o];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function n(){for(;++r<t.length;)if(a.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=e,n.done=!0,n};return i.next=i}}throw TypeError(_(t)+" is not iterable")}return $.prototype=x,r(C,"constructor",{value:x,configurable:!0}),r(x,"constructor",{value:$,configurable:!0}),$.displayName=l(x,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===$||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,l(e,c,"GeneratorFunction")),e.prototype=Object.create(C),e},t.awrap=function(e){return{__await:e}},E(k.prototype),l(k.prototype,s,function(){return this}),t.AsyncIterator=k,t.async=function(e,n,a,r,i){void 0===i&&(i=Promise);var o=new k(u(e,n,a,r),i);return t.isGeneratorFunction(n)?o:o.next().then(function(e){return e.done?e.value:o.next()})},E(C),l(C,c,"Generator"),l(C,o,function(){return this}),l(C,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),n=[];for(var a in t)n.push(a);return n.reverse(),function e(){for(;n.length;){var a=n.pop();if(a in t)return e.value=a,e.done=!1,e}return e.done=!0,e}},t.values=H,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(I),!t)for(var n in this)"t"===n.charAt(0)&&a.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(a,r){return s.type="throw",s.arg=t,n.next=a,r&&(n.method="next",n.arg=e),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var c=a.call(o,"catchLoc"),l=a.call(o,"finallyLoc");if(c&&l){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),I(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var a=n.completion;if("throw"===a.type){var r=a.arg;I(n)}return r}}throw Error("illegal catch attempt")},delegateYield:function(t,n,a){return this.delegate={iterator:H(t),resultName:n,nextLoc:a},"next"===this.method&&(this.arg=e),m}},t}function w(e,t,n,a,r,i,o){try{var s=e[i](o),c=s.value}catch(l){return void n(l)}s.done?t(c):Promise.resolve(c).then(a,r)}function b(e){return function(){var t=this,n=arguments;return new Promise(function(a,r){var i=e.apply(t,n);function o(e){w(i,a,r,o,s,"next",e)}function s(e){w(i,a,r,o,s,"throw",e)}o(void 0)})}}function C(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,k(a.key),a)}}function E(e,t,n){return(t=k(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function k(e){var t=function(e){if("object"!=_(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=_(n))return n;throw TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==_(t)?t:t+""}var A,T,I,S=function(){var e,t;return e=function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=n.closeOnOverlayClick,r=n.closeOnEsc;(function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")})(this,e),E(this,"_handleOverlayClick",function(){t.close(),t._removeListeners()}),E(this,"_handleKeyDown",function(e){27===e.keyCode&&(t.close(),t._removeListeners())}),this.dialogRoot=document.createElement("div"),this.dialogOverlay=document.createElement("div"),this.dialogContent=document.createElement("div"),this.dialogRoot.classList.add("x54SkYRT0"),this.dialogRoot.setAttribute("data-state","open"),this.dialogOverlay.classList.add("overlay"),this.dialogContent.classList.add("content"),this.dialogRoot.appendChild(this.dialogOverlay),this.dialogRoot.appendChild(this.dialogContent),document.body.appendChild(this.dialogRoot),this.dialogRoot.classList.add("show"),void 0!==a&&a&&this.dialogOverlay.addEventListener("click",this._handleOverlayClick),void 0!==r&&r&&document.addEventListener("keydown",this._handleKeyDown)},t=[{key:"_removeListeners",value:function(){this.dialogOverlay.onclick=null,document.removeEventListener("keydown",this._handleKeyDown)}},{key:"close",value:function(){var e=this;this.dialogRoot.setAttribute("data-state","closed"),setTimeout(function(){e.dialogRoot.remove()},100)}}],C(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(),H=function(e){return document.querySelector(e)},M=/(Android|webOS|Windows Phone|iPhone|iPod|iPad)/i.test(window.navigator.platform)||window.innerWidth<550,D="",B=!1,j=0,O={activitybar:H(".activitybar"),sidebar:H(".sidebar"),main:H(".main"),messageInput:H(".xtsARDHTI"),searchInput:H(".xujXllYgW"),messageArea:H(".xikyLwDf4"),sendButton:H(".xuwRtDpu4"),fileInput:H(".xVEJA40Qh"),actionModalContent:H(".x54SkYRT0"),actionModal:H(".x54SkYRT0"),actionModalTitle:H(".x54SkYRT0 .xrYn5ZY3v"),actionModalSubtitle:H(".xWDUelLWA"),actionModalOverlay:H(".x54SkYRT0 .overlay"),actionModalIcon:H(".x3DtTJteF"),signOutBtn:H(".xlifWPlRj#x8Kzd47QX"),directionsBtn:H(".xlifWPlRj#x93dGr74c")},R=["幹","操","草","白癡","智障","死","笨蛋","傻逼"],Y=!1,G=!1;function K(){return P.apply(this,arguments)}function P(){return(P=b(L().mark(function e(){var t,n;return L().wrap(function(e){for(var a;;)switch(e.prev=e.next){case 0:if((t=O.messageInput.innerText.trim())&&!(t.length>80)){e.next=3;break}return e.abrupt("return");case 3:return t=F((a=t.replace(/&([^;]+)/g,"&amp;$1").replaceAll("<","&lt;").replaceAll(">","&gt;").replace(/(\r?\n){3,}/g,"\n\n")).replace(/https?:\/\/[^\s/$.?#].[^\s]*/g,function(e){return'<a class="x0ciSQShX" href="'.concat(e,'" target="_blank">').concat(decodeURIComponent(e),"</a>")}).replaceAll("\n","<br>")),O.messageInput.innerHTML="",n=f(p(ee,"chats",D,"messages")),e.next=8,h(n,{senderUID:T,sender:I,content:t,timestamp:Date.now()});case 8:W(t,n.id);case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)}function W(e,t){var n=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div"),i=document.createElement("div"),o=document.createElement("div"),s=document.createElement("div");s.classList.add("xRHoYYwoZ"),a.classList.add("xMyW2iRSH"),n.classList.add("xVC8gtuyS"),n.classList.add("xiOw4dg0O"),r.classList.add("xKljxgVJA"),i.classList.add("xu4Celbbq"),o.classList.add("xc4iCj2Gy"),n.appendChild(r),r.appendChild(s),s.appendChild(i),i.appendChild(o),s.appendChild(a),o.innerHTML="你",a.innerHTML=e,O.messageArea.appendChild(n),O.messageArea.scrollTo({top:O.messageArea.scrollHeight,behavior:"smooth"});try{n.setAttribute("data-mid",t)}catch(c){console.log("無法設置該元素參數：",c)}}function z(e,t,n,a){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=document.createElement("div"),o=document.createElement("div"),s=document.createElement("div"),c=document.createElement("div"),l=document.createElement("div"),d=document.createElement("div"),u=document.createElement("div"),p=document.createElement("div");if(p.classList.add("xRHoYYwoZ"),o.classList.add("xMyW2iRSH"),i.classList.add("xVC8gtuyS"),s.classList.add("xSYcbYqTG"),c.classList.add("xKljxgVJA"),l.classList.add("xu4Celbbq"),d.classList.add("xc4iCj2Gy"),u.classList.add("xt8fROB2L"),u.innerText=a,i.setAttribute("data-mid",t),i.appendChild(s),i.appendChild(c),c.appendChild(p),p.appendChild(l),l.appendChild(d),l.appendChild(u),p.appendChild(o),d.innerText=n,o.innerHTML=e,r)O.messageArea.appendChild(i),O.messageArea.scrollTo({top:O.messageArea.scrollHeight,behavior:"smooth"});else{var h=O.messageArea.firstChild;O.messageArea.insertBefore(i,h)}}function V(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=document.createElement("div"),r=document.createElement("div"),i=document.createElement("div"),o=document.createElement("div"),s=document.createElement("div");if(s.classList.add("xRHoYYwoZ"),r.classList.add("xMyW2iRSH"),a.classList.add("xVC8gtuyS"),i.classList.add("xKljxgVJA"),o.classList.add("xu4Celbbq"),a.setAttribute("data-mid",t),a.appendChild(i),i.appendChild(s),s.appendChild(o),s.appendChild(r),r.innerHTML=e,a.classList.add("xiOw4dg0O"),o.innerHTML='<div class="xc4iCj2Gy">你</div>',n)O.messageArea.appendChild(a),O.messageArea.scrollTo({top:O.messageArea.scrollHeight,behavior:"smooth"});else{var c=O.messageArea.firstChild;O.messageArea.insertBefore(a,c)}}function Z(e){return e.replace(/&([^;]+)/g,"&amp;$1").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll(" ","&nbsp;").replaceAll("\n","<br>")}document.addEventListener("visibilitychange",function(){"visible"===document.visibilityState&&(document.title="Structure",B&&navigator.clearAppBadge(),j=0)}),O.messageInput.addEventListener("input",function(e){""===e.target.innerText.trim()&&(e.target.innerHTML="")}),O.messageInput.addEventListener("keydown",function(e){switch(e.keyCode){case 13:M||e.shiftKey||(e.preventDefault(),K());break;case 85:case 66:e.ctrlKey&&e.preventDefault()}}),M&&document.body.classList.add("mobile"),("setAppBadge"in navigator||"clearAppBadge"in navigator)&&(B=!0),O.sendButton.onclick=K,O.messageInput.onpaste=function(e){e.preventDefault(),document.execCommand("insertHTML",!0,Z((e.clipboardData||window.Clipboard).getData("text/plain")))},document.onkeydown=function(e){switch(e.keyCode){case 191:"true"===O.messageInput.getAttribute("contenteditable")&&document.activeElement!==O.messageInput&&document.activeElement!==O.searchInput&&(e.preventDefault(),O.messageInput.focus());break;case 75:e.ctrlKey&&Y&&(e.preventDefault(),O.searchInput.focus());break;case 123:e.preventDefault();break;case 67:e.ctrlKey&&e.shiftKey&&e.preventDefault();break;case 85:case 79:case 187:case 189:case 80:case 83:case 109:case 107:e.ctrlKey&&e.preventDefault();break;case 37:case 39:e.altKey&&e.preventDefault()}},document.querySelectorAll("body > div").forEach(function(e){e.onwheel=function(e){e.ctrlKey&&e.preventDefault()}}),document.oncontextmenu=function(e){e.preventDefault()},H(".xehdiGgBv .xMyenRl7K .x8JU9DbQZ").onclick=function(){D="",H(".main").classList.remove("x8VAGH6N2"),O.messageInput.innerHTML="",O.messageInput.setAttribute("contenteditable","false"),O.messageInput.setAttribute("tabindex","-1"),O.sendButton.setAttribute("tabindex","-1")},document.addEventListener("touchstart",function(e){e.touches&&e.touches.length>1&&e.preventDefault()},{passive:!1});var q=0;function F(e){var t=RegExp(R.map(function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}).join("|"),"gi");return e.replace(t,function(e){return"*".repeat(e.length)})}function N(e,t,n,a){var r,i,o=document.createElement("div"),s=document.createElement("div"),c=document.createElement("div"),l=document.createElement("div");o.setAttribute("tabindex","0"),o.classList.add("x2fP9fkxS"),r=t,g(p(ee,"chats",r,"messages"),function(e){e.metadata.fromCache||e.docChanges().forEach(function(e){if(D===r){var t,n=e.doc.data();switch(e.type){case"added":n.senderUID!==T&&("hidden"===document.visibilityState&&(j++,document.title="(".concat(j,") Structure"),B&&navigator.setAppBadge(j)),z(n.content,e.doc.id,n.sender,"現在"));break;case"removed":try{(t=H('.xikyLwDf4 .xVC8gtuyS[data-mid="'.concat(e.doc.id,'"]'))).classList.add("deleted"),t.innerHTML="這則訊息已被刪除"}catch(a){console.log("發生未知錯誤",a)}break;case"modified":try{(t=H('.xikyLwDf4 .xVC8gtuyS[data-mid="'.concat(e.doc.id,'"] .xMyW2iRSH'))).innerHTML=n.content}catch(i){console.log("發生未知錯誤",i)}}}})},function(e){console.error("監聽錯誤:",e)});var d,u,h=(i=b(L().mark(function e(){return L().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:(D!==t||M)&&(A=void 0,ei(D=t),O.messageArea.innerHTML="",O.sendButton.classList.remove("disabled"),O.fileInput.removeAttribute("disabled"),O.messageInput.setAttribute("contenteditable","true"),M||(H(".x2fP9fkxS.active")&&H(".x2fP9fkxS.active").classList.remove("active"),H(".x2fP9fkxS.interim:not(.active)")&&H(".x2fP9fkxS.interim:not(.active)").remove(),o.classList.add("active")),M&&H(".xehdiGgBv .xMyenRl7K .x8JU9DbQZ").setAttribute("tabindex","0"),H(".main").classList.add("x8VAGH6N2"),H(".xvwhg72ii").innerText=o.getAttribute("data-roomName"),O.messageInput.setAttribute("contenteditable","true"),O.messageInput.setAttribute("tabindex","0"),O.sendButton.setAttribute("tabindex","0"));case 1:case"end":return e.stop()}},e)})),function(){return i.apply(this,arguments)});o.onclick=function(){h()},o.onkeydown=function(e){13===e.keyCode&&h()},o.setAttribute("data-roomid",t),o.setAttribute("data-roomname",e),o.appendChild(s),s.classList.add("xQ65c0Nkc"),c.classList.add("xybvM5cRF"),s.appendChild(c),c.innerText=e,l.classList.add("xT3Ta8vKw"),d=n||(0===a?"暫無訊息":"".concat((u=a).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")," 則訊息")),l.innerHTML='\n		<span class="x97KBA8qs">'.concat(d,"</span>\n	"),s.appendChild(l),H(".xemr1y6ie").appendChild(o)}function U(e){var t=Math.floor((Date.now()-e)/1e3);return t<60?"".concat(t,"秒"):t<3600?"".concat(Math.floor(t/60),"分鐘"):t<86400?"".concat(Math.floor(t/3600),"小時"):t<2592e3?"".concat(Math.floor(t/86400),"天"):t<31536e3?"".concat(Math.floor(t/2592e3),"個月"):"".concat(Math.floor(t/31536e3),"年前")}function J(e){for(var t=["B","KB","MB","GB","TB"],n=e,a=0;n>=1024&&a<t.length-1;)n/=1024,a++;return"".concat(n.toFixed(2)," ").concat(t[a])}document.addEventListener("touchend",function(e){var t=(new Date).getTime();t-q<=300&&e.preventDefault(),q=t},!1),document.addEventListener("gesturestart",function(e){e.preventDefault()}),O.messageInput.addEventListener("drop",function(e){e.preventDefault();var t=e.dataTransfer.getData("text/plain");try{e.target.focus(),document.execCommand("insertHTML",!0,Z(t))}catch(n){console.log(n)}}),O.searchInput.oninput=function(e){document.querySelectorAll(".x8FrVw7Ca .x2fP9fkxS").forEach(function(t){t.getAttribute("data-roomname").toLowerCase().includes(e.target.value.toLowerCase())?t.classList.remove("hide"):t.classList.add("hide")})},H(".x8u3Iqtu9").onclick=function(){O.searchInput.focus()},O.messageInput.oncopy=function(e){e.preventDefault();var t=window.getSelection().toString();e.clipboardData.setData("text/plain",t)},O.messageArea.addEventListener("scroll",function(){0===(O.messageArea.pageYOffset||O.messageArea.scrollTop)&&function(e){er.apply(this,arguments)}(D)});var Q,X=e({apiKey:"AIzaSyAp73V5ZsBUtpy4kS3-QyGirGSpz71DPWo",authDomain:"smiling-theory-397204.firebaseapp.com",databaseURL:"https://smiling-theory-397204-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"smiling-theory-397204",storageBucket:"smiling-theory-397204.appspot.com",messagingSenderId:"360479398694",appId:"1:360479398694:web:05b7df5ce277f89ea8ffe7",measurementId:"G-6BKTT1K7D1"}),ee=u(X),et=s(X);function en(e,t,n){return ea.apply(this,arguments)}function ea(){return(ea=b(L().mark(function e(t,n,a){var r;return L().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v(p(ee,"chats",a,"messages"));case 2:N(t,a,n,(r=e.sent).size);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function er(){return(er=b(L().mark(function e(t){var n,a;return L().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,void 0===A){e.next=10;break}return e.next=4,v($(p(ee,"chats",t,"messages"),x("timestamp","desc"),m(A),y(10)));case 4:A=10===(n=e.sent).docs.length?n.docs[9]:void 0,n.forEach(function(e){var t=e.data();t.senderUID===T?V(t.content,e.id,!1):z(t.content,e.id,t.sender,U(t.timestamp),!1)}),a=O.messageArea.scrollHeight,O.messageArea.scrollTop=a-Q,Q=a;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.error("Error fetching messages: ",e.t0);case 15:case"end":return e.stop()}},e,null,[[0,12]])}))).apply(this,arguments)}function ei(e){return eo.apply(this,arguments)}function eo(){return(eo=b(L().mark(function e(t){var n,a;return L().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v($(p(ee,"chats",t,"messages"),x("timestamp","desc"),y(10)));case 2:(n=e.sent).docs[9]&&(A=n.docs[9]),a=[],n.forEach(function(e){a.push(e)}),a.reverse(),a.forEach(function(e){var t=e.data();t.senderUID===T?V(t.content,e.id):z(t.content,e.id,t.sender,U(t.timestamp))}),Q=O.messageArea.scrollHeight;case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}window.onload=b(L().mark(function e(){var t,n;return L().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v(p(ee,"chats"));case 2:t=e.sent,n=0,H(".xemr1y6ie .spinner").remove(),t.forEach(function(e){var t=e.data();-1!==t.members.indexOf(T)&&(n++,en(t.name,t.description,e.id))}),0===n&&(H(".xemr1y6ie").innerHTML='<div class="xZYFExNlg">尚未加入任何聊天室</div>');case 7:case"end":return e.stop()}},e)}));var es=new a,ec=t();r(ec,function(e){var t,r,o,s,c;e?(T=e.uid,I=e.displayName,function(){if(!1===G){O.searchInput.removeAttribute("disabled"),O.searchInput.setAttribute("tabindex","0"),O.messageArea.classList.remove("xVjpzmyej"),H(".xnKzgeITl")&&H(".xnKzgeITl").remove();var e=(new Date).getHours();z("{dl}好，歡迎回來，現在就開始對話吧！".replace("{dl}",e>=5&&e<11?"早上":e>=11&&e<14?"中午":e>=14&&e<18?"下午":"晚安"),"0","陌生人","現在"),G=!0,Y=!0}}()):(T="",(t=document.createElement("div")).classList.add("xrYn5ZY3v"),t.innerText="帳號登入",(r=document.createElement("div")).classList.add("xRRuA0Z3S"),(o=document.createElement("div")).id="x7BYgkdiJ",o.innerHTML='<svg class="xGBqJjpdr" viewBox="0 0 20 20">\n	<path d="M19.6 10.23c0-.82-.1-1.42-.25-2.05H10v3.72h5.5c-.15.96-.74 2.31-2.04 3.22v2.45h3.16c1.89-1.73 2.98-4.3 2.98-7.34z" fill=#4285F4></path>\n	<path d="M13.46 15.13c-.83.59-1.96 1-3.46 1-2.64 0-4.88-1.74-5.68-4.15H1.07v2.52C2.72 17.75 6.09 20 10 20c2.7 0 4.96-.89 6.62-2.42l-3.16-2.45z" fill=#34A853></path>\n	<path d="M3.99 10c0-.69.12-1.35.32-1.97V5.51H1.07A9.973 9.973 0 000 10c0 1.61.39 3.14 1.07 4.49l3.24-2.52c-.2-.62-.32-1.28-.32-1.97z" fill=#FBBC05></path>\n	<path d="M10 3.88c1.88 0 3.13.81 3.85 1.48l2.84-2.76C14.96.99 12.7 0 10 0 6.09 0 2.72 2.25 1.07 5.51l3.24 2.52C5.12 5.62 7.36 3.88 10 3.88z" fill=#EA4335></path></svg>\n	<div>使用 Google 登入</div>',(s=document.createElement("div")).id="xBnuWNG6V",s.className="actionbtn xYIKBnbHS",o.className="actionbtn xYIKBnbHS",s.innerHTML='<svg class=xGBqJjpdr viewBox="0 0 20 20">\n	<path d="M1 5.006A2 2 0 012.995 3h14.01A2 2 0 0119 5.006v9.988A2 2 0 0117.005 17H2.995A2 2 0 011 14.994V5.006zM3 5l7 4 7-4v2l-7 4-7-4V5z" fill-rule=evenodd fill=#788aa2></path>\n	</svg>\n	<div>使用 電子郵件 登入</div>',r.appendChild(o),r.appendChild(s),(c=new S).dialogContent.classList.add("bt"),c.dialogContent.appendChild(t),c.dialogContent.appendChild(r),o.onclick=function(){n(ec,es).then(function(e){a.credentialFromResult(e).accessToken;var t=e.user;T=t.uid,I=t.displayName,c.dialogContent.innerHTML='<div class="xJ0pEZGEO">已成功登入Google帳號</div>\n						<div class="xDmLoXo3E">\n						<img class="xm7NzrczQ" draggable="false" src="'.concat(t.photoURL,'" alt="avatar"/>\n						<div class="xDLBHn55v"><div class="xQ6IT8O6S">').concat(t.displayName,'</div>\n						<div class="xPnpcvswL">').concat(t.email,"</div></div></div>"),c.dialogOverlay.onclick=function(){c.close()}}).catch(function(e){a.credentialFromError(e),console.log(e.code,e.message)})},s.onclick=function(){var e=new S({closeOnEsc:!0,closeOnOverlayClick:!0}),t=document.createElement("div");t.classList.add("xrYn5ZY3v"),t.innerText="帳號登入",e.dialogContent.appendChild(t);var n=document.createElement("div");n.classList.add("xZdL9CF5M"),e.dialogContent.appendChild(n);var a=document.createElement("input");a.placeholder="電子郵件",a.autocomplete="off",a.type="text",a.autocomplete="off",a.spellcheck="false",n.appendChild(a);var r=document.createElement("input");r.placeholder="密碼",r.type="password",r.autocomplete="off",n.appendChild(r);var o=document.createElement("div");o.classList.add("xw0IanPrC"),n.appendChild(o);var s=document.createElement("div");s.innerText="登入",s.tabIndex="0",s.classList.add("x40AApYkW"),n.appendChild(s),a.focus();var l=!0,d=function(t,n){l&&(l=!1,o.classList.remove("show"),s.innerHTML='\n			<svg class="x3xXCjYFp" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n			<path d="M21 12a9 9 0 1 1-6.219-8.56"/>\n			</svg>',i(ec,t,n).then(function(t){try{c.close(),e.close()}catch(n){}var a=t.user;console.log("用户已登录:",a)}).catch(function(e){setTimeout(function(){var t=e.code;o.classList.add("show"),"auth/invalid-login-credentials"===t?o.innerText="帳號或密碼錯誤":"auth/invalid-email"===t?o.innerText="電子郵件格式錯誤":"auth/network-request-failed"===t&&(o.innerText="發送請求失敗"),s.innerHTML="登入",l=!0},3e3)}))};s.onclick=function(){d(a.value,r.value)},r.onkeydown=function(e){13===e.keyCode&&d(a.value,r.value)}})}),O.signOutBtn.onclick=function(){o(ec).then(function(){console.log("User signed out")}).catch(function(e){console.error("Sign out error",e)})},O.directionsBtn.onclick=function(){var e=new S({closeOnEsc:!0,closeOnOverlayClick:!0}),t=document.createElement("div"),n=document.createElement("div");t.classList.add("xrYn5ZY3v"),n.classList.add("xWDUelLWA"),t.innerText="設定",n.innerHTML='\n	<div class="xtTvvWnjq bt">\n	</div>\n	<div class="xtTvvWnjq">\n	<span class="xIzeE22ru">深色模式</span>\n	<input type="checkbox" class="cls-switch" '.concat(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"checked":"",'>\n	</div>\n	<div class="xtTvvWnjq">\n	<span class="xIzeE22ru">自動接受邀請</span>\n	<input type="checkbox" class="cls-switch">\n	</div>\n	<div class="xtTvvWnjq">\n	<span class="xIzeE22ru">開啟通知</span>\n	<input type="checkbox" class="cls-switch">\n	</div>\n	'),e.dialogContent.appendChild(t),e.dialogContent.appendChild(n)},O.fileInput.onchange=function(e){var t=e.target.files[0],n=new S;n.dialogContent.classList.add("bt");var a=document.createElement("div");a.classList.add("xrYn5ZY3v");var r=document.createElement("div");if(r.classList.add("xWDUelLWA"),n.dialogContent.appendChild(a),n.dialogContent.appendChild(r),t.size/1024/1024>5)return a.innerText="這個文件太大了",r.innerText="這個文件足足有 ".concat(J(t.size),"，我們無法負擔"),void(n.dialogOverlay.onclick=function(){n.close()});var i=c(et,"uploads/"+t.name);a.innerText="正在努力上傳中",r.innerText="這可能需要一點時間，請耐心等待...";var o=document.createElement("div");o.classList.add("xCECpHDwZ"),n.dialogContent.appendChild(o);var s=document.createElement("div");s.classList.add("xty9qDHrl"),o.appendChild(s);var u=document.createElement("div");u.classList.add("xIEj1ZAnA"),u.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n								<path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"></path>\n								<path d="M14 2v4a2 2 0 0 0 2 2h4"></path>\n							</svg>',s.appendChild(u);var v=document.createElement("div");v.classList.add("xxs4n9nhX"),s.appendChild(v),v.innerHTML='<div class="xTGGn7ABj">'.concat(t.name,'</div><div class="xtyaQiCLO">').concat(J(t.size),"</div>"),s.appendChild(v);var m=document.createElement("div");m.classList.add("xsoLox5sj"),s.appendChild(m);var g=document.createElement("div");g.classList.add("xk0osKWCK"),m.appendChild(g);var $=l(i,t);$.on("state_changed",function(e){var t=e.bytesTransferred/e.totalBytes*100;g.style.width="".concat(t,"%"),console.log("Upload is "+t+"% done")},function(e){console.error(e)},b(L().mark(function e(){var i,s,c;return L().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.dialogOverlay.onclick=function(){n.close()},o.remove(),a.innerText="完成上傳",r.innerText="這個文件已成功上傳，你的好友可以訪問了",e.next=6,d($.snapshot.ref);case 6:return i=e.sent,s="我剛剛上傳了一個名為「".concat(t.name,'」的文件，<a href="').concat(i,'" class="x0ciSQShX" target="_blank">點擊下載</a>'),c=f(p(ee,"chats",D,"messages")),e.next=11,h(c,{senderUID:T,sender:I,content:s,timestamp:Date.now()});case 11:W(s,c.id),O.fileInput.value="";case 13:case"end":return e.stop()}},e)})))}})();
